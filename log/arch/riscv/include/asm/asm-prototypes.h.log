commit fc585d4a5cf614727f64d86550b794bcad29d5c3
Author: Olof Johansson <olof@lixom.net>
Date:   Mon Dec 16 20:06:31 2019 -0800

    riscv: Less inefficient gcc tishift helpers (and export their symbols)
    
    The existing __lshrti3 was really inefficient, and the other two helpers
    are also needed to compile some modules.
    
    Add the missing versions, and export all of the symbols like arm64
    already does.
    
    This code is based on the assembly generated by libgcc builds.
    
    This fixes a build break triggered by ubsan:
    
    riscv64-unknown-linux-gnu-ld: lib/ubsan.o: in function `.L2':
    ubsan.c:(.text.unlikely+0x38): undefined reference to `__ashlti3'
    riscv64-unknown-linux-gnu-ld: ubsan.c:(.text.unlikely+0x42): undefined reference to `__ashrti3'
    
    Signed-off-by: Olof Johansson <olof@lixom.net>
    [paul.walmsley@sifive.com: use SYM_FUNC_{START,END} instead of
     ENTRY/ENDPROC; note libgcc origin]
    Signed-off-by: Paul Walmsley <paul.walmsley@sifive.com>

diff --git a/arch/riscv/include/asm/asm-prototypes.h b/arch/riscv/include/asm/asm-prototypes.h
index dd62b691c443..27e005fca584 100644
--- a/arch/riscv/include/asm/asm-prototypes.h
+++ b/arch/riscv/include/asm/asm-prototypes.h
@@ -5,4 +5,8 @@
 #include <linux/ftrace.h>
 #include <asm-generic/asm-prototypes.h>
 
+long long __lshrti3(long long a, int b);
+long long __ashrti3(long long a, int b);
+long long __ashlti3(long long a, int b);
+
 #endif /* _ASM_RISCV_PROTOTYPES_H */

commit 6b57ba8ed48a3ee3d6b53294ccbf02b8cb83c604
Author: Zong Li <zong.li@sifive.com>
Date:   Mon Oct 28 00:42:47 2019 -0700

    riscv: clean up the macro format in each header file
    
    There are many different formats in each header now, such as
    _ASM_XXX_H, __ASM_XXX_H, _ASM_RISCV_XXX_H, RISCV_XXX_H, etc., This patch
    tries to unify the format by using _ASM_RISCV_XXX_H, because the most
    header use it now. This patch also adds the conditional to the headers
    if they lost it.
    
    Signed-off-by: Zong Li <zong.li@sifive.com>
    Signed-off-by: Paul Walmsley <paul.walmsley@sifive.com>

diff --git a/arch/riscv/include/asm/asm-prototypes.h b/arch/riscv/include/asm/asm-prototypes.h
index c9fecd120d18..dd62b691c443 100644
--- a/arch/riscv/include/asm/asm-prototypes.h
+++ b/arch/riscv/include/asm/asm-prototypes.h
@@ -1,5 +1,6 @@
 /* SPDX-License-Identifier: GPL-2.0 */
 #ifndef _ASM_RISCV_PROTOTYPES_H
+#define _ASM_RISCV_PROTOTYPES_H
 
 #include <linux/ftrace.h>
 #include <asm-generic/asm-prototypes.h>

commit 57a489786de9ec37d6e25ef1305dc337047f0236
Author: James Cowgill <jcowgill@debian.org>
Date:   Thu Sep 6 22:57:56 2018 +0100

    RISC-V: include linux/ftrace.h in asm-prototypes.h
    
    Building a riscv kernel with CONFIG_FUNCTION_TRACER and
    CONFIG_MODVERSIONS enabled results in these two warnings:
    
      MODPOST vmlinux.o
    WARNING: EXPORT symbol "return_to_handler" [vmlinux] version generation failed, symbol will not be versioned.
    WARNING: EXPORT symbol "_mcount" [vmlinux] version generation failed, symbol will not be versioned.
    
    When exporting symbols from an assembly file, the MODVERSIONS code
    requires their prototypes to be defined in asm-prototypes.h (see
    scripts/Makefile.build). Since both of these symbols have prototypes
    defined in linux/ftrace.h, include this header from RISC-V's
    asm-prototypes.h.
    
    Reported-by: Karsten Merker <merker@debian.org>
    Signed-off-by: James Cowgill <jcowgill@debian.org>
    Signed-off-by: Palmer Dabbelt <palmer@sifive.com>

diff --git a/arch/riscv/include/asm/asm-prototypes.h b/arch/riscv/include/asm/asm-prototypes.h
new file mode 100644
index 000000000000..c9fecd120d18
--- /dev/null
+++ b/arch/riscv/include/asm/asm-prototypes.h
@@ -0,0 +1,7 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+#ifndef _ASM_RISCV_PROTOTYPES_H
+
+#include <linux/ftrace.h>
+#include <asm-generic/asm-prototypes.h>
+
+#endif /* _ASM_RISCV_PROTOTYPES_H */
