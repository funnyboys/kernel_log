commit 1a59d1b8e05ea6ab45f7e18897de1ef0e6bc3da6
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Mon May 27 08:55:05 2019 +0200

    treewide: Replace GPLv2 boilerplate/reference with SPDX - rule 156
    
    Based on 1 normalized pattern(s):
    
      this program is free software you can redistribute it and or modify
      it under the terms of the gnu general public license as published by
      the free software foundation either version 2 of the license or at
      your option any later version this program is distributed in the
      hope that it will be useful but without any warranty without even
      the implied warranty of merchantability or fitness for a particular
      purpose see the gnu general public license for more details you
      should have received a copy of the gnu general public license along
      with this program if not write to the free software foundation inc
      59 temple place suite 330 boston ma 02111 1307 usa
    
    extracted by the scancode license scanner the SPDX license identifier
    
      GPL-2.0-or-later
    
    has been chosen to replace the boilerplate/reference in 1334 file(s).
    
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Reviewed-by: Allison Randal <allison@lohutok.net>
    Reviewed-by: Richard Fontana <rfontana@redhat.com>
    Cc: linux-spdx@vger.kernel.org
    Link: https://lkml.kernel.org/r/20190527070033.113240726@linutronix.de
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 92cae0a9213f..fc2608b18a0d 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -1,20 +1,7 @@
+/* SPDX-License-Identifier: GPL-2.0-or-later */
 /*
  * Copyright 2012 Pavel Machek <pavel@denx.de>
  * Copyright (C) 2012-2015 Altera Corporation
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
 #ifndef __MACH_CORE_H

commit 48e2bab90d8e5ea5955e386445626bac939e3b4b
Author: Clément Péron <peron.clem@gmail.com>
Date:   Tue Oct 9 13:20:19 2018 +0200

    ARM: socfpga: Clean unused functions
    
    These functions are unused externally, removed them and declare
    the one used locally as static.
    
    Signed-off-by: Clément Péron <peron.clem@gmail.com>
    Signed-off-by: Dinh Nguyen <dinguyen@kernel.org>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 65e1817d8afe..92cae0a9213f 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -34,8 +34,6 @@
 
 #define RSTMGR_MPUMODRST_CPU1		0x2     /* CPU1 Reset */
 
-extern void socfpga_init_clocks(void);
-extern void socfpga_sysmgr_init(void);
 void socfpga_init_l2_ecc(void);
 void socfpga_init_ocram_ecc(void);
 void socfpga_init_arria10_l2_ecc(void);

commit c5fb04cc96c1812eb09a3b0f3672f4a00d76730c
Author: Thor Thayer <tthayer@opensource.altera.com>
Date:   Mon Apr 11 12:01:34 2016 -0500

    ARM: socfpga: Initialize Arria10 OCRAM ECC on startup
    
    Initialize ECC for Arria10 On-Chip RAM on machine startup. The OCRAM
    memory must be initialized before data is stored in memory otherwise the
    ECC will fail on reads. The previous check-in
    
      2364d423a7b3 ("ARM: socfpga: Enable Arria10 OCRAM ECC on startup")
    
    added the OCRAM enable and initialization code but was not called on
    startup.
    
    Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
    Acked-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Cc: Russell King <linux@arm.linux.org.uk>
    Cc: linux-arm-kernel@lists.infradead.org
    Cc: linux-edac <linux-edac@vger.kernel.org>
    Link: http://lkml.kernel.org/r/1460394094-23326-1-git-send-email-tthayer@opensource.altera.com
    Signed-off-by: Borislav Petkov <bp@suse.de>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index bfbc78df15dd..65e1817d8afe 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -39,6 +39,7 @@ extern void socfpga_sysmgr_init(void);
 void socfpga_init_l2_ecc(void);
 void socfpga_init_ocram_ecc(void);
 void socfpga_init_arria10_l2_ecc(void);
+void socfpga_init_arria10_ocram_ecc(void);
 
 extern void __iomem *sys_manager_base_addr;
 extern void __iomem *rst_manager_base_addr;

commit ff6fd1478c531a40279cf013227279f31ff90b41
Author: Thor Thayer <tthayer@opensource.altera.com>
Date:   Mon Mar 21 11:01:45 2016 -0500

    ARM: socfpga: Enable Arria10 L2 cache ECC on startup
    
    Enable ECC for Arria10 L2 cache on machine startup. The ECC has to be
    enabled before data is stored in memory otherwise the ECC will fail on
    reads.
    
    Use DT_MACHINE to select Arria10 L2 cache function.
    
    Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
    Acked-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Cc: devicetree@vger.kernel.org
    Cc: dinguyen@opensource.altera.com
    Cc: linux-arm-kernel@lists.infradead.org
    Cc: linux@arm.linux.org.uk
    Cc: linux-edac <linux-edac@vger.kernel.org>
    Link: http://lkml.kernel.org/r/1458576106-24505-9-git-send-email-tthayer@opensource.altera.com
    Signed-off-by: Borislav Petkov <bp@suse.de>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 575195be6687..bfbc78df15dd 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -38,6 +38,7 @@ extern void socfpga_init_clocks(void);
 extern void socfpga_sysmgr_init(void);
 void socfpga_init_l2_ecc(void);
 void socfpga_init_ocram_ecc(void);
+void socfpga_init_arria10_l2_ecc(void);
 
 extern void __iomem *sys_manager_base_addr;
 extern void __iomem *rst_manager_base_addr;

commit 7cc5a5d3cd4cca0a3852d1500e8c50fe191bcc9d
Author: Thor Thayer <tthayer@opensource.altera.com>
Date:   Wed Feb 10 13:26:24 2016 -0600

    ARM: socfpga: Enable OCRAM ECC on startup
    
    Enable ECC for On-Chip RAM on machine startup. The ECC has to be enabled
    before data is stored in memory otherwise the ECC will fail on reads.
    
    Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
    Acked-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Cc: devicetree@vger.kernel.org
    Cc: dougthompson@xmission.com
    Cc: galak@codeaurora.org
    Cc: grant.likely@linaro.org
    Cc: ijc+devicetree@hellion.org.uk
    Cc: linux-arm-kernel@lists.infradead.org
    Cc: linux@arm.linux.org.uk
    Cc: linux-doc@vger.kernel.org
    Cc: linux-edac <linux-edac@vger.kernel.org>
    Cc: mark.rutland@arm.com
    Cc: m.chehab@samsung.com
    Cc: pawel.moll@arm.com
    Cc: robh+dt@kernel.org
    Cc: Russell King <linux@arm.linux.org.uk>
    Cc: tthayer.linux@gmail.com
    Cc: tthayer@opensource.altera.com
    Link: http://lkml.kernel.org/r/1455132384-17108-4-git-send-email-tthayer@opensource.altera.com
    Signed-off-by: Borislav Petkov <bp@suse.de>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index eb55d66a0eac..575195be6687 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -37,6 +37,7 @@
 extern void socfpga_init_clocks(void);
 extern void socfpga_sysmgr_init(void);
 void socfpga_init_l2_ecc(void);
+void socfpga_init_ocram_ecc(void);
 
 extern void __iomem *sys_manager_base_addr;
 extern void __iomem *rst_manager_base_addr;

commit 4d1138380ed6f1cca622e7de8bcc877c04a52d0d
Author: Thor Thayer <tthayer@opensource.altera.com>
Date:   Wed Feb 10 13:26:23 2016 -0600

    ARM: socfpga: Enable L2 cache ECC on startup
    
    Enable ECC for L2 cache on machine startup. The ECC has to be enabled
    before data is stored in memory otherwise the ECC will fail on reads.
    
    Signed-off-by: Thor Thayer <tthayer@opensource.altera.com>
    Acked-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Cc: devicetree@vger.kernel.org
    Cc: galak@codeaurora.org
    Cc: grant.likely@linaro.org
    Cc: ijc+devicetree@hellion.org.uk
    Cc: linux-arm-kernel@lists.infradead.org
    Cc: linux@arm.linux.org.uk
    Cc: linux-doc@vger.kernel.org
    Cc: linux-edac <linux-edac@vger.kernel.org>
    Cc: mark.rutland@arm.com
    Cc: m.chehab@samsung.com
    Cc: pawel.moll@arm.com
    Cc: robh+dt@kernel.org
    Cc: Russell King <linux@arm.linux.org.uk>
    Link: http://lkml.kernel.org/r/1455132384-17108-3-git-send-email-tthayer@opensource.altera.com
    Signed-off-by: Borislav Petkov <bp@suse.de>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 5bc6ea87cdf7..eb55d66a0eac 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -36,6 +36,7 @@
 
 extern void socfpga_init_clocks(void);
 extern void socfpga_sysmgr_init(void);
+void socfpga_init_l2_ecc(void);
 
 extern void __iomem *sys_manager_base_addr;
 extern void __iomem *rst_manager_base_addr;

commit cd871d517d46f26943f3c8f61c0d2ac6665da6a2
Author: Dinh Nguyen <dinguyen@opensource.altera.com>
Date:   Mon Jul 20 11:23:13 2015 -0500

    ARM: socfpga: add reset for the Arria 10 platform
    
    Since the Arria10's reset register offset is different from the Cyclone/Arria 5,
    it's best to add a new DT_MACHINE_START() for the Arria10.
    
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    ---
    v2: use altera_a10_dt_match for the A10 machine desc

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 7259c3732702..5bc6ea87cdf7 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -25,6 +25,7 @@
 #define SOCFPGA_RSTMGR_MODPERRST	0x14
 #define SOCFPGA_RSTMGR_BRGMODRST	0x1c
 
+#define SOCFPGA_A10_RSTMGR_CTRL		0xC
 #define SOCFPGA_A10_RSTMGR_MODMPURST	0x20
 
 /* System Manager bits */

commit 4aa705b18bf17c4ff33ff7bbcd3f0c596443fa81
Merge: c11d71621891 2879e43f0912
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Fri Jun 26 11:34:35 2015 -0700

    Merge tag 'armsoc-soc' of git://git.kernel.org/pub/scm/linux/kernel/git/arm/arm-soc
    
    Pull ARM SoC platform support updates from Kevin Hilman:
     "Our SoC branch usually contains expanded support for new SoCs and
      other core platform code.  Some highlights from this round:
    
       - sunxi: SMP support for A23 SoC
       - socpga: big-endian support
       - pxa: conversion to common clock framework
       - bcm: SMP support for BCM63138
       - imx: support new I.MX7D SoC
       - zte: basic support for ZX296702 SoC"
    
    * tag 'armsoc-soc' of git://git.kernel.org/pub/scm/linux/kernel/git/arm/arm-soc: (134 commits)
      ARM: zx: Add basic defconfig support for ZX296702
      ARM: dts: zx: add an initial zx296702 dts and doc
      clk: zx: add clock support to zx296702
      dt-bindings: Add #defines for ZTE ZX296702 clocks
      ARM: socfpga: fix build error due to secondary_startup
      MAINTAINERS: ARM64: EXYNOS: Extend entry for ARM64 DTS
      ARM: ep93xx: simone: support for SPI-based MMC/SD cards
      MAINTAINERS: update Shawn's email to use kernel.org one
      ARM: socfpga: support suspend to ram
      ARM: socfpga: add CPU_METHOD_OF_DECLARE for Arria 10
      ARM: socfpga: use CPU_METHOD_OF_DECLARE for socfpga_cyclone5
      ARM: EXYNOS: register power domain driver from core_initcall
      ARM: EXYNOS: use PS_HOLD based poweroff for all supported SoCs
      ARM: SAMSUNG: Constify platform_device_id
      ARM: EXYNOS: Constify irq_domain_ops
      ARM: EXYNOS: add coupled cpuidle support for Exynos3250
      ARM: EXYNOS: add exynos_get_boot_addr() helper
      ARM: EXYNOS: add exynos_set_boot_addr() helper
      ARM: EXYNOS: make exynos_core_restart() less verbose
      ARM: EXYNOS: fix exynos_boot_secondary() return value on timeout
      ...

commit 44fd8c7d4005f660f48679439f0a54225ba234a4
Author: Alan Tull <atull@opensource.altera.com>
Date:   Fri Jun 5 08:24:52 2015 -0500

    ARM: socfpga: support suspend to ram
    
    Add code that requests that the sdr controller go into
    self-refresh mode.  This code is run from ocram.
    
    Suspend-to-RAM and EDAC support are mutually exclusive on
    SOCFPGA.  If the EDAC is enabled, it will prevent the
    platform from going into suspend.
    
    Example of how to request to suspend to ram:
     $ echo enabled > \
    /sys/devices/soc/ffc02000.serial0/tty/ttyS0/power/wakeup
    
     $ echo -n mem > /sys/power/state
    
    Signed-off-by: Alan Tull <atull@opensource.altera.com>
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Signed-off-by: Kevin Hilman <khilman@linaro.org>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 27e7c65093c0..2484179c2b47 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -1,6 +1,6 @@
 /*
  * Copyright 2012 Pavel Machek <pavel@denx.de>
- * Copyright (C) 2012 Altera Corporation
+ * Copyright (C) 2012-2015 Altera Corporation
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -40,6 +40,10 @@ extern void socfpga_sysmgr_init(void);
 
 extern void __iomem *sys_manager_base_addr;
 extern void __iomem *rst_manager_base_addr;
+extern void __iomem *sdr_ctl_base_addr;
+
+u32 socfpga_sdram_self_refresh(u32 sdr_base);
+extern unsigned int socfpga_sdram_self_refresh_sz;
 
 extern char secondary_trampoline, secondary_trampoline_end;
 

commit 45be0cdb5323d6f2b4005a4d9263a72eac2040cd
Author: Dinh Nguyen <dinguyen@opensource.altera.com>
Date:   Tue Jun 2 21:14:02 2015 -0500

    ARM: socfpga: add CPU_METHOD_OF_DECLARE for Arria 10
    
    Add boot_secondary implementation for the Arria10 platform. Bringing up
    the secondary core on the Arria 10 platform is pretty similar to the
    Cyclone/Arria 5 platform, with the exception of the following differences:
    
    - Register offset to bringup CPU1 out of reset is different.
    - The cpu1-start-addr for Arria10 contains an additional nibble.
    
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Signed-off-by: Kevin Hilman <khilman@linaro.org>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 38e5cbf37f45..27e7c65093c0 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -25,6 +25,8 @@
 #define SOCFPGA_RSTMGR_MODPERRST	0x14
 #define SOCFPGA_RSTMGR_BRGMODRST	0x1c
 
+#define SOCFPGA_A10_RSTMGR_MODMPURST	0x20
+
 /* System Manager bits */
 #define RSTMGR_CTRL_SWCOLDRSTREQ	0x1	/* Cold Reset */
 #define RSTMGR_CTRL_SWWARMRSTREQ	0x2	/* Warm Reset */

commit 5f763ef80d4dff7f2aa519a31472b03499e2c2e1
Author: Dinh Nguyen <dinguyen@opensource.altera.com>
Date:   Tue Jun 2 21:14:01 2015 -0500

    ARM: socfpga: use CPU_METHOD_OF_DECLARE for socfpga_cyclone5
    
    Convert cyclone5/arria5 to use CPU_METHOD_OF_DECLARE for smp operations.
    
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Signed-off-by: Kevin Hilman <khilman@linaro.org>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 5913bbb50036..38e5cbf37f45 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -39,7 +39,6 @@ extern void socfpga_sysmgr_init(void);
 extern void __iomem *sys_manager_base_addr;
 extern void __iomem *rst_manager_base_addr;
 
-extern struct smp_operations socfpga_smp_ops;
 extern char secondary_trampoline, secondary_trampoline_end;
 
 extern unsigned long socfpga_cpu1start_addr;

commit 02b4e2756e01c623cc4dbceae4b07be75252db5b
Author: Russell King <rmk+kernel@arm.linux.org.uk>
Date:   Tue May 19 17:06:44 2015 +0100

    ARM: v7 setup function should invalidate L1 cache
    
    All ARMv5 and older CPUs invalidate their caches in the early assembly
    setup function, prior to enabling the MMU.  This is because the L1
    cache should not contain any data relevant to the execution of the
    kernel at this point; all data should have been flushed out to memory.
    
    This requirement should also be true for ARMv6 and ARMv7 CPUs - indeed,
    these typically do not search their caches when caching is disabled (as
    it needs to be when the MMU is disabled) so this change should be safe.
    
    ARMv7 allows there to be CPUs which search their caches while caching is
    disabled, and it's permitted that the cache is uninitialised at boot;
    for these, the architecture reference manual requires that an
    implementation specific code sequence is used immediately after reset
    to ensure that the cache is placed into a sane state.  Such
    functionality is definitely outside the remit of the Linux kernel, and
    must be done by the SoC's firmware before _any_ CPU gets to the Linux
    kernel.
    
    Changing the data cache clean+invalidate to a mere invalidate allows us
    to get rid of a lot of platform specific hacks around this issue for
    their secondary CPU bringup paths - some of which were buggy.
    
    Reviewed-by: Florian Fainelli <f.fainelli@gmail.com>
    Tested-by: Florian Fainelli <f.fainelli@gmail.com>
    Tested-by: Heiko Stuebner <heiko@sntech.de>
    Tested-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Acked-by: Sebastian Hesselbarth <sebastian.hesselbarth@gmail.com>
    Tested-by: Sebastian Hesselbarth <sebastian.hesselbarth@gmail.com>
    Acked-by: Shawn Guo <shawn.guo@linaro.org>
    Tested-by: Thierry Reding <treding@nvidia.com>
    Acked-by: Thierry Reding <treding@nvidia.com>
    Tested-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Tested-by: Michal Simek <michal.simek@xilinx.com>
    Tested-by: Wei Xu <xuwei5@hisilicon.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index a0f3b1cd497c..767c09e954a0 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -31,7 +31,6 @@
 
 #define RSTMGR_MPUMODRST_CPU1		0x2     /* CPU1 Reset */
 
-extern void socfpga_secondary_startup(void);
 extern void __iomem *socfpga_scu_base_addr;
 
 extern void socfpga_init_clocks(void);

commit 122694a0c71281cf2b349af41309c3caf5f31d61
Author: Dinh Nguyen <dinguyen@opensource.altera.com>
Date:   Tue May 12 16:49:21 2015 -0500

    ARM: socfpga: use of_iomap to map the SCU
    
    Use of_iomap to map the "arm,cortex-a9-scu". By doing this, we can remove
    map_io in socfpga.c.
    
    Also, we can remove socfpga_smp_init_cpus, as arm_dt_init_cpu_maps is
    already doing the CPU mapping.
    
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index a0f3b1cd497c..5913bbb50036 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -32,7 +32,6 @@
 #define RSTMGR_MPUMODRST_CPU1		0x2     /* CPU1 Reset */
 
 extern void socfpga_secondary_startup(void);
-extern void __iomem *socfpga_scu_base_addr;
 
 extern void socfpga_init_clocks(void);
 extern void socfpga_sysmgr_init(void);

commit de04261d5ac26c523a9737980d1e4f580f0e48f7
Author: Vince Bridgers <vbridger@opensource.altera.com>
Date:   Wed Feb 11 18:34:25 2015 +0000

    ARM: socfpga: Correct SCU virtual mapping in socfpga
    
    Correct SCU virtual mapping that was causing this BUG message:
    
    "BUG: mapping for 0xfffec000 at 0xfffec000 out of vmalloc space"
    
    Signed-off-by: Vince Bridgers <vbridger@opensource.altera.com>
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 483cb467bf65..a0f3b1cd497c 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -45,6 +45,6 @@ extern char secondary_trampoline, secondary_trampoline_end;
 
 extern unsigned long socfpga_cpu1start_addr;
 
-#define SOCFPGA_SCU_VIRT_BASE   0xfffec000
+#define SOCFPGA_SCU_VIRT_BASE   0xfee00000
 
 #endif

commit d686ce4204c5dc131396f1fca81beebc46cb8cdb
Author: Alan Tull <atull@opensource.altera.com>
Date:   Tue Oct 14 19:33:38 2014 +0000

    socfpga: hotplug: put cpu1 in wfi
    
    Use WFI when putting CPU1 to sleep.  Don't hold CPU1 in reset
    since that results in increased power consumption.
    
    Reset CPU1 briefly during CPU1 bootup.
    
    This has been tested for hotplug and suspend/resume and results
    in no increased power consumption.
    
    Signed-off-by: Alan Tull <atull@opensource.altera.com>
    Acked-by: Pavel Machek <pavel@denx.de>
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 60c443dadb58..483cb467bf65 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -21,6 +21,7 @@
 #define __MACH_CORE_H
 
 #define SOCFPGA_RSTMGR_CTRL	0x04
+#define SOCFPGA_RSTMGR_MODMPURST	0x10
 #define SOCFPGA_RSTMGR_MODPERRST	0x14
 #define SOCFPGA_RSTMGR_BRGMODRST	0x1c
 
@@ -28,6 +29,8 @@
 #define RSTMGR_CTRL_SWCOLDRSTREQ	0x1	/* Cold Reset */
 #define RSTMGR_CTRL_SWWARMRSTREQ	0x2	/* Warm Reset */
 
+#define RSTMGR_MPUMODRST_CPU1		0x2     /* CPU1 Reset */
+
 extern void socfpga_secondary_startup(void);
 extern void __iomem *socfpga_scu_base_addr;
 

commit 3a4356c0c042a5f340c8d6ee1a4feaa1c8e51ea2
Author: Dinh Nguyen <dinguyen@opensource.altera.com>
Date:   Wed Oct 1 05:44:48 2014 -0500

    arm: socfpga: fix fetching cpu1start_addr for SMP
    
    When CPU1 is brought out of reset, it's MMU is not turned on yet, so it will
    only be able to use physical addresses. For systems with that have the
    MMU page configured for 0xC0000000, 0x80000000, or 0x40000000
    "BIC 0x40000000" will work just fine, as it was just converting the
    virtual address of &cpu1start_addr into a physical address, ie. 0xC0000000
    became 0x80000000. So for systems where the SDRAM controller was able to do a
    wrap-around access, this was working fine, as it was just dropping the MSB,
    but for systems where out of bounds memory access is not allowed, this would
    not allow CPU1 to correctly fetch &cpu1start_addr.
    
    This patch fixes the secondary_trampoline code to correctly fetch the
    physical address of cpu1start_addr directly. The patch will subtract the
    correct PAGE_OFFSET from &cpu1start_addr. And since on this platform, the
    physical memory will always start at 0x0, subtracting PAGE_OFFSET from
    &cpu1start_addr will allow CPU1 to correctly fetch the value of cpu1start_addr.
    
    While at it, change the name of cpu1start_addr to socfpga_cpu1start_addr
    to avoid any future naming collisions for multiplatform image.
    
    Signed-off-by: Dinh Nguyen <dinguyen@opensource.altera.com>
    ---
    v4: Updated commit log to correctly lay out the usage of PAGE_OFFSET and
        add comments to the same effect.
    v3: Used PAGE_OFFSET to get the physical address
    v2: Correctly get the physical address instead of just a BIC hack.

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 572b8f719ffb..60c443dadb58 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -40,7 +40,7 @@ extern void __iomem *rst_manager_base_addr;
 extern struct smp_operations socfpga_smp_ops;
 extern char secondary_trampoline, secondary_trampoline_end;
 
-extern unsigned long cpu1start_addr;
+extern unsigned long socfpga_cpu1start_addr;
 
 #define SOCFPGA_SCU_VIRT_BASE   0xfffec000
 

commit 5c04b57fe33c7700e433983bb69e50ec8d8f08cd
Author: Dinh Nguyen <dinguyen@altera.com>
Date:   Thu Apr 11 10:55:24 2013 -0500

    ARM: socfpga: Enable soft reset
    
    Enable a cold or warm reset to the HW from userspace.
    
    Also fix a few sparse errors:
    
    warning: symbol 'sys_manager_base_addr' was not declared. Should it be static?
    warning: symbol 'rst_manager_base_addr' was not declared. Should it be static?
    
    Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
    Reviewed-by: Pavel Machek <pavel@denx.de>
    Signed-off-by: Olof Johansson <olof@lixom.net>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 315edff610f2..572b8f719ffb 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -20,12 +20,23 @@
 #ifndef __MACH_CORE_H
 #define __MACH_CORE_H
 
+#define SOCFPGA_RSTMGR_CTRL	0x04
+#define SOCFPGA_RSTMGR_MODPERRST	0x14
+#define SOCFPGA_RSTMGR_BRGMODRST	0x1c
+
+/* System Manager bits */
+#define RSTMGR_CTRL_SWCOLDRSTREQ	0x1	/* Cold Reset */
+#define RSTMGR_CTRL_SWWARMRSTREQ	0x2	/* Warm Reset */
+
 extern void socfpga_secondary_startup(void);
 extern void __iomem *socfpga_scu_base_addr;
 
 extern void socfpga_init_clocks(void);
 extern void socfpga_sysmgr_init(void);
 
+extern void __iomem *sys_manager_base_addr;
+extern void __iomem *rst_manager_base_addr;
+
 extern struct smp_operations socfpga_smp_ops;
 extern char secondary_trampoline, secondary_trampoline_end;
 

commit d6dd735f4bda19bfe07d96d9025c94c4619d4596
Author: Dinh Nguyen <dinguyen@altera.com>
Date:   Mon Feb 11 17:30:33 2013 -0600

    arm: socfpga: Add SMP support for actual socfpga harware
    
    Because the CPU1 start address is different for socfpga-vt and
    socfpga-cyclone5, we add code to use the correct CPU1 start addr.
    
    Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
    Signed-off-by: Pavel Machek <pavel@denx.de>
    Cc: Russell King <linux@arm.linux.org.uk>
    Cc: Arnd Bergmann <arnd@arndb.de>
    Cc: Olof Johansson <olof@lixom.net>
    Cc: Rob Herring <rob.herring@calxeda.com>
    Cc: Grant Likely <grant.likely@secretlab.ca>
    Signed-off-by: Olof Johansson <olof@lixom.net>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
index 9941caa94931..315edff610f2 100644
--- a/arch/arm/mach-socfpga/core.h
+++ b/arch/arm/mach-socfpga/core.h
@@ -20,7 +20,7 @@
 #ifndef __MACH_CORE_H
 #define __MACH_CORE_H
 
-extern void secondary_startup(void);
+extern void socfpga_secondary_startup(void);
 extern void __iomem *socfpga_scu_base_addr;
 
 extern void socfpga_init_clocks(void);
@@ -29,6 +29,8 @@ extern void socfpga_sysmgr_init(void);
 extern struct smp_operations socfpga_smp_ops;
 extern char secondary_trampoline, secondary_trampoline_end;
 
+extern unsigned long cpu1start_addr;
+
 #define SOCFPGA_SCU_VIRT_BASE   0xfffec000
 
 #endif

commit 9c4566a117a6fe404a0e49b27ac71b631945a70f
Author: Dinh Nguyen <dinguyen@altera.com>
Date:   Thu Oct 25 10:41:39 2012 -0600

    ARM: socfpga: Enable SMP for socfpga
    
    Enable SMP for the SOCFPGA platform.
    
    Signed-off-by: Pavel Machek <pavel@denx.de>
    Signed-off-by: Dinh Nguyen <dinguyen@altera.com>
    Reviewed-by: Rob Herring <rob.herring@calxeda.com>
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>

diff --git a/arch/arm/mach-socfpga/core.h b/arch/arm/mach-socfpga/core.h
new file mode 100644
index 000000000000..9941caa94931
--- /dev/null
+++ b/arch/arm/mach-socfpga/core.h
@@ -0,0 +1,34 @@
+/*
+ * Copyright 2012 Pavel Machek <pavel@denx.de>
+ * Copyright (C) 2012 Altera Corporation
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifndef __MACH_CORE_H
+#define __MACH_CORE_H
+
+extern void secondary_startup(void);
+extern void __iomem *socfpga_scu_base_addr;
+
+extern void socfpga_init_clocks(void);
+extern void socfpga_sysmgr_init(void);
+
+extern struct smp_operations socfpga_smp_ops;
+extern char secondary_trampoline, secondary_trampoline_end;
+
+#define SOCFPGA_SCU_VIRT_BASE   0xfffec000
+
+#endif
