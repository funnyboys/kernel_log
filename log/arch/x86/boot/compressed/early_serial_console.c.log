commit 3afed06a355b5525d9a87bcb76567ef2e2e7b3a2
Author: Josh Triplett <josh@joshtriplett.org>
Date:   Mon Mar 10 13:26:10 2014 -0700

    x86, boot: Don't compile early_serial_console.c when !CONFIG_EARLY_PRINTK
    
    All the code in early_serial_console.c gets compiled out if
    !CONFIG_EARLY_PRINTK, but early_serial_console.o itself still gets
    compiled in.  Eliminate it from the compile entirely in that case.
    
    This does not change the generated code at all, in either case.
    
    Signed-off-by: Josh Triplett <josh@joshtriplett.org>

diff --git a/arch/x86/boot/compressed/early_serial_console.c b/arch/x86/boot/compressed/early_serial_console.c
index d3d003cb5481..261e81fb9582 100644
--- a/arch/x86/boot/compressed/early_serial_console.c
+++ b/arch/x86/boot/compressed/early_serial_console.c
@@ -1,9 +1,5 @@
 #include "misc.h"
 
-#ifdef CONFIG_EARLY_PRINTK
-
 int early_serial_base;
 
 #include "../early_serial_console.c"
-
-#endif

commit cec49df9d331feaa2fea3d24c07147c7659940d1
Author: Joe Millenbach <jmillenbach@gmail.com>
Date:   Thu Jul 19 18:04:41 2012 -0700

    x86, boot: Exclude early_serial_console.c if can't use it.
    
    Removes early_serial_console.c code if we don't have the config option that
    enables it (EARLY_PRINTK). When disabling this code, make early_serial_base a
    constant 0 to allow the compiler to optimize away the code that checks for
    early_serial_base.
    
    Signed-off-by: Joe Millenbach <jmillenbach@gmail.com>
    Link: http://lkml.kernel.org/r/1342746282-28497-7-git-send-email-jmillenbach@gmail.com
    Signed-off-by: Gokul Caushik <caushik1@gmail.com>
    Reviewed-by: Josh Triplett <josh@joshtriplett.org>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

diff --git a/arch/x86/boot/compressed/early_serial_console.c b/arch/x86/boot/compressed/early_serial_console.c
index 261e81fb9582..d3d003cb5481 100644
--- a/arch/x86/boot/compressed/early_serial_console.c
+++ b/arch/x86/boot/compressed/early_serial_console.c
@@ -1,5 +1,9 @@
 #include "misc.h"
 
+#ifdef CONFIG_EARLY_PRINTK
+
 int early_serial_base;
 
 #include "../early_serial_console.c"
+
+#endif

commit 8fee13a48e4879fba57725f6d9513df4bfa8e9f3
Author: Yinghai Lu <yinghai@kernel.org>
Date:   Mon Aug 2 16:21:22 2010 -0700

    x86, setup: enable early console output from the decompressor
    
    This enables the decompressor output to be seen on the serial console.
    Most of the code is shared with the regular boot code.
    
    We could add printf to the decompressor if needed, but currently there
    is no sufficiently compelling user.
    
    -v2: define BOOT_BOOT_H to avoid include boot.h
    -v3: early_serial_base need to be static in misc.c ?
    -v4: create seperate string.c printf.c cmdline.c early_serial_console.c
         after hpa's patch that allow global variables in compressed/misc stage
    -v5: remove printf.c related
    
    Signed-off-by: Yinghai Lu <yinghai@kernel.org>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

diff --git a/arch/x86/boot/compressed/early_serial_console.c b/arch/x86/boot/compressed/early_serial_console.c
new file mode 100644
index 000000000000..261e81fb9582
--- /dev/null
+++ b/arch/x86/boot/compressed/early_serial_console.c
@@ -0,0 +1,5 @@
+#include "misc.h"
+
+int early_serial_base;
+
+#include "../early_serial_console.c"
