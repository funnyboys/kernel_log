commit d4f7423efdd1419b17524d090ff9ff4024bcf09b
Author: Pu Wen <puwen@hygon.cn>
Date:   Sun Sep 23 17:33:44 2018 +0800

    x86/cpu: Get cache info and setup cache cpumap for Hygon Dhyana
    
    The Hygon Dhyana CPU has a topology extensions bit in CPUID. With
    this bit, the kernel can get the cache information. So add support in
    cpuid4_cache_lookup_regs() to get the correct cache size.
    
    The Hygon Dhyana CPU also discovers num_cache_leaves via CPUID leaf
    0x8000001d, so add support to it in find_num_cache_leaves().
    
    Also add cacheinfo_hygon_init_llc_id() and init_hygon_cacheinfo()
    functions to initialize Dhyana cache info. Setup cache cpumap in the
    same way as AMD does.
    
    Signed-off-by: Pu Wen <puwen@hygon.cn>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Reviewed-by: Borislav Petkov <bp@suse.de>
    Cc: bp@alien8.de
    Cc: tglx@linutronix.de
    Cc: mingo@redhat.com
    Cc: hpa@zytor.com
    Cc: x86@kernel.org
    Cc: thomas.lendacky@amd.com
    Link: https://lkml.kernel.org/r/2a686b2ac0e2f5a1f2f5f101124d9dd44f949731.1537533369.git.puwen@hygon.cn

diff --git a/arch/x86/include/asm/cacheinfo.h b/arch/x86/include/asm/cacheinfo.h
index e958e28f7ab5..86b63c7feab7 100644
--- a/arch/x86/include/asm/cacheinfo.h
+++ b/arch/x86/include/asm/cacheinfo.h
@@ -3,5 +3,6 @@
 #define _ASM_X86_CACHEINFO_H
 
 void cacheinfo_amd_init_llc_id(struct cpuinfo_x86 *c, int cpu, u8 node_id);
+void cacheinfo_hygon_init_llc_id(struct cpuinfo_x86 *c, int cpu, u8 node_id);
 
 #endif /* _ASM_X86_CACHEINFO_H */

commit 68091ee7ac3c1a8786fe1bebbd616b14236efb99
Author: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Date:   Fri Apr 27 16:34:37 2018 -0500

    x86/CPU/AMD: Calculate last level cache ID from number of sharing threads
    
    Last Level Cache ID can be calculated from the number of threads sharing
    the cache, which is available from CPUID Fn0x8000001D (Cache Properties).
    This is used to left-shift the APIC ID to derive LLC ID.
    
    Therefore, default to this method unless the APIC ID enumeration does not
    follow the scheme.
    
    Signed-off-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Link: http://lkml.kernel.org/r/1524864877-111962-5-git-send-email-suravee.suthikulpanit@amd.com

diff --git a/arch/x86/include/asm/cacheinfo.h b/arch/x86/include/asm/cacheinfo.h
new file mode 100644
index 000000000000..e958e28f7ab5
--- /dev/null
+++ b/arch/x86/include/asm/cacheinfo.h
@@ -0,0 +1,7 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+#ifndef _ASM_X86_CACHEINFO_H
+#define _ASM_X86_CACHEINFO_H
+
+void cacheinfo_amd_init_llc_id(struct cpuinfo_x86 *c, int cpu, u8 node_id);
+
+#endif /* _ASM_X86_CACHEINFO_H */
