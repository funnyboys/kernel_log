commit b4bf274198bd415e66af0b54a2e181c59fd43ba4
Author: Mao Han <han_mao@c-sky.com>
Date:   Wed Apr 10 10:27:10 2019 +0800

    csky: Add perf_arch_fetch_caller_regs support
    
    In trace events as tracepoints context are not able to
    be retrieve with task_pt_regs. Without arch caller regs
    support the pt_regs context will be all zero, perf can
    not parsing the callchain and resolving the symbols
    correctly, some time will even get into deadlock
    while handling the page fault, eg:
    
    perf kmem â€”page record ls
    
    Changelog
     - Add test case cmd in comment
     - Use regs_fp(regs) which is defined in abi/regdef.h
    
    Signed-off-by: Mao Han <han_mao@c-sky.com>
    Signed-off-by: Guo Ren <guoren@kernel.org>

diff --git a/arch/csky/include/asm/perf_event.h b/arch/csky/include/asm/perf_event.h
index ea8193122294..572093e11001 100644
--- a/arch/csky/include/asm/perf_event.h
+++ b/arch/csky/include/asm/perf_event.h
@@ -4,4 +4,12 @@
 #ifndef __ASM_CSKY_PERF_EVENT_H
 #define __ASM_CSKY_PERF_EVENT_H
 
+#include <abi/regdef.h>
+
+#define perf_arch_fetch_caller_regs(regs, __ip) { \
+	(regs)->pc = (__ip); \
+	regs_fp(regs) = (unsigned long) __builtin_frame_address(0); \
+	asm volatile("mov %0, sp\n":"=r"((regs)->usp)); \
+}
+
 #endif /* __ASM_PERF_EVENT_ELF_H */

commit f50fd2d8524c15b08da9e7e9d84752f0f1be7172
Author: Guo Ren <ren_guo@c-sky.com>
Date:   Wed Jan 2 22:09:25 2019 +0800

    csky: Add perf support for C-SKY
    
    This adds basic perf support for all C-SKY CPUs. Hardware events are
    only supported by 807/810/860.
    
    Signed-off-by: Guo Ren <ren_guo@c-sky.com>

diff --git a/arch/csky/include/asm/perf_event.h b/arch/csky/include/asm/perf_event.h
new file mode 100644
index 000000000000..ea8193122294
--- /dev/null
+++ b/arch/csky/include/asm/perf_event.h
@@ -0,0 +1,7 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+// Copyright (C) 2018 Hangzhou C-SKY Microsystems co.,ltd.
+
+#ifndef __ASM_CSKY_PERF_EVENT_H
+#define __ASM_CSKY_PERF_EVENT_H
+
+#endif /* __ASM_PERF_EVENT_ELF_H */
