commit f2f4bf5aabadd6575f5daabcb0a2f506e3f5f68c
Author: Alex Dewar <alex.dewar@gmx.co.uk>
Date:   Sun Aug 25 10:49:19 2019 +0100

    um: Add SPDX headers for files in arch/um/include
    
    Convert files to use SPDX header. All files are licensed under the GPLv2.
    
    Signed-off-by: Alex Dewar <alex.dewar@gmx.co.uk>
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
index 4cff19f6207a..e793e4212f0a 100644
--- a/arch/um/include/shared/user.h
+++ b/arch/um/include/shared/user.h
@@ -1,6 +1,6 @@
+/* SPDX-License-Identifier: GPL-2.0 */
 /* 
  * Copyright (C) 2000 - 2007 Jeff Dike (jdike@{addtoit,linux.intel}.com)
- * Licensed under the GPL
  */
 
 #ifndef __USER_H__

commit 298e20ba8c197e8d429a6c8671550c41c7919033
Author: Richard Weinberger <richard@nod.at>
Date:   Sun May 31 19:50:57 2015 +0200

    um: Stop abusing __KERNEL__
    
    Currently UML is abusing __KERNEL__ to distinguish between
    kernel and host code (os-Linux). It is better to use a custom
    define such that existing users of __KERNEL__ don't get confused.
    
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
index cef068563336..4cff19f6207a 100644
--- a/arch/um/include/shared/user.h
+++ b/arch/um/include/shared/user.h
@@ -17,7 +17,7 @@
 #define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0]))
 
 /* This is to get size_t */
-#ifdef __KERNEL__
+#ifndef __UM_HOST__
 #include <linux/types.h>
 #else
 #include <stddef.h>

commit 9429ec96c2718c0d1e3317cf60a87a0405223814
Author: Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Thu Aug 16 20:15:05 2012 +0200

    um: Preinclude include/linux/kern_levels.h
    
    The userspace part of UML uses the asm-offsets.h generator mechanism to
    create definitions for UM_KERN_<LEVEL> that match the in-kernel
    KERN_<LEVEL> constant definitions.
    
    As of commit 04d2c8c83d0e3ac5f78aeede51babb3236200112 ("printk: convert
    the format for KERN_<LEVEL> to a 2 byte pattern"), KERN_<LEVEL> is no
    longer expanded to the literal '"<LEVEL>"', but to '"\001" "LEVEL"', i.e.
    it contains two parts.
    
    However, the combo of DEFINE_STR() in
    arch/x86/um/shared/sysdep/kernel-offsets.h and sed-y in Kbuild doesn't
    support string literals consisting of multiple parts. Hence for all
    UM_KERN_<LEVEL> definitions, only the SOH character is retained in the actual
    definition, while the remainder ends up in the comment. E.g. in
    include/generated/asm-offsets.h we get
    
        #define UM_KERN_INFO "\001" /* "6" KERN_INFO */
    
    instead of
    
        #define UM_KERN_INFO "\001" "6" /* KERN_INFO */
    
    This causes spurious '^A' output in some kernel messages:
    
        Calibrating delay loop... 4640.76 BogoMIPS (lpj=23203840)
        pid_max: default: 32768 minimum: 301
        Mount-cache hash table entries: 256
        ^AChecking that host ptys support output SIGIO...Yes
        ^AChecking that host ptys support SIGIO on close...No, enabling workaround
        ^AUsing 2.6 host AIO
        NET: Registered protocol family 16
        bio: create slab <bio-0> at 0
        Switching to clocksource itimer
    
    To fix this:
      - Move the mapping from UM_KERN_<LEVEL> to KERN_<LEVEL> from
        arch/um/include/shared/common-offsets.h to
        arch/um/include/shared/user.h, which is preincluded for all userspace
        parts,
      - Preinclude include/linux/kern_levels.h for all userspace parts, to
        obtain the in-kernel KERN_<LEVEL> constant definitions. This doesn't
        violate the kernel/userspace separation, as include/linux/kern_levels.h
        is self-contained and doesn't expose any other kernel internals.
      - Remove the now unused STR() and DEFINE_STR() macros.
    
    Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
index 4fa82c055aab..cef068563336 100644
--- a/arch/um/include/shared/user.h
+++ b/arch/um/include/shared/user.h
@@ -26,6 +26,17 @@
 extern void panic(const char *fmt, ...)
 	__attribute__ ((format (printf, 1, 2)));
 
+/* Requires preincluding include/linux/kern_levels.h */
+#define UM_KERN_EMERG	KERN_EMERG
+#define UM_KERN_ALERT	KERN_ALERT
+#define UM_KERN_CRIT	KERN_CRIT
+#define UM_KERN_ERR	KERN_ERR
+#define UM_KERN_WARNING	KERN_WARNING
+#define UM_KERN_NOTICE	KERN_NOTICE
+#define UM_KERN_INFO	KERN_INFO
+#define UM_KERN_DEBUG	KERN_DEBUG
+#define UM_KERN_CONT	KERN_CONT
+
 #ifdef UML_CONFIG_PRINTK
 extern int printk(const char *fmt, ...)
 	__attribute__ ((format (printf, 1, 2)));

commit 05c46db4d7d51af969e09f9f1adbff66ee2e84b4
Author: Al Viro <viro@ftp.linux.org.uk>
Date:   Thu Aug 18 20:04:59 2011 +0100

    um: take userland definition of barrier() to user.h
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
index 58c058165e00..4fa82c055aab 100644
--- a/arch/um/include/shared/user.h
+++ b/arch/um/include/shared/user.h
@@ -40,4 +40,7 @@ extern int in_aton(char *str);
 extern size_t strlcpy(char *, const char *, size_t);
 extern size_t strlcat(char *, const char *, size_t);
 
+/* Copied from linux/compiler-gcc.h since we can't include it directly */
+#define barrier() __asm__ __volatile__("": : :"memory")
+
 #endif

commit 16b7c5737d2c46c8772ca11ac219273362a9a29e
Author: Al Viro <viro@ftp.linux.org.uk>
Date:   Thu Aug 18 20:01:59 2011 +0100

    um: trim unused junk from user.h
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
index 2d46f6329aea..58c058165e00 100644
--- a/arch/um/include/shared/user.h
+++ b/arch/um/include/shared/user.h
@@ -36,9 +36,7 @@ static inline int printk(const char *fmt, ...)
 }
 #endif
 
-extern void schedule(void);
 extern int in_aton(char *str);
-extern int open_gdb_chan(void);
 extern size_t strlcpy(char *, const char *, size_t);
 extern size_t strlcat(char *, const char *, size_t);
 

commit 9e636452d0714b08e4f8f4c58b76c4b7d15ffffa
Author: Al Viro <viro@ftp.linux.org.uk>
Date:   Thu Aug 18 20:01:49 2011 +0100

    um: get rid of kern_constants.h
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
index 293f7c794faa..2d46f6329aea 100644
--- a/arch/um/include/shared/user.h
+++ b/arch/um/include/shared/user.h
@@ -6,7 +6,7 @@
 #ifndef __USER_H__
 #define __USER_H__
 
-#include "kern_constants.h"
+#include <generated/asm-offsets.h>
 
 /*
  * The usual definition - copied here because the kernel provides its own,

commit 87e299e5c7508a9443f04703f1d0c7f518f79ea9
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Sat Oct 11 18:39:18 2008 -0400

    x86, um: get rid of uml-config.h
    
    Take a few symbols we need into kern_constants.h
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
index 1723fac6f40d..293f7c794faa 100644
--- a/arch/um/include/shared/user.h
+++ b/arch/um/include/shared/user.h
@@ -6,7 +6,7 @@
 #ifndef __USER_H__
 #define __USER_H__
 
-#include "uml-config.h"
+#include "kern_constants.h"
 
 /*
  * The usual definition - copied here because the kernel provides its own,

commit 8569c9140bd41089f9b6be8837ca421102714a90
Author: Al Viro <viro@zeniv.linux.org.uk>
Date:   Sun Aug 17 13:48:37 2008 -0400

    x86, um: take arch/um/include/* out of the way
    
    We can't just plop asm/* into it - userland helpers are built with it
    in search path and seeing asm/* show up there suddenly would be a bad
    idea.
    
    Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

diff --git a/arch/um/include/shared/user.h b/arch/um/include/shared/user.h
new file mode 100644
index 000000000000..1723fac6f40d
--- /dev/null
+++ b/arch/um/include/shared/user.h
@@ -0,0 +1,45 @@
+/* 
+ * Copyright (C) 2000 - 2007 Jeff Dike (jdike@{addtoit,linux.intel}.com)
+ * Licensed under the GPL
+ */
+
+#ifndef __USER_H__
+#define __USER_H__
+
+#include "uml-config.h"
+
+/*
+ * The usual definition - copied here because the kernel provides its own,
+ * fancier, type-safe, definition.  Using that one would require
+ * copying too much infrastructure for my taste, so userspace files
+ * get less checking than kernel files.
+ */
+#define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0]))
+
+/* This is to get size_t */
+#ifdef __KERNEL__
+#include <linux/types.h>
+#else
+#include <stddef.h>
+#endif
+
+extern void panic(const char *fmt, ...)
+	__attribute__ ((format (printf, 1, 2)));
+
+#ifdef UML_CONFIG_PRINTK
+extern int printk(const char *fmt, ...)
+	__attribute__ ((format (printf, 1, 2)));
+#else
+static inline int printk(const char *fmt, ...)
+{
+	return 0;
+}
+#endif
+
+extern void schedule(void);
+extern int in_aton(char *str);
+extern int open_gdb_chan(void);
+extern size_t strlcpy(char *, const char *, size_t);
+extern size_t strlcat(char *, const char *, size_t);
+
+#endif
