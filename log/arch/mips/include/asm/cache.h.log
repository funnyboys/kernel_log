commit ae5b0675942ab30cde96099c68a2290bd1aafcca
Author: Paul Burton <paul.burton@imgtec.com>
Date:   Tue Aug 1 13:32:57 2017 -0700

    Revert "MIPS: Don't unnecessarily include kmalloc.h into <asm/cache.h>."
    
    Commit 296e46db0073 ("MIPS: Don't unnecessarily include kmalloc.h into
    <asm/cache.h>.") claimed that the inclusion of the machine's kmalloc.h
    from asm/cache.h is unnecessary, but this is not true.
    
    Without including kmalloc.h we don't get a definition for
    ARCH_DMA_MINALIGN, which means we no longer suitably align DMA. Further
    to this the definition of ARCH_KMALLOC_MINALIGN provided by linux/slab.h
    ends up being set to the alignment of an unsigned long long value rather
    than to ARCH_DMA_MINALIGN, which means that buffers allocated using
    kmalloc may no longer be safely aligned for use with DMA.
    
    Fix this by re-adding the include of kmalloc.h in asm/cache.h. This
    reverts commit 296e46db0073 ("MIPS: Don't unnecessarily include
    kmalloc.h into <asm/cache.h>.")
    
    Signed-off-by: Paul Burton <paul.burton@imgtec.com>
    Fixes: 296e46db0073 ("MIPS: Don't unnecessarily include kmalloc.h into <asm/cache.h>.")
    Cc: linux-mips@linux-mips.org
    Cc: stable <stable@vger.kernel.org> # v4.12+
    Patchwork: https://patchwork.linux-mips.org/patch/16895/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/include/asm/cache.h b/arch/mips/include/asm/cache.h
index fc67947ed658..8b14c2706aa5 100644
--- a/arch/mips/include/asm/cache.h
+++ b/arch/mips/include/asm/cache.h
@@ -9,6 +9,8 @@
 #ifndef _ASM_CACHE_H
 #define _ASM_CACHE_H
 
+#include <kmalloc.h>
+
 #define L1_CACHE_SHIFT		CONFIG_MIPS_L1_CACHE_SHIFT
 #define L1_CACHE_BYTES		(1 << L1_CACHE_SHIFT)
 

commit 294d62743754f1fefefccccb09f8deec48f00969
Author: Ralf Baechle <ralf@linux-mips.org>
Date:   Tue Mar 21 22:40:43 2017 +0100

    MIPS: Delete redundant definition of SMP_CACHE_BYTES.
    
    <linux/cache.h> already defines SMP_CACHE_BYTES as L1_CACHE_BYTES.
    
    This change results in a build error in <asm/cpu-info.h> which directly
    includes <asm/cache.h>.  Fix this by including <linux/cache.h> instead.
    
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/include/asm/cache.h b/arch/mips/include/asm/cache.h
index d7e314b6be09..fc67947ed658 100644
--- a/arch/mips/include/asm/cache.h
+++ b/arch/mips/include/asm/cache.h
@@ -12,8 +12,6 @@
 #define L1_CACHE_SHIFT		CONFIG_MIPS_L1_CACHE_SHIFT
 #define L1_CACHE_BYTES		(1 << L1_CACHE_SHIFT)
 
-#define SMP_CACHE_BYTES		L1_CACHE_BYTES
-
 #define __read_mostly __attribute__((__section__(".data..read_mostly")))
 
 #endif /* _ASM_CACHE_H */

commit 4437637c3277fa9aba4e443329b5db3b6d34eedf
Author: Ralf Baechle <ralf@linux-mips.org>
Date:   Tue Mar 21 22:14:30 2017 +0100

    MIPS: Delete unused definition of SMP_CACHE_SHIFT.
    
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/include/asm/cache.h b/arch/mips/include/asm/cache.h
index 99d6632c5047..d7e314b6be09 100644
--- a/arch/mips/include/asm/cache.h
+++ b/arch/mips/include/asm/cache.h
@@ -12,7 +12,6 @@
 #define L1_CACHE_SHIFT		CONFIG_MIPS_L1_CACHE_SHIFT
 #define L1_CACHE_BYTES		(1 << L1_CACHE_SHIFT)
 
-#define SMP_CACHE_SHIFT		L1_CACHE_SHIFT
 #define SMP_CACHE_BYTES		L1_CACHE_BYTES
 
 #define __read_mostly __attribute__((__section__(".data..read_mostly")))

commit 296e46db00731b05c796e4f1db4bfe2e0efd80c1
Author: Ralf Baechle <ralf@linux-mips.org>
Date:   Tue Mar 21 22:13:06 2017 +0100

    MIPS: Don't unnecessarily include kmalloc.h into <asm/cache.h>.
    
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/include/asm/cache.h b/arch/mips/include/asm/cache.h
index b4db69fbc40c..99d6632c5047 100644
--- a/arch/mips/include/asm/cache.h
+++ b/arch/mips/include/asm/cache.h
@@ -9,8 +9,6 @@
 #ifndef _ASM_CACHE_H
 #define _ASM_CACHE_H
 
-#include <kmalloc.h>
-
 #define L1_CACHE_SHIFT		CONFIG_MIPS_L1_CACHE_SHIFT
 #define L1_CACHE_BYTES		(1 << L1_CACHE_SHIFT)
 

commit f8bec75acdadd3a6597fe0acb5c3161b71cc2ea0
Author: Catalin Marinas <catalin.marinas@arm.com>
Date:   Tue Mar 29 11:40:06 2011 +0100

    MIPS: Rename .data..mostly and properly handle it in linker script
    
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/include/asm/cache.h b/arch/mips/include/asm/cache.h
index 650ac9ba734c..b4db69fbc40c 100644
--- a/arch/mips/include/asm/cache.h
+++ b/arch/mips/include/asm/cache.h
@@ -17,6 +17,6 @@
 #define SMP_CACHE_SHIFT		L1_CACHE_SHIFT
 #define SMP_CACHE_BYTES		L1_CACHE_BYTES
 
-#define __read_mostly __attribute__((__section__(".data.read_mostly")))
+#define __read_mostly __attribute__((__section__(".data..read_mostly")))
 
 #endif /* _ASM_CACHE_H */

commit 1befdd5536e1500371f7f884d0f0ae528a519333
Author: David Daney <ddaney@caviumnetworks.com>
Date:   Thu Oct 14 12:36:49 2010 -0700

    MIPS: Implement __read_mostly
    
    Just do what everyone else is doing by placing __read_mostly things in
    the .data.read_mostly section.
    
    mips_io_port_base can not be read-only (const) and writable
    (__read_mostly) at the same time.  One of them has to go, so I chose
    to eliminate the __read_mostly.  It will still get stuck in a portion
    of memory that is not adjacent to things that are written, and thus
    not be on a dirty cache line, for whatever that is worth.
    
    Signed-off-by: David Daney <ddaney@caviumnetworks.com>
    To: linux-mips@linux-mips.org
    Patchwork: http://patchwork.linux-mips.org/patch/1702/
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/include/asm/cache.h b/arch/mips/include/asm/cache.h
index 37f175c42bb5..650ac9ba734c 100644
--- a/arch/mips/include/asm/cache.h
+++ b/arch/mips/include/asm/cache.h
@@ -17,4 +17,6 @@
 #define SMP_CACHE_SHIFT		L1_CACHE_SHIFT
 #define SMP_CACHE_BYTES		L1_CACHE_BYTES
 
+#define __read_mostly __attribute__((__section__(".data.read_mostly")))
+
 #endif /* _ASM_CACHE_H */

commit 384740dc49ea651ba350704d13ff6be9976e37fe
Author: Ralf Baechle <ralf@linux-mips.org>
Date:   Tue Sep 16 19:48:51 2008 +0200

    MIPS: Move headfiles to new location below arch/mips/include
    
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/include/asm/cache.h b/arch/mips/include/asm/cache.h
new file mode 100644
index 000000000000..37f175c42bb5
--- /dev/null
+++ b/arch/mips/include/asm/cache.h
@@ -0,0 +1,20 @@
+/*
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License.  See the file "COPYING" in the main directory of this archive
+ * for more details.
+ *
+ * Copyright (C) 1997, 98, 99, 2000, 2003 Ralf Baechle
+ * Copyright (C) 1999 Silicon Graphics, Inc.
+ */
+#ifndef _ASM_CACHE_H
+#define _ASM_CACHE_H
+
+#include <kmalloc.h>
+
+#define L1_CACHE_SHIFT		CONFIG_MIPS_L1_CACHE_SHIFT
+#define L1_CACHE_BYTES		(1 << L1_CACHE_SHIFT)
+
+#define SMP_CACHE_SHIFT		L1_CACHE_SHIFT
+#define SMP_CACHE_BYTES		L1_CACHE_BYTES
+
+#endif /* _ASM_CACHE_H */
