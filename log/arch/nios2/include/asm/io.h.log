commit 3f3ded99aecf3498ac9a976ec2b02cf5c6281bd4
Author: Christoph Hellwig <hch@lst.de>
Date:   Tue Aug 13 08:11:46 2019 +0200

    nios2: remove __iounmap
    
    No need to indirect iounmap for nios2.
    
    Signed-off-by: Christoph Hellwig <hch@lst.de>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index d108937c321e..746853ac7d8d 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -26,12 +26,7 @@
 #define writel_relaxed(x, addr)	writel(x, addr)
 
 void __iomem *ioremap(unsigned long physaddr, unsigned long size);
-extern void __iounmap(void __iomem *addr);
-
-static inline void iounmap(void __iomem *addr)
-{
-	__iounmap(addr);
-}
+void iounmap(void __iomem *addr);
 
 /* Pages to physical address... */
 #define page_to_phys(page)	virt_to_phys(page_to_virt(page))

commit d092a87073269677b7ff09e71a8d91912b7f969a
Author: Christoph Hellwig <hch@lst.de>
Date:   Wed Oct 16 08:09:38 2019 +0200

    arch: rely on asm-generic/io.h for default ioremap_* definitions
    
    Various architectures that use asm-generic/io.h still defined their
    own default versions of ioremap_nocache, ioremap_wt and ioremap_wc
    that point back to plain ioremap directly or indirectly.  Remove these
    definitions and rely on asm-generic/io.h instead.  For this to work
    the backup ioremap_* defintions needs to be changed to purely cpp
    macros instea of inlines to cover for architectures like openrisc
    that only define ioremap after including <asm-generic/io.h>.
    
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Reviewed-by: Arnd Bergmann <arnd@arndb.de>
    Reviewed-by: Palmer Dabbelt <palmer@dabbelt.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index 74ab34aa6731..d108937c321e 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -33,10 +33,6 @@ static inline void iounmap(void __iomem *addr)
 	__iounmap(addr);
 }
 
-#define ioremap_nocache ioremap
-#define ioremap_wc ioremap
-#define ioremap_wt ioremap
-
 /* Pages to physical address... */
 #define page_to_phys(page)	virt_to_phys(page_to_virt(page))
 

commit 5ace77e0b41af6b9a3a8cd189a79270e8840fe0a
Author: Christoph Hellwig <hch@lst.de>
Date:   Wed Aug 7 18:56:08 2019 +0300

    nios2: remove __ioremap
    
    The cacheflag argument to __ioremap is always 0, so just implement
    ioremap directly.
    
    Signed-off-by: Christoph Hellwig <hch@lst.de>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index 9010243077ab..74ab34aa6731 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -25,29 +25,17 @@
 #define writew_relaxed(x, addr)	writew(x, addr)
 #define writel_relaxed(x, addr)	writel(x, addr)
 
-extern void __iomem *__ioremap(unsigned long physaddr, unsigned long size,
-			unsigned long cacheflag);
+void __iomem *ioremap(unsigned long physaddr, unsigned long size);
 extern void __iounmap(void __iomem *addr);
 
-static inline void __iomem *ioremap(unsigned long physaddr, unsigned long size)
-{
-	return __ioremap(physaddr, size, 0);
-}
-
-static inline void __iomem *ioremap_nocache(unsigned long physaddr,
-						unsigned long size)
-{
-	return __ioremap(physaddr, size, 0);
-}
-
 static inline void iounmap(void __iomem *addr)
 {
 	__iounmap(addr);
 }
 
-#define ioremap_nocache ioremap_nocache
-#define ioremap_wc ioremap_nocache
-#define ioremap_wt ioremap_nocache
+#define ioremap_nocache ioremap
+#define ioremap_wc ioremap
+#define ioremap_wt ioremap
 
 /* Pages to physical address... */
 #define page_to_phys(page)	virt_to_phys(page_to_virt(page))

commit c601a89115cbc3ccd51468295d28cfae47cc5410
Author: Greentime Hu <greentime@andestech.com>
Date:   Thu Mar 1 10:55:54 2018 +0800

    nios2: add ioremap_nocache declaration before include asm-generic/io.h.
    
    A commit for the nds32 architecture bootstrap("asm-generic/io.h:
    move ioremap_nocache/ioremap_uc/ioremap_wc/ioremap_wt out of ifndef
    CONFIG_MMU") will move the ioremap_nocache out of the CONFIG_MMU ifdef.
    This means that in order to suppress re-definition errors we need to
    setup #define's before importing asm-generic/io.h.
    
    Signed-off-by: Greentime Hu <greentime@andestech.com>
    Reviewed-by: Tobias Klauser <tklauser@distanz.ch>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index ce072ba0f8dd..9010243077ab 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -45,6 +45,7 @@ static inline void iounmap(void __iomem *addr)
 	__iounmap(addr);
 }
 
+#define ioremap_nocache ioremap_nocache
 #define ioremap_wc ioremap_nocache
 #define ioremap_wt ioremap_nocache
 

commit 046982c760bcbb0d92981a7be577dbc081323a78
Author: Ard Biesheuvel <ard.biesheuvel@linaro.org>
Date:   Mon Apr 18 18:04:55 2016 +0200

    nios2: use correct void* return type for page_to_virt()
    
    To align with other architectures, the expression produced by expanding
    the macro page_to_virt() should be of type void*, since it returns a
    virtual address. Fix that, and also fix up an instance where page_to_virt
    was expected to return 'unsigned long', and drop another instance that was
    entirely unused (page_to_bus)
    
    Acked-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Will Deacon <will.deacon@arm.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index c5a62da22cd2..ce072ba0f8dd 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -50,7 +50,6 @@ static inline void iounmap(void __iomem *addr)
 
 /* Pages to physical address... */
 #define page_to_phys(page)	virt_to_phys(page_to_virt(page))
-#define page_to_bus(page)	page_to_virt(page)
 
 /* Macros used for converting between virtual and physical mappings. */
 #define phys_to_virt(vaddr)	\

commit 556269c138a8b2d3f5714b8105fa6119ecc505f2
Author: Toshi Kani <toshi.kani@hp.com>
Date:   Thu Jun 4 18:55:16 2015 +0200

    arch/*/io.h: Add ioremap_wt() to all architectures
    
    Add ioremap_wt() to all arch-specific asm/io.h headers which
    define ioremap_wc() locally. These headers do not include
    <asm-generic/iomap.h>. Some of them include <asm-generic/io.h>,
    but ioremap_wt() is defined for consistency since they define
    all ioremap_xxx locally.
    
    In all architectures without Write-Through support, ioremap_wt()
    is defined indentical to ioremap_nocache().
    
    frv and m68k already have ioremap_writethrough(). On those we
    add ioremap_wt() indetical to ioremap_writethrough() and defines
    ARCH_HAS_IOREMAP_WT in both architectures.
    
    The ioremap_wt() interface is exported to drivers.
    
    Signed-off-by: Toshi Kani <toshi.kani@hp.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    Cc: Andy Lutomirski <luto@amacapital.net>
    Cc: Elliott@hp.com
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Luis R. Rodriguez <mcgrof@suse.com>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: arnd@arndb.de
    Cc: hch@lst.de
    Cc: hmh@hmh.eng.br
    Cc: jgross@suse.com
    Cc: konrad.wilk@oracle.com
    Cc: linux-mm <linux-mm@kvack.org>
    Cc: linux-nvdimm@lists.01.org
    Cc: stefan.bader@canonical.com
    Cc: yigal@plexistor.com
    Link: http://lkml.kernel.org/r/1433436928-31903-9-git-send-email-bp@alien8.de
    Signed-off-by: Ingo Molnar <mingo@kernel.org>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index 6e24d7cceb0c..c5a62da22cd2 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -46,6 +46,7 @@ static inline void iounmap(void __iomem *addr)
 }
 
 #define ioremap_wc ioremap_nocache
+#define ioremap_wt ioremap_nocache
 
 /* Pages to physical address... */
 #define page_to_phys(page)	virt_to_phys(page_to_virt(page))

commit 76367a52d3cbf78f254fee0479824014c8dfb4dc
Author: Guenter Roeck <linux@roeck-us.net>
Date:   Thu Dec 11 10:36:42 2014 +0800

    nios2: add definition of ioremap_wc to io.h
    
    Fix
    
    drivers/gpu/drm/drm_bufs.c: In function 'drm_addmap_core':
    drivers/gpu/drm/drm_bufs.c:213:5:
                            error: implicit declaration of function 'ioremap_wc'
    
    seen when building nios2:allmodconfig.
    
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Acked-by: Ley Foon Tan <lftan@altera.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index 9102bfd3fa1c..6e24d7cceb0c 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -45,6 +45,8 @@ static inline void iounmap(void __iomem *addr)
 	__iounmap(addr);
 }
 
+#define ioremap_wc ioremap_nocache
+
 /* Pages to physical address... */
 #define page_to_phys(page)	virt_to_phys(page_to_virt(page))
 #define page_to_bus(page)	page_to_virt(page)

commit 61810325176d1eefeb074430cc8b01e43ee0c18c
Author: Ley Foon Tan <lftan@altera.com>
Date:   Thu Nov 20 19:01:43 2014 +0800

    nios2: include linux/type.h in io.h
    
    This is require for __iomem definition.
    
    Signed-off-by: Ley Foon Tan <lftan@altera.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index c5cf8ea12ef8..9102bfd3fa1c 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -11,6 +11,7 @@
 #ifndef _ASM_NIOS2_IO_H
 #define _ASM_NIOS2_IO_H
 
+#include <linux/types.h>
 #include <asm/pgtable-bits.h>
 
 /* PCI is not supported in nios2, set this to 0. */

commit 065a1134c98758f2368bca43cc3895710ed3f81a
Author: Ley Foon Tan <lftan@altera.com>
Date:   Thu Nov 20 19:04:41 2014 +0800

    nios2: move include asm-generic/io.h to end of file
    
    Move asm-generic/io.h to end of file to override functions like
    phys_to_virt, virt_to_phys in asm-generic/io.h.
    This is due to recent commit 9216efaf introduced new way to
    override functions by checking for the existence of a macro with the
    same of the function.
    
    Signed-off-by: Ley Foon Tan <lftan@altera.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index 94cd30ae8254..c5cf8ea12ef8 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -24,8 +24,6 @@
 #define writew_relaxed(x, addr)	writew(x, addr)
 #define writel_relaxed(x, addr)	writel(x, addr)
 
-#include <asm-generic/io.h>
-
 extern void __iomem *__ioremap(unsigned long physaddr, unsigned long size,
 			unsigned long cacheflag);
 extern void __iounmap(void __iomem *addr);
@@ -57,4 +55,6 @@ static inline void iounmap(void __iomem *addr)
 #define virt_to_phys(vaddr)	\
 	((unsigned long)((unsigned long)(vaddr) & ~0xE0000000))
 
+#include <asm-generic/io.h>
+
 #endif /* _ASM_NIOS2_IO_H */

commit 25f232536cb922c470abab4077231907cacf1c3b
Author: Ley Foon Tan <lftan@altera.com>
Date:   Thu Nov 20 18:52:04 2014 +0800

    nios2: remove include asm-generic/iomap.h from io.h
    
    Don't need asm-generic/iomap.h and asm-generic/io.h added
    default ioread8/16/32 iowrite8/16/32 implementation.
    
    Signed-off-by: Ley Foon Tan <lftan@altera.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index 65583ee4561a..94cd30ae8254 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -12,7 +12,6 @@
 #define _ASM_NIOS2_IO_H
 
 #include <asm/pgtable-bits.h>
-#include <asm-generic/iomap.h>
 
 /* PCI is not supported in nios2, set this to 0. */
 #define IO_SPACE_LIMIT 0

commit 568f6ba03c5ecba5c6dd13e51554c205172ebdaf
Author: Ley Foon Tan <lftan@altera.com>
Date:   Thu Nov 20 18:44:56 2014 +0800

    nios2: remove unnecessary space before define
    
    Remove extra space between # and define.
    
    Signed-off-by: Ley Foon Tan <lftan@altera.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
index 13dc22b50800..65583ee4561a 100644
--- a/arch/nios2/include/asm/io.h
+++ b/arch/nios2/include/asm/io.h
@@ -48,14 +48,14 @@ static inline void iounmap(void __iomem *addr)
 }
 
 /* Pages to physical address... */
-# define page_to_phys(page)	virt_to_phys(page_to_virt(page))
-# define page_to_bus(page)	page_to_virt(page)
+#define page_to_phys(page)	virt_to_phys(page_to_virt(page))
+#define page_to_bus(page)	page_to_virt(page)
 
 /* Macros used for converting between virtual and physical mappings. */
-# define phys_to_virt(vaddr)	\
+#define phys_to_virt(vaddr)	\
 	((void *)((unsigned long)(vaddr) | CONFIG_NIOS2_KERNEL_REGION_BASE))
 /* Clear top 3 bits */
-# define virt_to_phys(vaddr)	\
+#define virt_to_phys(vaddr)	\
 	((unsigned long)((unsigned long)(vaddr) & ~0xE0000000))
 
 #endif /* _ASM_NIOS2_IO_H */

commit 6b8baec4d652df19be6e0997c50b9894e5ca30a8
Author: Ley Foon Tan <lftan@altera.com>
Date:   Thu Nov 6 15:19:42 2014 +0800

    nios2: I/O Mapping
    
    This patch adds several definitions for I/O accessors and ioremap().
    
    Signed-off-by: Ley Foon Tan <lftan@altera.com>

diff --git a/arch/nios2/include/asm/io.h b/arch/nios2/include/asm/io.h
new file mode 100644
index 000000000000..13dc22b50800
--- /dev/null
+++ b/arch/nios2/include/asm/io.h
@@ -0,0 +1,61 @@
+/*
+ * Copyright (C) 2014 Altera Corporation
+ * Copyright (C) 2010 Tobias Klauser <tklauser@distanz.ch>
+ * Copyright (C) 2004 Microtronix Datacom Ltd.
+ *
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License. See the file "COPYING" in the main directory of this archive
+ * for more details.
+ */
+
+#ifndef _ASM_NIOS2_IO_H
+#define _ASM_NIOS2_IO_H
+
+#include <asm/pgtable-bits.h>
+#include <asm-generic/iomap.h>
+
+/* PCI is not supported in nios2, set this to 0. */
+#define IO_SPACE_LIMIT 0
+
+#define readb_relaxed(addr)	readb(addr)
+#define readw_relaxed(addr)	readw(addr)
+#define readl_relaxed(addr)	readl(addr)
+
+#define writeb_relaxed(x, addr)	writeb(x, addr)
+#define writew_relaxed(x, addr)	writew(x, addr)
+#define writel_relaxed(x, addr)	writel(x, addr)
+
+#include <asm-generic/io.h>
+
+extern void __iomem *__ioremap(unsigned long physaddr, unsigned long size,
+			unsigned long cacheflag);
+extern void __iounmap(void __iomem *addr);
+
+static inline void __iomem *ioremap(unsigned long physaddr, unsigned long size)
+{
+	return __ioremap(physaddr, size, 0);
+}
+
+static inline void __iomem *ioremap_nocache(unsigned long physaddr,
+						unsigned long size)
+{
+	return __ioremap(physaddr, size, 0);
+}
+
+static inline void iounmap(void __iomem *addr)
+{
+	__iounmap(addr);
+}
+
+/* Pages to physical address... */
+# define page_to_phys(page)	virt_to_phys(page_to_virt(page))
+# define page_to_bus(page)	page_to_virt(page)
+
+/* Macros used for converting between virtual and physical mappings. */
+# define phys_to_virt(vaddr)	\
+	((void *)((unsigned long)(vaddr) | CONFIG_NIOS2_KERNEL_REGION_BASE))
+/* Clear top 3 bits */
+# define virt_to_phys(vaddr)	\
+	((unsigned long)((unsigned long)(vaddr) & ~0xE0000000))
+
+#endif /* _ASM_NIOS2_IO_H */
