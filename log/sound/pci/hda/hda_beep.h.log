commit 45571bb871b217f1031045a27d935ea7c6ea5d12
Author: Takashi Iwai <tiwai@suse.de>
Date:   Thu Jan 24 09:45:36 2019 +0100

    ALSA: hda - Use standard device registration for beep
    
    Currently the registration and free of beep input device was done
    manually from the register and the disconnect callbacks of the
    assigned codec object.  This seems working in most cases, but this may
    be a cause of some races at probe.  Moreover, due to these manual
    calls, the total code became unnecessarily lengthy.
    
    This patch rewrites the beep registration code to follow the standard
    sound device object style.  This allows us reducing the code, in
    addition to avoiding the nested device registration calls.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index f1457c6b3969..a25358a4807a 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -34,7 +34,6 @@ struct hda_beep {
 int snd_hda_enable_beep_device(struct hda_codec *codec, int enable);
 int snd_hda_attach_beep_device(struct hda_codec *codec, int nid);
 void snd_hda_detach_beep_device(struct hda_codec *codec);
-int snd_hda_register_beep_device(struct hda_codec *codec);
 #else
 static inline int snd_hda_attach_beep_device(struct hda_codec *codec, int nid)
 {
@@ -43,9 +42,5 @@ static inline int snd_hda_attach_beep_device(struct hda_codec *codec, int nid)
 static inline void snd_hda_detach_beep_device(struct hda_codec *codec)
 {
 }
-static inline int snd_hda_register_beep_device(struct hda_codec *codec)
-{
-	return 0;
-}
 #endif
 #endif

commit be57bfffb7b5ba72e1293643053f8861fcaa5163
Author: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Date:   Wed Aug 22 15:24:57 2018 -0500

    ALSA: hda: move hda_codec.h to include/sound
    
    As suggested by Takashi, move this header file to make it easier
    to include from e.g. the Intel Skylake driver in follow-up patches
    
    Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index d1a6a9c1329a..f1457c6b3969 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -9,7 +9,7 @@
 #ifndef __SOUND_HDA_BEEP_H
 #define __SOUND_HDA_BEEP_H
 
-#include "hda_codec.h"
+#include <sound/hda_codec.h>
 
 #define HDA_BEEP_MODE_OFF	0
 #define HDA_BEEP_MODE_ON	1

commit 248a380a3c2e7e3363f26c17b6923b430cf6463e
Author: Matt Ranostay <matt.ranostay@konsulko.com>
Date:   Fri Feb 16 21:53:15 2018 -0800

    ALSA: hda-beep: add SPDX identifiers
    
    Add SPDX GPLv2.0+ identifiers and update authors email
    
    Signed-off-by: Matt Ranostay <matt.ranostay@konsulko.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 1052ad380e97..d1a6a9c1329a 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -1,22 +1,9 @@
+/* SPDX-License-Identifier: GPL-2.0+ */
 /*
  * Digital Beep Input Interface for HD-audio codec
  *
- * Author: Matt Ranostay <mranostay@gmail.com>
+ * Author: Matt Ranostay <matt.ranostay@konsulko.com>
  * Copyright (c) 2008 Embedded Alley Solutions Inc
- *
- *  This driver is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This driver is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
  */
 
 #ifndef __SOUND_HDA_BEEP_H

commit f267f9dff8ba00a8b11f340da3634858ad50ebab
Author: Matt Ranostay <mranostay@gmail.com>
Date:   Fri Jun 19 23:46:16 2015 -0700

    ALSA: hda-beep: Update authors dead email address
    
    Signed-off-by: Matt Ranostay <mranostay@gmail.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 46524ff7e79e..1052ad380e97 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -1,7 +1,7 @@
 /*
  * Digital Beep Input Interface for HD-audio codec
  *
- * Author: Matthew Ranostay <mranostay@embeddedalley.com>
+ * Author: Matt Ranostay <mranostay@gmail.com>
  * Copyright (c) 2008 Embedded Alley Solutions Inc
  *
  *  This driver is free software; you can redistribute it and/or modify

commit 5ccf835cc76d89bc0d426659c63d81f609050842
Author: Takashi Iwai <tiwai@suse.de>
Date:   Wed Mar 18 09:23:10 2015 +0100

    ALSA: hda - Adjust power of beep widget and outputs
    
    As the widget PM may turn off the pins, this might lead to the silent
    output for beep when no explicit paths are given.  This patch adds
    fake output paths for the beep widget so that the output pins are
    dynamically powered upon beep on/off.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index a63b5e077332..46524ff7e79e 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -40,6 +40,7 @@ struct hda_beep {
 	unsigned int playing:1;
 	struct work_struct beep_work; /* scheduled task for beep event */
 	struct mutex mutex;
+	void (*power_hook)(struct hda_beep *beep, bool on);
 };
 
 #ifdef CONFIG_SND_HDA_INPUT_BEEP

commit d604b3990884062873e3bef09ef5e89857c409c3
Author: Takashi Iwai <tiwai@suse.de>
Date:   Fri Feb 28 13:42:09 2014 +0100

    ALSA: hda - Fix registration of beep input device
    
    The beep input device is registered via input_register_device(), but
    this is called in snd_hda_attach_beep_device() where the sound devices
    aren't registered yet.  This leads to the binding to non-existing
    object, thus results in failure.  And, even if the binding worked
    (against the PCI object), it's still racy; the input device appears
    before the sound objects.
    
    For fixing this, register the input device properly at dev_register
    ops of the codec object it's bound with.  Also, call
    snd_hda_detach_beep_device() at dev_disconnection so that it's
    detached at the right timing.  As a bonus, since it's called in the
    codec's ops, we can get rid of the further call from the other codec
    drivers.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index cb88464676b6..a63b5e077332 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -34,6 +34,7 @@ struct hda_beep {
 	char phys[32];
 	int tone;
 	hda_nid_t nid;
+	unsigned int registered:1;
 	unsigned int enabled:1;
 	unsigned int linear_tone:1;	/* linear tone for IDT/STAC codec */
 	unsigned int playing:1;
@@ -45,6 +46,7 @@ struct hda_beep {
 int snd_hda_enable_beep_device(struct hda_codec *codec, int enable);
 int snd_hda_attach_beep_device(struct hda_codec *codec, int nid);
 void snd_hda_detach_beep_device(struct hda_codec *codec);
+int snd_hda_register_beep_device(struct hda_codec *codec);
 #else
 static inline int snd_hda_attach_beep_device(struct hda_codec *codec, int nid)
 {
@@ -53,5 +55,9 @@ static inline int snd_hda_attach_beep_device(struct hda_codec *codec, int nid)
 static inline void snd_hda_detach_beep_device(struct hda_codec *codec)
 {
 }
+static inline int snd_hda_register_beep_device(struct hda_codec *codec)
+{
+	return 0;
+}
 #endif
 #endif

commit e914b25e370a3a55a839ff507ed779f54431ace5
Author: Takashi Iwai <tiwai@suse.de>
Date:   Mon Mar 18 11:29:56 2013 +0100

    ALSA: hda - Fix power-saving during playing beep sound
    
    While playing the digital beep tone, the codec shouldn't be turned
    off.  This patch adds proper snd_hda_power_up()/down() calls at each
    time when the beep is played or off.
    
    Also, this fixes automatically an unnecessary codec power-up at
    detaching the beep device when the beep isn't being played.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 4dc6933bc655..cb88464676b6 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -36,6 +36,7 @@ struct hda_beep {
 	hda_nid_t nid;
 	unsigned int enabled:1;
 	unsigned int linear_tone:1;	/* linear tone for IDT/STAC codec */
+	unsigned int playing:1;
 	struct work_struct beep_work; /* scheduled task for beep event */
 	struct mutex mutex;
 };

commit 257dfb410070b48e377c7894222b73ca41d662e0
Author: Takashi Iwai <tiwai@suse.de>
Date:   Tue Jul 3 17:35:05 2012 +0200

    ALSA: hda - Get rid of superfluous beep->mode field
    
    It's no longer necessary since beep_mode=2 option was dropped.
    It can be checked simply via codec->beep != NULL.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 30e79d16f9f8..4dc6933bc655 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -31,7 +31,6 @@
 struct hda_beep {
 	struct input_dev *dev;
 	struct hda_codec *codec;
-	unsigned int mode;
 	char phys[32];
 	int tone;
 	hda_nid_t nid;

commit 0920c9b4c4d896025a560e4510d473dfd41c3dcd
Author: Takashi Iwai <tiwai@suse.de>
Date:   Tue Jul 3 16:58:48 2012 +0200

    ALSA: hda - Remove beep_mode=2
    
    The beep_mode=2 option was introduced to make the beep mixer
    controlling the beep input allocation/deallocation dynamically, so
    that a user can switch between HD-audio codec digital beep and the
    system beep only via mixer API.  This was necessary because the
    keyboard driver took only the first input beep instance at that time.
    
    However, the recent keyboard driver already processes the multiple
    input instances, thus there is no point to keep this mode.
    
    Let's remove it.
    
    Acked-by: Jaroslav Kysela <perex@perex.cz>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 55f0647458c7..30e79d16f9f8 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -26,7 +26,6 @@
 
 #define HDA_BEEP_MODE_OFF	0
 #define HDA_BEEP_MODE_ON	1
-#define HDA_BEEP_MODE_SWREG	2
 
 /* beep information */
 struct hda_beep {
@@ -37,10 +36,7 @@ struct hda_beep {
 	int tone;
 	hda_nid_t nid;
 	unsigned int enabled:1;
-	unsigned int request_enable:1;
 	unsigned int linear_tone:1;	/* linear tone for IDT/STAC codec */
-	struct work_struct register_work; /* registration work */
-	struct delayed_work unregister_work; /* unregistration work */
 	struct work_struct beep_work; /* scheduled task for beep event */
 	struct mutex mutex;
 };

commit ca2585afa013ec2cf99a48e46d6b82df2e240493
Author: Takashi Iwai <tiwai@suse.de>
Date:   Tue Jun 14 08:14:32 2011 +0200

    ALSA: hda - Fix missing static inline to beep dummy function
    
    The commit 2308f4add3de9f6c9c9f02e49461e94d84bb200a missed static inline
    thus it resulted in multiple-definitions error at linking.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 4967eabe774e..55f0647458c7 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -54,7 +54,7 @@ static inline int snd_hda_attach_beep_device(struct hda_codec *codec, int nid)
 {
 	return 0;
 }
-void snd_hda_detach_beep_device(struct hda_codec *codec)
+static inline void snd_hda_detach_beep_device(struct hda_codec *codec)
 {
 }
 #endif

commit 2308f4add3de9f6c9c9f02e49461e94d84bb200a
Author: Joe Perches <joe@perches.com>
Date:   Sun Jun 12 13:02:43 2011 -0700

    ALSA: hda - Fix beep_device compilation warnings
    
    Using static inline functions can reduce compilation messages
    and macro misuse.
    
     sound/pci/hda/patch_conexant.c: In function ‘patch_cxt5045’:
     sound/pci/hda/patch_conexant.c:1232:3: warning: statement with no effect
    
    Signed-off-by: Joe Perches <joe@perches.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index f1de1bac042c..4967eabe774e 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -50,7 +50,12 @@ int snd_hda_enable_beep_device(struct hda_codec *codec, int enable);
 int snd_hda_attach_beep_device(struct hda_codec *codec, int nid);
 void snd_hda_detach_beep_device(struct hda_codec *codec);
 #else
-#define snd_hda_attach_beep_device(...)		0
-#define snd_hda_detach_beep_device(...)
+static inline int snd_hda_attach_beep_device(struct hda_codec *codec, int nid)
+{
+	return 0;
+}
+void snd_hda_detach_beep_device(struct hda_codec *codec)
+{
+}
 #endif
 #endif

commit 9bb1fe390de3e1def0dd162dbdaf62e0981105fa
Author: Takashi Iwai <tiwai@suse.de>
Date:   Mon Nov 16 15:33:49 2009 +0100

    ALSA: hda - Fix beep_mode option value
    
    The beep_mode option value was wrongly defined: it must be 0 = off and
    1 = on.
    
    Also, evaluate the beep_mode value at snd_hda_attach_beep_device()
    properly so that no device is created when beep_mode=0 is given.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 17dd1c325e32..f1de1bac042c 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -24,8 +24,8 @@
 
 #include "hda_codec.h"
 
-#define HDA_BEEP_MODE_ON	0
-#define HDA_BEEP_MODE_OFF	1
+#define HDA_BEEP_MODE_OFF	0
+#define HDA_BEEP_MODE_ON	1
 #define HDA_BEEP_MODE_SWREG	2
 
 /* beep information */

commit 2dca0bba70ce3c233be152e384580c134935332d
Author: Jaroslav Kysela <perex@perex.cz>
Date:   Fri Nov 13 18:41:52 2009 +0100

    ALSA: hda - add beep_mode module parameter
    
    The beep_mode parameter for snd-hda-intel module allows to choose among
    different digital beep device registation to the input layer.
    
    0 = do not register to the input layer
    1 = register to the input layer all time
    2 = use "Beep Switch" control exported to user space mixer applications
    
    Also, introduce CONFIG_SND_HDA_INPUT_BEEP_MODE for default value.
    
    Signed-off-by: Jaroslav Kysela <perex@perex.cz>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 53eba8d8414d..17dd1c325e32 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -24,10 +24,15 @@
 
 #include "hda_codec.h"
 
+#define HDA_BEEP_MODE_ON	0
+#define HDA_BEEP_MODE_OFF	1
+#define HDA_BEEP_MODE_SWREG	2
+
 /* beep information */
 struct hda_beep {
 	struct input_dev *dev;
 	struct hda_codec *codec;
+	unsigned int mode;
 	char phys[32];
 	int tone;
 	hda_nid_t nid;

commit 13dab0808bb41b18888e1758a060a685deee1f30
Author: Jaroslav Kysela <perex@perex.cz>
Date:   Tue Nov 3 14:29:50 2009 +0100

    ALSA: hda_intel: Digital PC Beep - delay input device unregistration
    
    The massive register/unregister calls for input device layer might be
    overkill. Delay unregister call by one HZ as workaround.
    
    Also, as benefit, beep->enabled variable is changed immediately now
    (not from workqueue).
    
    Signed-off-by: Jaroslav Kysela <perex@perex.cz>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 68465f679d8c..53eba8d8414d 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -34,7 +34,8 @@ struct hda_beep {
 	unsigned int enabled:1;
 	unsigned int request_enable:1;
 	unsigned int linear_tone:1;	/* linear tone for IDT/STAC codec */
-	struct work_struct register_work; /* scheduled task for beep event */
+	struct work_struct register_work; /* registration work */
+	struct delayed_work unregister_work; /* unregistration work */
 	struct work_struct beep_work; /* scheduled task for beep event */
 	struct mutex mutex;
 };

commit 123c07aeddd71fbb295842a8c19866e780b9a100
Author: Jaroslav Kysela <perex@perex.cz>
Date:   Wed Oct 21 14:48:23 2009 +0200

    ALSA: hda_intel: Digital PC Beep - change behaviour for input layer
    
    Original implementation was keeping registered input device for SND_BEEP
    and SND_TONE events all time. This patch changes this behaviour:
    If digital PC Beep is turned off using universal control switch,
    the input device is unregistered.
    
    Explanation: The kd_mksound() send SND_BEEP and SND_TONE only to last
    registered device acceping those events. It means that the HDA Intel
    audio driver blocks also the internal PC Speaker device (pcspkr.c
    driver) even if the HDA Beep is muted. The user can easy disable
    all beeps using 'setterm -blength 0' or 'xset b off' command.
    
    Signed-off-by: Jaroslav Kysela <perex@perex.cz>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 0c3de787c717..68465f679d8c 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -32,11 +32,15 @@ struct hda_beep {
 	int tone;
 	hda_nid_t nid;
 	unsigned int enabled:1;
+	unsigned int request_enable:1;
 	unsigned int linear_tone:1;	/* linear tone for IDT/STAC codec */
+	struct work_struct register_work; /* scheduled task for beep event */
 	struct work_struct beep_work; /* scheduled task for beep event */
+	struct mutex mutex;
 };
 
 #ifdef CONFIG_SND_HDA_INPUT_BEEP
+int snd_hda_enable_beep_device(struct hda_codec *codec, int enable);
 int snd_hda_attach_beep_device(struct hda_codec *codec, int nid);
 void snd_hda_detach_beep_device(struct hda_codec *codec);
 #else

commit fa7979663190240b838ab8c8bad7f59e618bf77c
Author: Takashi Iwai <tiwai@suse.de>
Date:   Tue May 19 12:50:04 2009 +0200

    ALSA: hda - Fix digital beep tone calculation
    
    The digital beep tone is calculated in two different ways depending
    on the codec chip.  The standard one is using a divider, and another
    one is a linear tone for IDT/STAC codecs.  Currently, only the
    latter type is used for all codecs, which resulted in a wrong tone
    pitch.
    
    This patch adds the calculation of the standard HD-audio type.
    Also clean-up the fields in hda_beep struct.
    
    Reference: bko#13162
            http://bugzilla.kernel.org/show_bug.cgi?id=13162
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index 51bf6a5daf39..0c3de787c717 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -30,8 +30,9 @@ struct hda_beep {
 	struct hda_codec *codec;
 	char phys[32];
 	int tone;
-	int nid;
-	int enabled;
+	hda_nid_t nid;
+	unsigned int enabled:1;
+	unsigned int linear_tone:1;	/* linear tone for IDT/STAC codec */
 	struct work_struct beep_work; /* scheduled task for beep event */
 };
 

commit 680cd53652d8bfb2b97d8c0248d1afb82de6b61d
Author: Kusanagi Kouichi <slash@ma.neweb.ne.jp>
Date:   Thu Feb 5 00:00:58 2009 +0900

    ALSA: hda: Add digital beep generator support for Realtek codecs.
    
    A digital beep generator can be used via input layer.
    
    Signed-off-by: Kusanagi Kouichi <slash@ma.neweb.ne.jp>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index b9679f081cae..51bf6a5daf39 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -39,7 +39,7 @@ struct hda_beep {
 int snd_hda_attach_beep_device(struct hda_codec *codec, int nid);
 void snd_hda_detach_beep_device(struct hda_codec *codec);
 #else
-#define snd_hda_attach_beep_device(...)
+#define snd_hda_attach_beep_device(...)		0
 #define snd_hda_detach_beep_device(...)
 #endif
 #endif

commit 4d4e9bb339cfcde7811af10859ba1ce2fe3d46b4
Author: Takashi Iwai <tiwai@suse.de>
Date:   Wed Nov 12 16:45:04 2008 +0100

    ALSA: hda - Add digital beep playback switch for STAC/IDT codecs
    
    The digital beep widget may have no mute control, and always enabling
    the beep is ofen pretty annoying, especially on laptops.
    
    This patch adds a mixer control "PC Beep Playback Switch" when there
    is no mixer amp mute is found, and controls it on software.
    
    Reference: Novell bnc#444572
            https://bugzilla.novell.com/show_bug.cgi?id=444572
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
index de4036e6e710..b9679f081cae 100644
--- a/sound/pci/hda/hda_beep.h
+++ b/sound/pci/hda/hda_beep.h
@@ -31,6 +31,7 @@ struct hda_beep {
 	char phys[32];
 	int tone;
 	int nid;
+	int enabled;
 	struct work_struct beep_work; /* scheduled task for beep event */
 };
 

commit 1cd2224cd01898a13138f4ab476932cfb689839e
Author: Matthew Ranostay <mranostay@embeddedalley.com>
Date:   Fri Jul 18 18:20:52 2008 +0200

    ALSA: hda: digital pc-beep support hd-audio codecs
    
    Added digital pc-beep support using linear tone generation for hd-codecs along
    with initial support for several IDT codecs.
    
    Signed-off-by: Matthew Ranostay <mranostay@embeddedalley.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Jaroslav Kysela <perex@perex.cz>

diff --git a/sound/pci/hda/hda_beep.h b/sound/pci/hda/hda_beep.h
new file mode 100644
index 000000000000..de4036e6e710
--- /dev/null
+++ b/sound/pci/hda/hda_beep.h
@@ -0,0 +1,44 @@
+/*
+ * Digital Beep Input Interface for HD-audio codec
+ *
+ * Author: Matthew Ranostay <mranostay@embeddedalley.com>
+ * Copyright (c) 2008 Embedded Alley Solutions Inc
+ *
+ *  This driver is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This driver is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
+ */
+
+#ifndef __SOUND_HDA_BEEP_H
+#define __SOUND_HDA_BEEP_H
+
+#include "hda_codec.h"
+
+/* beep information */
+struct hda_beep {
+	struct input_dev *dev;
+	struct hda_codec *codec;
+	char phys[32];
+	int tone;
+	int nid;
+	struct work_struct beep_work; /* scheduled task for beep event */
+};
+
+#ifdef CONFIG_SND_HDA_INPUT_BEEP
+int snd_hda_attach_beep_device(struct hda_codec *codec, int nid);
+void snd_hda_detach_beep_device(struct hda_codec *codec);
+#else
+#define snd_hda_attach_beep_device(...)
+#define snd_hda_detach_beep_device(...)
+#endif
+#endif
