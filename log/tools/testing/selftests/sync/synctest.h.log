commit f471e1fd82df5061e3502056ab7aeb3cd399e83e
Author: Shuah Khan <shuahkh@osg.samsung.com>
Date:   Mon Jul 24 14:19:13 2017 -0600

    selftests: sync: convert to use TAP13 ksft framework
    
    Convert test to use TAP13 ksft framework. Output after conversion:
    
    TAP version 13
    # [RUN] Testing sync framework
    ok 1 [RUN]      test_alloc_timeline
    ok 2 [RUN]      test_alloc_fence
    ok 3 [RUN]      test_alloc_fence_negative
    ok 4 [RUN]      test_fence_one_timeline_wait
    ok 5 [RUN]      test_fence_one_timeline_merge
    ok 6 [RUN]      test_fence_merge_same_fence
    ok 7 [RUN]      test_fence_multi_timeline_wait
    ok 8 [RUN]      test_stress_two_threads_shared_timeline
    ok 9 [RUN]      test_consumer_stress_multi_producer_single_consumer
    ok 10 [RUN]     test_merge_stress_random_merge
    Pass 10 Fail 0 Xfail 0 Xpass 0 Skip 0
    1..10
    
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>
    Reviewed-by: Gustavo Padovan <gustavo.padovan@collabora.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index e7d1d57dba7a..90a8e5369914 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -29,10 +29,11 @@
 #define SELFTESTS_SYNCTEST_H
 
 #include <stdio.h>
+#include "../kselftest.h"
 
 #define ASSERT(cond, msg) do { \
 	if (!(cond)) { \
-		printf("[ERROR]\t%s", (msg)); \
+		ksft_print_msg("[ERROR]\t%s", (msg)); \
 		return 1; \
 	} \
 } while (0)

commit 981c3db62e2d2dfb0c5725dd55d8c3cf8ed4edd8
Author: Gustavo Padovan <gustavo.padovan@collabora.com>
Date:   Tue Dec 13 11:48:49 2016 -0200

    selftest: sync: improve assert() failure message
    
    Print "ERROR" on all messages instead of using the not well defined terms
    like "BAD".
    
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.com>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index 4e0e59f6fcf3..e7d1d57dba7a 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -32,7 +32,7 @@
 
 #define ASSERT(cond, msg) do { \
 	if (!(cond)) { \
-		printf("[BAD]\t%s", (msg)); \
+		printf("[ERROR]\t%s", (msg)); \
 		return 1; \
 	} \
 } while (0)

commit 499a1d11f2653483f87c3339c8c799bc259536e7
Author: Emilio López <emilio.lopez@collabora.co.uk>
Date:   Wed Oct 19 09:49:54 2016 -0300

    selftest: sync: stress test for merges
    
    This test is based on the libsync test suite from Android.
    This commit includes a test to stress merge operations.
    
    Signed-off-by: Emilio López <emilio.lopez@collabora.co.uk>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index a94b6220b8e6..4e0e59f6fcf3 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -60,4 +60,7 @@ int test_stress_two_threads_shared_timeline(void);
 /* Stress test - consumer */
 int test_consumer_stress_multi_producer_single_consumer(void);
 
+/* Stress test - merging */
+int test_merge_stress_random_merge(void);
+
 #endif

commit c52dee5025d904896198b7090cf7df80a4028363
Author: Emilio López <emilio.lopez@collabora.co.uk>
Date:   Wed Oct 19 09:49:53 2016 -0300

    selftest: sync: stress consumer/producer test
    
    This test is based on the libsync test suite from Android.
    This commit includes a stress test that replicates a
    consumer/producer pattern.
    
    Signed-off-by: Emilio López <emilio.lopez@collabora.co.uk>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index c461577f84a0..a94b6220b8e6 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -57,4 +57,7 @@ int test_fence_multi_timeline_wait(void);
 /* Stress test - parallelism */
 int test_stress_two_threads_shared_timeline(void);
 
+/* Stress test - consumer */
+int test_consumer_stress_multi_producer_single_consumer(void);
+
 #endif

commit 54b519f32ccd663ca8ee48d43c448271230d3670
Author: Emilio López <emilio.lopez@collabora.co.uk>
Date:   Wed Oct 19 09:49:52 2016 -0300

    selftest: sync: stress test for parallelism
    
    This test is based on the libsync test suite from Android.
    This commit includes a stress test that invokes operations
    in parallel.
    
    Signed-off-by: Emilio López <emilio.lopez@collabora.co.uk>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index 0fad57d77a30..c461577f84a0 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -54,4 +54,7 @@ int test_fence_merge_same_fence(void);
 /* Fence wait tests */
 int test_fence_multi_timeline_wait(void);
 
+/* Stress test - parallelism */
+int test_stress_two_threads_shared_timeline(void);
+
 #endif

commit fdba7cffc32b22afb8070a433c091448b519923f
Author: Emilio López <emilio.lopez@collabora.co.uk>
Date:   Wed Oct 19 09:49:51 2016 -0300

    selftest: sync: wait tests for sw_sync framework
    
    These tests are based on the libsync test suite from Android.
    This commit includes tests for waiting on fences.
    
    Signed-off-by: Emilio López <emilio.lopez@collabora.co.uk>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index c3b0b5ec4fa8..0fad57d77a30 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -51,4 +51,7 @@ int test_fence_one_timeline_merge(void);
 /* Fence merge tests */
 int test_fence_merge_same_fence(void);
 
+/* Fence wait tests */
+int test_fence_multi_timeline_wait(void);
+
 #endif

commit 1c5839c6eefbb938052c57bc32f66b6f276431f3
Author: Emilio López <emilio.lopez@collabora.co.uk>
Date:   Wed Oct 19 09:49:50 2016 -0300

    selftest: sync: merge tests for sw_sync framework
    
    These tests are based on the libsync test suite from Android.
    This commit includes tests for basic merge operations.
    
    Signed-off-by: Emilio López <emilio.lopez@collabora.co.uk>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index 6505c281c7b3..c3b0b5ec4fa8 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -48,4 +48,7 @@ int test_alloc_fence_negative(void);
 int test_fence_one_timeline_wait(void);
 int test_fence_one_timeline_merge(void);
 
+/* Fence merge tests */
+int test_fence_merge_same_fence(void);
+
 #endif

commit 6a5b7d2c55ca8eca3dc5cc6355885e286ef6df7f
Author: Emilio López <emilio.lopez@collabora.co.uk>
Date:   Wed Oct 19 09:49:49 2016 -0300

    selftest: sync: fence tests for sw_sync framework
    
    These tests are based on the libsync test suite from Android.
    This commit includes tests for basic fence creation.
    
    Signed-off-by: Emilio López <emilio.lopez@collabora.co.uk>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
index 7d2d8ce1d71a..6505c281c7b3 100644
--- a/tools/testing/selftests/sync/synctest.h
+++ b/tools/testing/selftests/sync/synctest.h
@@ -44,4 +44,8 @@ int test_alloc_timeline(void);
 int test_alloc_fence(void);
 int test_alloc_fence_negative(void);
 
+/* Fence tests with one timeline */
+int test_fence_one_timeline_wait(void);
+int test_fence_one_timeline_merge(void);
+
 #endif

commit 82208160ae35ca00b5494c5c90c1a8721b15bdb1
Author: Emilio López <emilio.lopez@collabora.co.uk>
Date:   Wed Oct 19 09:49:48 2016 -0300

    selftest: sync: basic tests for sw_sync framework
    
    These tests are based on the libsync test suite from Android.
    This commit lays the ground for future tests, as well as includes
    tests for a variety of basic allocation commands.
    
    Signed-off-by: Emilio López <emilio.lopez@collabora.co.uk>
    Signed-off-by: Shuah Khan <shuahkh@osg.samsung.com>

diff --git a/tools/testing/selftests/sync/synctest.h b/tools/testing/selftests/sync/synctest.h
new file mode 100644
index 000000000000..7d2d8ce1d71a
--- /dev/null
+++ b/tools/testing/selftests/sync/synctest.h
@@ -0,0 +1,47 @@
+/*
+ *  sync tests
+ *  Copyright 2015-2016 Collabora Ltd.
+ *
+ *  Based on the implementation from the Android Open Source Project,
+ *
+ *  Copyright 2012 Google, Inc
+ *
+ *  Permission is hereby granted, free of charge, to any person obtaining a
+ *  copy of this software and associated documentation files (the "Software"),
+ *  to deal in the Software without restriction, including without limitation
+ *  the rights to use, copy, modify, merge, publish, distribute, sublicense,
+ *  and/or sell copies of the Software, and to permit persons to whom the
+ *  Software is furnished to do so, subject to the following conditions:
+ *
+ *  The above copyright notice and this permission notice shall be included in
+ *  all copies or substantial portions of the Software.
+ *
+ *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+ *  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
+ *  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
+ *  ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
+ *  OTHER DEALINGS IN THE SOFTWARE.
+ */
+
+#ifndef SELFTESTS_SYNCTEST_H
+#define SELFTESTS_SYNCTEST_H
+
+#include <stdio.h>
+
+#define ASSERT(cond, msg) do { \
+	if (!(cond)) { \
+		printf("[BAD]\t%s", (msg)); \
+		return 1; \
+	} \
+} while (0)
+
+#define RUN_TEST(x) run_test((x), #x)
+
+/* Allocation tests */
+int test_alloc_timeline(void);
+int test_alloc_fence(void);
+int test_alloc_fence_negative(void);
+
+#endif
