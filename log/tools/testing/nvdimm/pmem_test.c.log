commit 0fb5c8df609eaca3cb7c24e7f91470f8dd5984ec
Author: Dan Williams <dan.j.williams@intel.com>
Date:   Thu Feb 1 12:28:54 2018 -0800

    tools/testing/nvdimm: force nfit_test to depend on instrumented modules
    
    The libnvdimm unit tests will fail when they are run against the
    production / in-tree version of libnvdimm.ko or nfit.ko due to
    symbols not being mocked per nfit_test's expectation. For example,
    nfit_test expects acpi_evaluate_dsm() to be replaced by
    __wrap_acpi_evaluate_dsm() to test how acpi_nfit_ctl() responds to
    different stimuli.
    
    Create a test-only symbol name that nfit_test links against to cause
    module load failures when the wrong module is present.
    
    For example, with this change, attempts to use the wrong module will
    report:
    
        nfit_test: Unknown symbol libnvdimm_test (err 0)
    
    Reported-by: Dave Jiang <dave.jiang@intel.com>
    Reported-by: Vishal Verma <vishal.l.verma@intel.com>
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>

diff --git a/tools/testing/nvdimm/pmem_test.c b/tools/testing/nvdimm/pmem_test.c
new file mode 100644
index 000000000000..fd38f92275cf
--- /dev/null
+++ b/tools/testing/nvdimm/pmem_test.c
@@ -0,0 +1,8 @@
+// SPDX-License-Identifier: GPL-2.0
+// Copyright(c) 2018 Intel Corporation. All rights reserved.
+
+#include <linux/module.h>
+#include <linux/printk.h>
+#include "watermark.h"
+
+nfit_test_watermark(pmem);
