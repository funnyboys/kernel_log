commit 3b573bf318d894b4290e194c4d7dbcba8c1f6ead
Author: Arnaldo Carvalho de Melo <acme@redhat.com>
Date:   Fri Feb 14 16:21:40 2020 -0300

    perf bpf: Remove bpf/ subdir from bpf.h headers used to build bpf events
    
    The bpf.h file needed gets installed in /usr/lib/include/perf/bpf/bpf.h,
    and /usr/lib/include/perf/ is added to the include path passed to clang
    to build the eBPF bytecode, so just remove "bpf/", its directly in the
    path passed already. This was working by accident, fix it.
    
    I.e. now this is back working:
    
      # cat /home/acme/git/perf/tools/perf/examples/bpf/hello.c
      #include <stdio.h>
    
      int syscall_enter(openat)(void *args)
      {
            puts("Hello, world\n");
            return 0;
      }
    
      license(GPL);
      # perf trace -e /home/acme/git/perf/tools/perf/examples/bpf/hello.c
           0.000 pickup/21493 __bpf_stdout__(Hello, world)
          56.462 sh/13539 __bpf_stdout__(Hello, world)
          56.536 sh/13539 __bpf_stdout__(Hello, world)
          56.673 sh/13539 __bpf_stdout__(Hello, world)
          56.781 sh/13539 __bpf_stdout__(Hello, world)
          56.707 perf/13182 __bpf_stdout__(Hello, world)
          56.849 perf/13182 __bpf_stdout__(Hello, world)
      ^C
      #
    
    Cc: Adrian Hunter <adrian.hunter@intel.com>
    Cc: Jiri Olsa <jolsa@kernel.org>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Link: https://lkml.kernel.org/n/tip-d9myswhgo8gfi3vmehdqpxa7@git.kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/perf/include/bpf/unistd.h b/tools/perf/include/bpf/unistd.h
index d1a35b6c649d..ca7877f9a976 100644
--- a/tools/perf/include/bpf/unistd.h
+++ b/tools/perf/include/bpf/unistd.h
@@ -1,6 +1,6 @@
 // SPDX-License-Identifier: LGPL-2.1
 
-#include <bpf/bpf.h>
+#include <bpf.h>
 
 static int (*bpf_get_current_pid_tgid)(void) = (void *)BPF_FUNC_get_current_pid_tgid;
 

commit 521fe8bb5874963d5f6fd58d5c5ad80fbc9c6b1c
Author: Toke Høiland-Jørgensen <toke@redhat.com>
Date:   Mon Jan 20 14:06:48 2020 +0100

    perf: Use consistent include paths for libbpf
    
    Fix perf to include libbpf header files with the bpf/ prefix, to
    be consistent with external users of the library.
    
    Signed-off-by: Toke Høiland-Jørgensen <toke@redhat.com>
    Signed-off-by: Alexei Starovoitov <ast@kernel.org>
    Acked-by: Andrii Nakryiko <andriin@fb.com>
    Link: https://lore.kernel.org/bpf/157952560797.1683545.7685921032671386301.stgit@toke.dk

diff --git a/tools/perf/include/bpf/unistd.h b/tools/perf/include/bpf/unistd.h
index ca7877f9a976..d1a35b6c649d 100644
--- a/tools/perf/include/bpf/unistd.h
+++ b/tools/perf/include/bpf/unistd.h
@@ -1,6 +1,6 @@
 // SPDX-License-Identifier: LGPL-2.1
 
-#include <bpf.h>
+#include <bpf/bpf.h>
 
 static int (*bpf_get_current_pid_tgid)(void) = (void *)BPF_FUNC_get_current_pid_tgid;
 

commit 1475d35c4a6174d4ec633b9af5713e9770b3ac0d
Author: Arnaldo Carvalho de Melo <acme@redhat.com>
Date:   Tue Nov 6 15:21:45 2018 -0300

    perf bpf: Add unistd.h to the headers accessible to bpf proggies
    
    Start with a getpid() function wrapping BPF_FUNC_get_current_pid_tgid,
    idea is to mimic the system headers.
    
    Cc: Adrian Hunter <adrian.hunter@intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Jiri Olsa <jolsa@kernel.org>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Wang Nan <wangnan0@huawei.com>
    Link: https://lkml.kernel.org/n/tip-zo8hv22onidep7tm785dzxfk@git.kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/perf/include/bpf/unistd.h b/tools/perf/include/bpf/unistd.h
new file mode 100644
index 000000000000..ca7877f9a976
--- /dev/null
+++ b/tools/perf/include/bpf/unistd.h
@@ -0,0 +1,10 @@
+// SPDX-License-Identifier: LGPL-2.1
+
+#include <bpf.h>
+
+static int (*bpf_get_current_pid_tgid)(void) = (void *)BPF_FUNC_get_current_pid_tgid;
+
+static pid_t getpid(void)
+{
+	return bpf_get_current_pid_tgid();
+}
