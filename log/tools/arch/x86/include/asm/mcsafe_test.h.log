commit 1f27a050fc679d16e68a40e0bb575364a89fad66
Author: Arnaldo Carvalho de Melo <acme@redhat.com>
Date:   Mon Jul 30 12:26:54 2018 -0300

    tools arch: Update arch/x86/lib/memcpy_64.S copy used in 'perf bench mem memcpy'
    
    To cope with the changes in:
    
      12c89130a56a ("x86/asm/memcpy_mcsafe: Add write-protection-fault handling")
      60622d68227d ("x86/asm/memcpy_mcsafe: Return bytes remaining")
      bd131544aa7e ("x86/asm/memcpy_mcsafe: Add labels for __memcpy_mcsafe() write fault handling")
      da7bc9c57eb0 ("x86/asm/memcpy_mcsafe: Remove loop unrolling")
    
    This needed introducing a file with a copy of the mcsafe_handle_tail()
    function, that is used in the new memcpy_64.S file, as well as a dummy
    mcsafe_test.h header.
    
    Testing it:
    
      $ nm ~/bin/perf | grep mcsafe
      0000000000484130 T mcsafe_handle_tail
      0000000000484300 T __memcpy_mcsafe
      $
      $ perf bench mem memcpy
      # Running 'mem/memcpy' benchmark:
      # function 'default' (Default memcpy() provided by glibc)
      # Copying 1MB bytes ...
    
          44.389205 GB/sec
      # function 'x86-64-unrolled' (unrolled memcpy() in arch/x86/lib/memcpy_64.S)
      # Copying 1MB bytes ...
    
          22.710756 GB/sec
      # function 'x86-64-movsq' (movsq-based memcpy() in arch/x86/lib/memcpy_64.S)
      # Copying 1MB bytes ...
    
          42.459239 GB/sec
      # function 'x86-64-movsb' (movsb-based memcpy() in arch/x86/lib/memcpy_64.S)
      # Copying 1MB bytes ...
    
          42.459239 GB/sec
      $
    
    This silences this perf tools build warning:
    
      Warning: Kernel ABI header at 'tools/arch/x86/lib/memcpy_64.S' differs from latest version at 'arch/x86/lib/memcpy_64.S'
    
    Cc: Adrian Hunter <adrian.hunter@intel.com>
    Cc: Dan Williams <dan.j.williams@intel.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Jiri Olsa <jolsa@kernel.org>
    Cc: Mika Penttil√§ <mika.penttila@nextfour.com>
    Cc: Namhyung Kim <namhyung@kernel.org>
    Cc: Tony Luck <tony.luck@intel.com>
    Cc: Wang Nan <wangnan0@huawei.com>
    Link: https://lkml.kernel.org/n/tip-igdpciheradk3gb3qqal52d0@git.kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/arch/x86/include/asm/mcsafe_test.h b/tools/arch/x86/include/asm/mcsafe_test.h
new file mode 100644
index 000000000000..2ccd588fbad4
--- /dev/null
+++ b/tools/arch/x86/include/asm/mcsafe_test.h
@@ -0,0 +1,13 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+#ifndef _MCSAFE_TEST_H_
+#define _MCSAFE_TEST_H_
+
+.macro MCSAFE_TEST_CTL
+.endm
+
+.macro MCSAFE_TEST_SRC reg count target
+.endm
+
+.macro MCSAFE_TEST_DST reg count target
+.endm
+#endif /* _MCSAFE_TEST_H_ */
