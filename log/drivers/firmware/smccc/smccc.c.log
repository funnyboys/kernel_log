commit a4fb17465182c9fc13104e4df04d050892055205
Author: Sudeep Holla <sudeep.holla@arm.com>
Date:   Mon May 18 10:12:21 2020 +0100

    firmware: smccc: Add function to fetch SMCCC version
    
    For backward compatibility reasons, PSCI maintains SMCCC version as
    SMCCC didn't provide ARM_SMCCC_VERSION_FUNC_ID until v1.1.
    
    PSCI initialises both the SMCCC version and conduit. Similar to the
    conduit, let us provide accessors to fetch the SMCCC version also so
    that other SMCCC v1.1+ features can use it.
    
    Signed-off-by: Sudeep Holla <sudeep.holla@arm.com>
    Tested-by: Etienne Carriere <etienne.carriere@st.com>
    Reviewed-by: Steven Price <steven.price@arm.com>
    Reviewed-by: Etienne Carriere <etienne.carriere@st.com>
    Acked-by: Mark Rutland <mark.rutland@arm.com>
    Link: https://lore.kernel.org/r/20200518091222.27467-7-sudeep.holla@arm.com
    Signed-off-by: Will Deacon <will@kernel.org>

diff --git a/drivers/firmware/smccc/smccc.c b/drivers/firmware/smccc/smccc.c
index de92a4b9f8f6..4e80921ee212 100644
--- a/drivers/firmware/smccc/smccc.c
+++ b/drivers/firmware/smccc/smccc.c
@@ -24,3 +24,8 @@ enum arm_smccc_conduit arm_smccc_1_1_get_conduit(void)
 
 	return smccc_conduit;
 }
+
+u32 arm_smccc_get_version(void)
+{
+	return smccc_version;
+}

commit f2ae97062a48b114bcf8fb2e99574d9ed2c2cd1b
Author: Sudeep Holla <sudeep.holla@arm.com>
Date:   Mon May 18 10:12:20 2020 +0100

    firmware: smccc: Refactor SMCCC specific bits into separate file
    
    In order to add newer SMCCC v1.1+ functionality and to avoid cluttering
    PSCI firmware driver with SMCCC bits, let us move the SMCCC specific
    details under drivers/firmware/smccc/smccc.c
    
    We can also drop conduit and smccc_version from psci_operations structure
    as SMCCC was the sole user and now it maintains those.
    
    No functionality change in this patch though.
    
    Signed-off-by: Sudeep Holla <sudeep.holla@arm.com>
    Tested-by: Etienne Carriere <etienne.carriere@st.com>
    Reviewed-by: Etienne Carriere <etienne.carriere@st.com>
    Acked-by: Mark Rutland <mark.rutland@arm.com>
    Link: https://lore.kernel.org/r/20200518091222.27467-6-sudeep.holla@arm.com
    Signed-off-by: Will Deacon <will@kernel.org>

diff --git a/drivers/firmware/smccc/smccc.c b/drivers/firmware/smccc/smccc.c
new file mode 100644
index 000000000000..de92a4b9f8f6
--- /dev/null
+++ b/drivers/firmware/smccc/smccc.c
@@ -0,0 +1,26 @@
+// SPDX-License-Identifier: GPL-2.0-only
+/*
+ * Copyright (C) 2020 Arm Limited
+ */
+
+#define pr_fmt(fmt) "smccc: " fmt
+
+#include <linux/init.h>
+#include <linux/arm-smccc.h>
+
+static u32 smccc_version = ARM_SMCCC_VERSION_1_0;
+static enum arm_smccc_conduit smccc_conduit = SMCCC_CONDUIT_NONE;
+
+void __init arm_smccc_version_init(u32 version, enum arm_smccc_conduit conduit)
+{
+	smccc_version = version;
+	smccc_conduit = conduit;
+}
+
+enum arm_smccc_conduit arm_smccc_1_1_get_conduit(void)
+{
+	if (smccc_version < ARM_SMCCC_VERSION_1_1)
+		return SMCCC_CONDUIT_NONE;
+
+	return smccc_conduit;
+}
