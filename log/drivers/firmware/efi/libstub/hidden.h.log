commit 6f05106e20f0ed26a2dbd6a5d44a302ce81642e0
Author: Ard Biesheuvel <ardb@kernel.org>
Date:   Mon Feb 10 17:02:32 2020 +0100

    efi/libstub: Use hidden visibility for all source files
    
    Instead of setting the visibility pragma for a small set of symbol
    declarations that could result in absolute references that we cannot
    support in the stub, declare hidden visibility for all code in the
    EFI stub, which is more robust and future proof.
    
    To ensure that the #pragma is taken into account before any other
    includes are processed, put it in a header file of its own and
    include it via the compiler command line using the -include option.
    
    Signed-off-by: Ard Biesheuvel <ardb@kernel.org>

diff --git a/drivers/firmware/efi/libstub/hidden.h b/drivers/firmware/efi/libstub/hidden.h
new file mode 100644
index 000000000000..3493b041f419
--- /dev/null
+++ b/drivers/firmware/efi/libstub/hidden.h
@@ -0,0 +1,6 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+/*
+ * To prevent the compiler from emitting GOT-indirected (and thus absolute)
+ * references to any global symbols, override their visibility as 'hidden'
+ */
+#pragma GCC visibility push(hidden)
