commit 9536b64ac0d6e3151963a11441dde7ade045fb29
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Aug 19 10:59:26 2019 +0100

    dma-buf: Introduce selftesting framework
    
    In light of recent review slip ups, the absence of a suite of tests for
    dma-buf became apparent. Given the current plethora of testing
    frameworks, opt for one already in use by Intel's CI and so allow easy
    hook up into igt.
    
    We introduce a new module that when loaded will execute the list of
    selftests and their subtest. The names of the selftests are put into the
    modinfo as parameters so that igt can identify each, and run them
    independently, principally for ease of error reporting.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Daniel Vetter <daniel.vetter@ffwll.ch>
    Cc: Tomi Sarvela <tomi.p.sarvela@intel.com>
    Acked-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Link: https://patchwork.freedesktop.org/patch/msgid/20190819095928.32091-1-chris@chris-wilson.co.uk

diff --git a/drivers/dma-buf/selftest.h b/drivers/dma-buf/selftest.h
new file mode 100644
index 000000000000..45793aff6142
--- /dev/null
+++ b/drivers/dma-buf/selftest.h
@@ -0,0 +1,30 @@
+// SPDX-License-Identifier: MIT
+
+/*
+ * Copyright Â© 2019 Intel Corporation
+ */
+
+#ifndef __SELFTEST_H__
+#define __SELFTEST_H__
+
+#include <linux/compiler.h>
+
+#define selftest(name, func) int func(void);
+#include "selftests.h"
+#undef selftest
+
+struct subtest {
+	int (*func)(void *data);
+	const char *name;
+};
+
+int __subtests(const char *caller,
+	       const struct subtest *st,
+	       int count,
+	       void *data);
+#define subtests(T, data) \
+	__subtests(__func__, T, ARRAY_SIZE(T), data)
+
+#define SUBTEST(x) { x, #x }
+
+#endif /* __SELFTEST_H__ */
