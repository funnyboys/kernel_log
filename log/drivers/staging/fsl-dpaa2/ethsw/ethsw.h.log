commit b8f64757bad8278f03c918b573687925ff55cd84
Author: Ioana Ciornei <ioana.ciornei@nxp.com>
Date:   Mon Nov 11 18:50:58 2019 +0200

    staging: dpaa2-ethsw: ordered workqueue should be per ethsw
    
    Create a different ordered workqueue per dpaa2-ethsw instance.  Without
    this change, we overwrite the global queue and leak memory when probing
    multiple instances of the driver.
    
    Signed-off-by: Ioana Ciornei <ioana.ciornei@nxp.com>
    Link: https://lore.kernel.org/r/1573491058-24766-5-git-send-email-ioana.ciornei@nxp.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
index db7eef134230..a0244f7d5003 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -70,6 +70,7 @@ struct ethsw_core {
 	struct notifier_block		port_nb;
 	struct notifier_block		port_switchdev_nb;
 	struct notifier_block		port_switchdevb_nb;
+	struct workqueue_struct		*workqueue;
 };
 
 #endif	/* __ETHSW_H */

commit 910f30917cdffedff5663f5ac451424bd7176ce7
Author: Ioana Ciornei <ioana.ciornei@nxp.com>
Date:   Mon Nov 11 18:50:57 2019 +0200

    staging: dpaa2-ethsw: move port switchdev blocking notifier per ethsw
    
    Register a different switchdev blocking notifier block per ethsw
    instance.  When probing multiple dpaa2-ethsw instances, without this the
    register will fail.
    
    Signed-off-by: Ioana Ciornei <ioana.ciornei@nxp.com>
    Link: https://lore.kernel.org/r/1573491058-24766-4-git-send-email-ioana.ciornei@nxp.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
index e050589758b1..db7eef134230 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -69,6 +69,7 @@ struct ethsw_core {
 
 	struct notifier_block		port_nb;
 	struct notifier_block		port_switchdev_nb;
+	struct notifier_block		port_switchdevb_nb;
 };
 
 #endif	/* __ETHSW_H */

commit a3c6345e9f04510bcca88f0faefbcd2399dbca47
Author: Ioana Ciornei <ioana.ciornei@nxp.com>
Date:   Mon Nov 11 18:50:56 2019 +0200

    staging: dpaa2-ethsw: move port switchdev notifier per ethsw
    
    Register a different switchdev notifier block per ethsw instance.
    When probing multiple dpaa2-ethsw instances, without this the register
    will fail.
    
    Signed-off-by: Ioana Ciornei <ioana.ciornei@nxp.com>
    Link: https://lore.kernel.org/r/1573491058-24766-3-git-send-email-ioana.ciornei@nxp.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
index 39a3f542c8ee..e050589758b1 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -68,6 +68,7 @@ struct ethsw_core {
 	bool				learning;
 
 	struct notifier_block		port_nb;
+	struct notifier_block		port_switchdev_nb;
 };
 
 #endif	/* __ETHSW_H */

commit c5e648f8574d4644fe3efd46c4d34b5fceea2781
Author: Ioana Ciornei <ioana.ciornei@nxp.com>
Date:   Mon Nov 11 18:50:55 2019 +0200

    staging: dpaa2-ethsw: move port notifier per ethsw
    
    Register a different net_device notifier block per ethsw instance.
    When probing multiple dpaa2-ethsw instances, without this the register
    will fail.
    
    Signed-off-by: Ioana Ciornei <ioana.ciornei@nxp.com>
    Link: https://lore.kernel.org/r/1573491058-24766-2-git-send-email-ioana.ciornei@nxp.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
index 3ea8a0ad8c10..39a3f542c8ee 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -66,6 +66,8 @@ struct ethsw_core {
 
 	u8				vlans[VLAN_VID_MASK + 1];
 	bool				learning;
+
+	struct notifier_block		port_nb;
 };
 
 #endif	/* __ETHSW_H */

commit c5bd72f8713e13085267a8ebccfa5b8b3f2c674d
Author: Razvan Stefanescu <razvan.stefanescu@nxp.com>
Date:   Fri Jul 5 17:27:16 2019 +0300

    staging: fsl-dpaa2/ethsw: Add comments to ETHSW_VLAN flags
    
    Document each ETHSW_VLAN flag with the appropriate comment.
    
    Signed-off-by: Razvan Stefanescu <razvan.stefanescu@nxp.com>
    Signed-off-by: Ioana Ciornei <ioana.ciornei@nxp.com>
    Link: https://lore.kernel.org/r/1562336836-17119-7-git-send-email-ioana.ciornei@nxp.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
index c48783680a05..3ea8a0ad8c10 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -23,9 +23,13 @@
 /* Number of IRQs supported */
 #define DPSW_IRQ_NUM	2
 
+/* Port is member of VLAN */
 #define ETHSW_VLAN_MEMBER	1
+/* VLAN to be treated as untagged on egress */
 #define ETHSW_VLAN_UNTAGGED	2
+/* Untagged frames will be assigned to this VLAN */
 #define ETHSW_VLAN_PVID		4
+/* VLAN configured on the switch */
 #define ETHSW_VLAN_GLOBAL	8
 
 /* Maximum Frame Length supported by HW (currently 10k) */

commit 75f3da8958d03748b5d1d743d04f64d6f6993d5f
Author: Michael Straube <straube.linux@gmail.com>
Date:   Thu Dec 20 18:14:50 2018 +0100

    staging: fsl-dpaa2: fix SPDX identifiers in header files
    
    Use the correct comment style for SPDX identifiers in header files.
    Reported by checkpatch.
    
    Signed-off-by: Michael Straube <straube.linux@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
index 069c99bfba74..c48783680a05 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -1,4 +1,4 @@
-// SPDX-License-Identifier: GPL-2.0
+/* SPDX-License-Identifier: GPL-2.0 */
 /*
  * DPAA2 Ethernet Switch declarations
  *

commit b2b3212b16bbb8d3571f1534b83fc0e7b2714533
Author: Razvan Stefanescu <razvan.stefanescu@nxp.com>
Date:   Wed Mar 14 10:55:55 2018 -0500

    staging: fsl-dpaa2/ethsw: Add ethtool support
    
    Add driver information, link details and hardware statistics to be
    reported via ethtool -S.
    
    Signed-off-by: Razvan Stefanescu <razvan.stefanescu@nxp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
index da607b49d4ff..069c99bfba74 100644
--- a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -33,6 +33,8 @@
 #define ETHSW_MAX_FRAME_LENGTH	(DPAA2_MFL - VLAN_ETH_HLEN - ETH_FCS_LEN)
 #define ETHSW_L2_MAX_FRM(mtu)	((mtu) + VLAN_ETH_HLEN + ETH_FCS_LEN)
 
+extern const struct ethtool_ops ethsw_port_ethtool_ops;
+
 struct ethsw_core;
 
 /* Per port private data */

commit 44baaa43d7cc3492bcc59fb1040a3175a6229c5a
Author: Razvan Stefanescu <razvan.stefanescu@nxp.com>
Date:   Wed Mar 14 10:55:54 2018 -0500

    staging: fsl-dpaa2/ethsw: Add Freescale DPAA2 Ethernet Switch driver
    
    Introduce the DPAA2 Ethernet Switch driver, which manages Datapath Switch
    (DPSW) objects discovered on the MC bus.
    
    Suggested-by: Alexandru Marginean <alexandru.marginean@nxp.com>
    Signed-off-by: Razvan Stefanescu <razvan.stefanescu@nxp.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/fsl-dpaa2/ethsw/ethsw.h b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
new file mode 100644
index 000000000000..da607b49d4ff
--- /dev/null
+++ b/drivers/staging/fsl-dpaa2/ethsw/ethsw.h
@@ -0,0 +1,65 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ * DPAA2 Ethernet Switch declarations
+ *
+ * Copyright 2014-2016 Freescale Semiconductor Inc.
+ * Copyright 2017-2018 NXP
+ *
+ */
+
+#ifndef __ETHSW_H
+#define __ETHSW_H
+
+#include <linux/netdevice.h>
+#include <linux/etherdevice.h>
+#include <linux/rtnetlink.h>
+#include <linux/if_vlan.h>
+#include <uapi/linux/if_bridge.h>
+#include <net/switchdev.h>
+#include <linux/if_bridge.h>
+
+#include "dpsw.h"
+
+/* Number of IRQs supported */
+#define DPSW_IRQ_NUM	2
+
+#define ETHSW_VLAN_MEMBER	1
+#define ETHSW_VLAN_UNTAGGED	2
+#define ETHSW_VLAN_PVID		4
+#define ETHSW_VLAN_GLOBAL	8
+
+/* Maximum Frame Length supported by HW (currently 10k) */
+#define DPAA2_MFL		(10 * 1024)
+#define ETHSW_MAX_FRAME_LENGTH	(DPAA2_MFL - VLAN_ETH_HLEN - ETH_FCS_LEN)
+#define ETHSW_L2_MAX_FRM(mtu)	((mtu) + VLAN_ETH_HLEN + ETH_FCS_LEN)
+
+struct ethsw_core;
+
+/* Per port private data */
+struct ethsw_port_priv {
+	struct net_device	*netdev;
+	u16			idx;
+	struct ethsw_core	*ethsw_data;
+	u8			link_state;
+	u8			stp_state;
+	bool			flood;
+
+	u8			vlans[VLAN_VID_MASK + 1];
+	u16			pvid;
+	struct net_device	*bridge_dev;
+};
+
+/* Switch data */
+struct ethsw_core {
+	struct device			*dev;
+	struct fsl_mc_io		*mc_io;
+	u16				dpsw_handle;
+	struct dpsw_attr		sw_attr;
+	int				dev_id;
+	struct ethsw_port_priv		**ports;
+
+	u8				vlans[VLAN_VID_MASK + 1];
+	bool				learning;
+};
+
+#endif	/* __ETHSW_H */
