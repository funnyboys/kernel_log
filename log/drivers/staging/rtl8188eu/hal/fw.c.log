commit 710c451fbcb24959c575a96dff28bcf48c819fe2
Author: Michael Straube <straube.linux@gmail.com>
Date:   Mon Apr 13 19:59:57 2020 +0200

    staging: rtl8188eu: make const char array static
    
    Make const char array 'fw_name' static. Clears a checkpatch warning
    and reduces object file size by 17 bytes (gcc 9.3.1 x86_64).
    
    WARNING: const array should probably be static const
    
    Signed-off-by: Michael Straube <straube.linux@gmail.com>
    Link: https://lore.kernel.org/r/20200413175957.30165-4-straube.linux@gmail.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 432e6bea5ea1..3d1d29e9f8e0 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -146,7 +146,7 @@ int rtl88eu_download_fw(struct adapter *adapt)
 	struct dvobj_priv *dvobj = adapter_to_dvobj(adapt);
 	struct device *device = dvobj_to_dev(dvobj);
 	const struct firmware *fw;
-	const char fw_name[] = "rtlwifi/rtl8188eufw.bin";
+	static const char fw_name[] = "rtlwifi/rtl8188eufw.bin";
 	struct rtl92c_firmware_header *pfwheader = NULL;
 	u8 *download_data, *fw_data;
 	size_t download_size;

commit 05a72b5616724cf4dd2b4582884da44e036a30fc
Author: Michael Straube <straube.linux@gmail.com>
Date:   Mon Apr 13 19:59:56 2020 +0200

    staging: rtl8188eu: cleanup long line in fw.c
    
    Add line break to avoid line length over 80 characters.
    
    Signed-off-by: Michael Straube <straube.linux@gmail.com>
    Link: https://lore.kernel.org/r/20200413175957.30165-3-straube.linux@gmail.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index dbf7883f9ed7..432e6bea5ea1 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -192,7 +192,8 @@ int rtl88eu_download_fw(struct adapter *adapt)
 		rtl88e_firmware_selfreset(adapt);
 	}
 	_rtl88e_enable_fw_download(adapt, true);
-	usb_write8(adapt, REG_MCUFWDL, usb_read8(adapt, REG_MCUFWDL) | FWDL_CHKSUM_RPT);
+	usb_write8(adapt, REG_MCUFWDL,
+		   usb_read8(adapt, REG_MCUFWDL) | FWDL_CHKSUM_RPT);
 	_rtl88e_write_fw(adapt, download_data, download_size);
 	_rtl88e_enable_fw_download(adapt, false);
 

commit 8349fa213e13ff5b7b10349155c646ef770efc6b
Author: Michael Straube <straube.linux@gmail.com>
Date:   Mon Apr 13 19:59:55 2020 +0200

    staging: rtl8188eu: rename define to upper case
    
    Rename 'FWDL_ChkSum_rpt' to 'FWDL_CHKSUM_RPT' as defines are normaly
    named all upper case. Also clears a camel case checkpatch warning.
    
    Signed-off-by: Michael Straube <straube.linux@gmail.com>
    Link: https://lore.kernel.org/r/20200413175957.30165-2-straube.linux@gmail.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 486ee4bd4744..dbf7883f9ed7 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -111,7 +111,7 @@ static int _rtl88e_fw_free_to_go(struct adapter *adapt)
 
 	do {
 		value32 = usb_read32(adapt, REG_MCUFWDL);
-		if (value32 & FWDL_ChkSum_rpt)
+		if (value32 & FWDL_CHKSUM_RPT)
 			break;
 	} while (counter++ < POLLING_READY_TIMEOUT_COUNT);
 
@@ -192,7 +192,7 @@ int rtl88eu_download_fw(struct adapter *adapt)
 		rtl88e_firmware_selfreset(adapt);
 	}
 	_rtl88e_enable_fw_download(adapt, true);
-	usb_write8(adapt, REG_MCUFWDL, usb_read8(adapt, REG_MCUFWDL) | FWDL_ChkSum_rpt);
+	usb_write8(adapt, REG_MCUFWDL, usb_read8(adapt, REG_MCUFWDL) | FWDL_CHKSUM_RPT);
 	_rtl88e_write_fw(adapt, download_data, download_size);
 	_rtl88e_enable_fw_download(adapt, false);
 

commit 44b676a63529b3bc77819f24ba8507152125bc59
Author: Michael Straube <straube.linux@gmail.com>
Date:   Sun Sep 30 21:53:07 2018 +0200

    staging: rtl8188eu: add spaces around '+' in fw.c
    
    Add spaces around '+' in fw.c to follow kernel coding style.
    Reported by checkpatch.
    
    Signed-off-by: Michael Straube <straube.linux@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 1b8341f40995..486ee4bd4744 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -98,9 +98,9 @@ static void rtl88e_firmware_selfreset(struct adapter *adapt)
 {
 	u8 u1b_tmp;
 
-	u1b_tmp = usb_read8(adapt, REG_SYS_FUNC_EN+1);
-	usb_write8(adapt, REG_SYS_FUNC_EN+1, (u1b_tmp & (~BIT(2))));
-	usb_write8(adapt, REG_SYS_FUNC_EN+1, (u1b_tmp | BIT(2)));
+	u1b_tmp = usb_read8(adapt, REG_SYS_FUNC_EN + 1);
+	usb_write8(adapt, REG_SYS_FUNC_EN + 1, (u1b_tmp & (~BIT(2))));
+	usb_write8(adapt, REG_SYS_FUNC_EN + 1, (u1b_tmp | BIT(2)));
 }
 
 static int _rtl88e_fw_free_to_go(struct adapter *adapt)

commit 71e9bd3ff847afae91b9f66f9217921e98c25b0b
Author: Michael Straube <straube.linux@gmail.com>
Date:   Mon Jun 25 23:41:56 2018 +0200

    staging: rtl8188eu: add SPDX identifiers
    
    This satisfies a checkpatch warning and is the preferred
    method for notating the license.
    
    The SPDX identifier is a legally binding shorthand, which
    can be used instead of the full boiler plate text.
    
    Signed-off-by: Michael Straube <straube.linux@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 6b67b38a6a9f..1b8341f40995 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -1,19 +1,8 @@
+// SPDX-License-Identifier: GPL-2.0
 /******************************************************************************
  *
  * Copyright(c) 2009-2013  Realtek Corporation.
  *
- * This program is free software; you can redistribute it and/or modify it
- * under the terms of version 2 of the GNU General Public License as
- * published by the Free Software Foundation.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT
- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
- * more details.
- *
- * The full GNU General Public License is included in this distribution in the
- * file called LICENSE.
- *
  * Contact Information:
  * wlanfae <wlanfae@realtek.com>
  * Realtek Corporation, No. 2, Innovation Road II, Hsinchu Science Park,

commit 514c60324960137e74457fdc233a339b985fa8a8
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Thu Apr 5 16:25:34 2018 -0700

    headers: untangle kmemleak.h from mm.h
    
    Currently <linux/slab.h> #includes <linux/kmemleak.h> for no obvious
    reason.  It looks like it's only a convenience, so remove kmemleak.h
    from slab.h and add <linux/kmemleak.h> to any users of kmemleak_* that
    don't already #include it.  Also remove <linux/kmemleak.h> from source
    files that do not use it.
    
    This is tested on i386 allmodconfig and x86_64 allmodconfig.  It would
    be good to run it through the 0day bot for other $ARCHes.  I have
    neither the horsepower nor the storage space for the other $ARCHes.
    
    Update: This patch has been extensively build-tested by both the 0day
    bot & kisskb/ozlabs build farms.  Both of them reported 2 build failures
    for which patches are included here (in v2).
    
    [ slab.h is the second most used header file after module.h; kernel.h is
      right there with slab.h. There could be some minor error in the
      counting due to some #includes having comments after them and I didn't
      combine all of those. ]
    
    [akpm@linux-foundation.org: security/keys/big_key.c needs vmalloc.h, per sfr]
    Link: http://lkml.kernel.org/r/e4309f98-3749-93e1-4bb7-d9501a39d015@infradead.org
    Link: http://kisskb.ellerman.id.au/kisskb/head/13396/
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    Reviewed-by: Ingo Molnar <mingo@kernel.org>
    Reported-by: Michael Ellerman <mpe@ellerman.id.au>      [2 build failures]
    Reported-by: Fengguang Wu <fengguang.wu@intel.com>      [2 build failures]
    Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
    Cc: Wei Yongjun <weiyongjun1@huawei.com>
    Cc: Luis R. Rodriguez <mcgrof@kernel.org>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Mimi Zohar <zohar@linux.vnet.ibm.com>
    Cc: John Johansen <john.johansen@canonical.com>
    Cc: Stephen Rothwell <sfr@canb.auug.org.au>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 03d091bad13a..6b67b38a6a9f 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -30,7 +30,7 @@
 #include "rtl8188e_hal.h"
 
 #include <linux/firmware.h>
-#include <linux/kmemleak.h>
+#include <linux/slab.h>
 
 static void _rtl88e_enable_fw_download(struct adapter *adapt, bool enable)
 {

commit fb025382b4c2e394dd2b5ac4d173d42d2d9b5b69
Author: Kyle Kuffermann <kyle.kuffermann@gmail.com>
Date:   Sun Mar 13 10:16:27 2016 -0400

    staging: rtl8188eu: Remove license paragraph with mailing address
    
    This fixes the issue reported by checkpatch.pl:
    
            "Do not include the paragraph about writing to the Free Software
            Foundation's mailing address from the sample GPL notice. The FSF
            has changed addresses in the past, and may do so again.  Linux
            already includes a copy of the GPL."
    
    in all files for the rtl8188eu driver.
    
    Signed-off-by: Kyle Kuffermann <kyle.kuffermann@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 656133c47426..03d091bad13a 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -11,10 +11,6 @@
  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
  * more details.
  *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA
- *
  * The full GNU General Public License is included in this distribution in the
  * file called LICENSE.
  *

commit 8b0187188a423daa741cc544205c224c1ff84c33
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Fri Feb 12 01:25:30 2016 +0700

    staging: rtl8188eu: add release_firmware() between request_firmware and function error exit
    
    Small memory leak fixed.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 55c17df0e839..656133c47426 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -175,14 +175,17 @@ int rtl88eu_download_fw(struct adapter *adapt)
 	if (fw->size > FW_8188E_SIZE) {
 		dev_err(device, "Firmware size exceed 0x%X. Check it.\n",
 			FW_8188E_SIZE);
+		release_firmware(fw);
 		return -1;
 	}
 
 	trailing_zeros_length = (4 - fw->size % 4) % 4;
 
 	fw_data = kmalloc(fw->size + trailing_zeros_length, GFP_KERNEL);
-	if (!fw_data)
+	if (!fw_data) {
+		release_firmware(fw);
 		return -ENOMEM;
+	}
 
 	memcpy(fw_data, fw->data, fw->size);
 	memset(fw_data + fw->size, 0, trailing_zeros_length);

commit 29e20dd4c736a1f8a02d542359ba7a4e28440b73
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Fri Feb 12 01:24:22 2016 +0700

    staging: rtl8188eu: remove pfirmware and fwsize of the hal_data_8188e structure
    
    The pfirmware is used only in rtl88eu_download_fw function
    (except the kfree(rtlhal->pfirmware) in netdev_close).
    
    The fwsize not used after initialization at all.
    
    The pfirmvare replaced by fw_data and fwsize removed.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 25cecaeefa51..55c17df0e839 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -158,13 +158,12 @@ static int _rtl88e_fw_free_to_go(struct adapter *adapt)
 
 int rtl88eu_download_fw(struct adapter *adapt)
 {
-	struct hal_data_8188e *rtlhal = GET_HAL_DATA(adapt);
 	struct dvobj_priv *dvobj = adapter_to_dvobj(adapt);
 	struct device *device = dvobj_to_dev(dvobj);
 	const struct firmware *fw;
 	const char fw_name[] = "rtlwifi/rtl8188eufw.bin";
 	struct rtl92c_firmware_header *pfwheader = NULL;
-	u8 *download_data;
+	u8 *download_data, *fw_data;
 	size_t download_size;
 	unsigned int trailing_zeros_length;
 
@@ -181,22 +180,20 @@ int rtl88eu_download_fw(struct adapter *adapt)
 
 	trailing_zeros_length = (4 - fw->size % 4) % 4;
 
-	rtlhal->fwsize = fw->size;
-	rtlhal->pfirmware = kmalloc(fw->size + trailing_zeros_length,
-				    GFP_KERNEL);
-	if (!rtlhal->pfirmware)
+	fw_data = kmalloc(fw->size + trailing_zeros_length, GFP_KERNEL);
+	if (!fw_data)
 		return -ENOMEM;
 
-	memcpy(rtlhal->pfirmware, fw->data, fw->size);
-	memset(rtlhal->pfirmware + fw->size, 0, trailing_zeros_length);
+	memcpy(fw_data, fw->data, fw->size);
+	memset(fw_data + fw->size, 0, trailing_zeros_length);
 
-	pfwheader = (struct rtl92c_firmware_header *)rtlhal->pfirmware;
+	pfwheader = (struct rtl92c_firmware_header *)fw_data;
 
 	if (IS_FW_HEADER_EXIST(pfwheader)) {
-		download_data = rtlhal->pfirmware + 32;
+		download_data = fw_data + 32;
 		download_size = fw->size + trailing_zeros_length - 32;
 	} else {
-		download_data = rtlhal->pfirmware;
+		download_data = fw_data;
 		download_size = fw->size + trailing_zeros_length;
 	}
 
@@ -211,5 +208,6 @@ int rtl88eu_download_fw(struct adapter *adapt)
 	_rtl88e_write_fw(adapt, download_data, download_size);
 	_rtl88e_enable_fw_download(adapt, false);
 
+	kfree(fw_data);
 	return _rtl88e_fw_free_to_go(adapt);
 }

commit f643ba69d12e31053a112ef3bfa9ead45bb71e37
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Fri Feb 12 01:23:15 2016 +0700

    staging: rtl8188eu: remove _rtl88e_fill_dummy
    
    The _rtl88e_fill_dummy function replaced by memset in rtl88eu_download_fw.
    
    More appropriate names are used for pfwdata and fwsize variables
    (download_data and download_size respectively).
    
    Also u32 replaced by size_t for download_size variable.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 4d72537644b3..25cecaeefa51 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -75,16 +75,6 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 		usb_write8(adapt, write_address, byte_buffer[i]);
 }
 
-static void _rtl88e_fill_dummy(u8 *pfwbuf, u32 *pfwlen)
-{
-	u32 i;
-
-	for (i = *pfwlen; i < roundup(*pfwlen, 4); i++)
-		pfwbuf[i] = 0;
-
-	*pfwlen = i;
-}
-
 static void _rtl88e_fw_page_write(struct adapter *adapt,
 				  u32 page, const u8 *buffer, u32 size)
 {
@@ -103,8 +93,6 @@ static void _rtl88e_write_fw(struct adapter *adapt, u8 *buffer, u32 size)
 	u32 page_no, remain;
 	u32 page, offset;
 
-	_rtl88e_fill_dummy(buf_ptr, &size);
-
 	page_no = size / FW_8192C_PAGE_SIZE;
 	remain = size % FW_8192C_PAGE_SIZE;
 
@@ -176,8 +164,9 @@ int rtl88eu_download_fw(struct adapter *adapt)
 	const struct firmware *fw;
 	const char fw_name[] = "rtlwifi/rtl8188eufw.bin";
 	struct rtl92c_firmware_header *pfwheader = NULL;
-	u8 *pfwdata;
-	u32 fwsize;
+	u8 *download_data;
+	size_t download_size;
+	unsigned int trailing_zeros_length;
 
 	if (request_firmware(&fw, fw_name, device)) {
 		dev_err(device, "Firmware %s not available\n", fw_name);
@@ -186,34 +175,40 @@ int rtl88eu_download_fw(struct adapter *adapt)
 
 	if (fw->size > FW_8188E_SIZE) {
 		dev_err(device, "Firmware size exceed 0x%X. Check it.\n",
-			 FW_8188E_SIZE);
+			FW_8188E_SIZE);
 		return -1;
 	}
 
-	pfwdata = kzalloc(FW_8188E_SIZE, GFP_KERNEL);
-	if (!pfwdata)
+	trailing_zeros_length = (4 - fw->size % 4) % 4;
+
+	rtlhal->fwsize = fw->size;
+	rtlhal->pfirmware = kmalloc(fw->size + trailing_zeros_length,
+				    GFP_KERNEL);
+	if (!rtlhal->pfirmware)
 		return -ENOMEM;
 
-	rtlhal->pfirmware = pfwdata;
 	memcpy(rtlhal->pfirmware, fw->data, fw->size);
-	rtlhal->fwsize = fw->size;
-	release_firmware(fw);
+	memset(rtlhal->pfirmware + fw->size, 0, trailing_zeros_length);
 
-	fwsize = rtlhal->fwsize;
-	pfwheader = (struct rtl92c_firmware_header *)pfwdata;
+	pfwheader = (struct rtl92c_firmware_header *)rtlhal->pfirmware;
 
 	if (IS_FW_HEADER_EXIST(pfwheader)) {
-		pfwdata = pfwdata + 32;
-		fwsize = fwsize - 32;
+		download_data = rtlhal->pfirmware + 32;
+		download_size = fw->size + trailing_zeros_length - 32;
+	} else {
+		download_data = rtlhal->pfirmware;
+		download_size = fw->size + trailing_zeros_length;
 	}
 
+	release_firmware(fw);
+
 	if (usb_read8(adapt, REG_MCUFWDL) & RAM_DL_SEL) {
 		usb_write8(adapt, REG_MCUFWDL, 0);
 		rtl88e_firmware_selfreset(adapt);
 	}
 	_rtl88e_enable_fw_download(adapt, true);
 	usb_write8(adapt, REG_MCUFWDL, usb_read8(adapt, REG_MCUFWDL) | FWDL_ChkSum_rpt);
-	_rtl88e_write_fw(adapt, pfwdata, fwsize);
+	_rtl88e_write_fw(adapt, download_data, download_size);
 	_rtl88e_enable_fw_download(adapt, false);
 
 	return _rtl88e_fw_free_to_go(adapt);

commit 08ecab13e1677396edcd57459e47d25272f9179b
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Wed Nov 4 18:58:41 2015 +0700

    staging: rtl8188eu: for loop instead of while loop used
    
    The range of elements to fill with zeros is determined by using a roundup macro
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Reviewed-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 8c0230125d00..4d72537644b3 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -77,18 +77,12 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 
 static void _rtl88e_fill_dummy(u8 *pfwbuf, u32 *pfwlen)
 {
-	u32 fwlen = *pfwlen;
-	u8 remain = (u8)(fwlen % 4);
+	u32 i;
 
-	remain = (remain == 0) ? 0 : (4 - remain);
+	for (i = *pfwlen; i < roundup(*pfwlen, 4); i++)
+		pfwbuf[i] = 0;
 
-	while (remain > 0) {
-		pfwbuf[fwlen] = 0;
-		fwlen++;
-		remain--;
-	}
-
-	*pfwlen = fwlen;
+	*pfwlen = i;
 }
 
 static void _rtl88e_fw_page_write(struct adapter *adapt,

commit 13cab3d422e89ccdcc78377e76299a2fdb4df90b
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:54:45 2015 +0700

    staging: rtl8188eu: offset renamed to write_address
    
    This name is better suited for this variable.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 059e7ee761ca..8c0230125d00 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -60,19 +60,19 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 	u32 blk_sz = sizeof(u32);
 	const u8 *byte_buffer;
 	const u32 *dword_buffer = (u32 *)buffer;
-	u32 i, offset, blk_cnt, remain;
+	u32 i, write_address, blk_cnt, remain;
 
 	blk_cnt = size / blk_sz;
 	remain = size % blk_sz;
 
-	offset = FW_8192C_START_ADDRESS;
+	write_address = FW_8192C_START_ADDRESS;
 
-	for (i = 0; i < blk_cnt; i++, offset += blk_sz)
-		usb_write32(adapt, offset, dword_buffer[i]);
+	for (i = 0; i < blk_cnt; i++, write_address += blk_sz)
+		usb_write32(adapt, write_address, dword_buffer[i]);
 
 	byte_buffer = buffer + blk_cnt * blk_sz;
-	for (i = 0; i < remain; i++, offset++)
-		usb_write8(adapt, offset, byte_buffer[i]);
+	for (i = 0; i < remain; i++, write_address++)
+		usb_write8(adapt, write_address, byte_buffer[i]);
 }
 
 static void _rtl88e_fill_dummy(u8 *pfwbuf, u32 *pfwlen)

commit 7e91b28a015e1b478fe5e872dc8e46fc867c418f
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:54:28 2015 +0700

    staging: rtl8188eu: pu4BytePtr renamed to dword_buffer
    
    This name is better suited for this variable.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index f8f212f1e0af..059e7ee761ca 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -59,7 +59,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 {
 	u32 blk_sz = sizeof(u32);
 	const u8 *byte_buffer;
-	const u32 *pu4BytePtr = (u32 *)buffer;
+	const u32 *dword_buffer = (u32 *)buffer;
 	u32 i, offset, blk_cnt, remain;
 
 	blk_cnt = size / blk_sz;
@@ -68,7 +68,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 	offset = FW_8192C_START_ADDRESS;
 
 	for (i = 0; i < blk_cnt; i++, offset += blk_sz)
-		usb_write32(adapt, offset, pu4BytePtr[i]);
+		usb_write32(adapt, offset, dword_buffer[i]);
 
 	byte_buffer = buffer + blk_cnt * blk_sz;
 	for (i = 0; i < remain; i++, offset++)

commit 988c5146885f0f16e9124b4ae8e840229c4dc6d6
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:54:10 2015 +0700

    staging: rtl8188eu: buf_ptr renamed to byte_buffer
    
    This name is better suited for this variable.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 04ae5836d121..f8f212f1e0af 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -58,7 +58,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 				   const u8 *buffer, u32 size)
 {
 	u32 blk_sz = sizeof(u32);
-	const u8 *buf_ptr;
+	const u8 *byte_buffer;
 	const u32 *pu4BytePtr = (u32 *)buffer;
 	u32 i, offset, blk_cnt, remain;
 
@@ -70,9 +70,9 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 	for (i = 0; i < blk_cnt; i++, offset += blk_sz)
 		usb_write32(adapt, offset, pu4BytePtr[i]);
 
-	buf_ptr = buffer + blk_cnt * blk_sz;
+	byte_buffer = buffer + blk_cnt * blk_sz;
 	for (i = 0; i < remain; i++, offset++)
-		usb_write8(adapt, offset, buf_ptr[i]);
+		usb_write8(adapt, offset, byte_buffer[i]);
 }
 
 static void _rtl88e_fill_dummy(u8 *pfwbuf, u32 *pfwlen)

commit 6e84aa6c8251f9d5cb086cb9ba8d1a59a59e5cd9
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:53:43 2015 +0700

    staging: rtl8188eu: unnessesary braces for single statement block removed
    
    checkpatch fix:
    WARNING: braces {} are not necessary for single statement blocks
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index b48f4447dc40..04ae5836d121 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -67,14 +67,12 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 
 	offset = FW_8192C_START_ADDRESS;
 
-	for (i = 0; i < blk_cnt; i++, offset += blk_sz) {
+	for (i = 0; i < blk_cnt; i++, offset += blk_sz)
 		usb_write32(adapt, offset, pu4BytePtr[i]);
-	}
 
 	buf_ptr = buffer + blk_cnt * blk_sz;
-	for (i = 0; i < remain; i++, offset++) {
+	for (i = 0; i < remain; i++, offset++)
 		usb_write8(adapt, offset, buf_ptr[i]);
-	}
 }
 
 static void _rtl88e_fill_dummy(u8 *pfwbuf, u32 *pfwlen)

commit 429078e1f1ddf549ff9e282ed4a485b607b945cb
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:52:23 2015 +0700

    staging: rtl8188eu: unnecessary initialization removed
    
    It is superfluous.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 8eafd7e34f4a..b48f4447dc40 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -58,7 +58,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 				   const u8 *buffer, u32 size)
 {
 	u32 blk_sz = sizeof(u32);
-	const u8 *buf_ptr = (u8 *)buffer;
+	const u8 *buf_ptr;
 	const u32 *pu4BytePtr = (u32 *)buffer;
 	u32 i, offset, blk_cnt, remain;
 

commit 645d2a8f463c70f27fef2507952b71fdae71cf41
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:51:47 2015 +0700

    staging: rtl8188eu: types of local variables conformed with types of function arguments
    
    The array should not change in any case.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 4f1c3a2997b8..8eafd7e34f4a 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -58,8 +58,8 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 				   const u8 *buffer, u32 size)
 {
 	u32 blk_sz = sizeof(u32);
-	u8 *buf_ptr = (u8 *)buffer;
-	u32 *pu4BytePtr = (u32 *)buffer;
+	const u8 *buf_ptr = (u8 *)buffer;
+	const u32 *pu4BytePtr = (u32 *)buffer;
 	u32 i, offset, blk_cnt, remain;
 
 	blk_cnt = size / blk_sz;

commit 1e7e93ee6da0ee4c9054a9cb70748f1c34fe15bf
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:51:11 2015 +0700

    staging: rtl8188eu: buf_ptr variable completely defined in a single line
    
    It is simpler.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 3cfd2b2bc868..4f1c3a2997b8 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -71,7 +71,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 		usb_write32(adapt, offset, pu4BytePtr[i]);
 	}
 
-	buf_ptr += blk_cnt * blk_sz;
+	buf_ptr = buffer + blk_cnt * blk_sz;
 	for (i = 0; i < remain; i++, offset++) {
 		usb_write8(adapt, offset, buf_ptr[i]);
 	}

commit ec60e037c7e3e6b38b5c153d009d4f9161dd9e16
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:49:13 2015 +0700

    staging: rtl8188eu: offset increment placed into for loop header
    
    It makes the code little easier.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 44e807803a36..3cfd2b2bc868 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -67,14 +67,13 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 
 	offset = FW_8192C_START_ADDRESS;
 
-	for (i = 0; i < blk_cnt; i++) {
+	for (i = 0; i < blk_cnt; i++, offset += blk_sz) {
 		usb_write32(adapt, offset, pu4BytePtr[i]);
-		offset += blk_sz;
 	}
 
 	buf_ptr += blk_cnt * blk_sz;
-	for (i = 0; i < remain; i++) {
-		usb_write8(adapt, offset + i, buf_ptr[i]);
+	for (i = 0; i < remain; i++, offset++) {
+		usb_write8(adapt, offset, buf_ptr[i]);
 	}
 }
 

commit f464b3a08cefe3febcd30068d0a7ecd28f085b2d
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:48:22 2015 +0700

    staging: rtl8188eu: unnecessary branching removed
    
    If the 'remain' is zero, the loop is not executed at all.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 39c5a055fc1b..44e807803a36 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -72,11 +72,9 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 		offset += blk_sz;
 	}
 
-	if (remain) {
-		buf_ptr += blk_cnt * blk_sz;
-		for (i = 0; i < remain; i++) {
-			usb_write8(adapt, offset + i, buf_ptr[i]);
-		}
+	buf_ptr += blk_cnt * blk_sz;
+	for (i = 0; i < remain; i++) {
+		usb_write8(adapt, offset + i, buf_ptr[i]);
 	}
 }
 

commit 8107b147d78ba5f04ed5e809041b17273c1f5a02
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:47:32 2015 +0700

    staging: rtl8188eu: unnecessary variable override removed
    
    Variable value calculated in the previous loop.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 9673686bdc47..39c5a055fc1b 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -73,11 +73,9 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 	}
 
 	if (remain) {
-		offset = blk_cnt * blk_sz;
 		buf_ptr += blk_cnt * blk_sz;
 		for (i = 0; i < remain; i++) {
-			usb_write8(adapt, (FW_8192C_START_ADDRESS +
-						 offset + i), buf_ptr[i]);
+			usb_write8(adapt, offset + i, buf_ptr[i]);
 		}
 	}
 }

commit 37d5579095b380f3328a5106354c0999eeca60f2
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:46:53 2015 +0700

    staging: rtl8188eu: offset variable replaced by its value
    
    It is now possible to get rid of re-initializing the offset variable.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 99dd1f03afec..9673686bdc47 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -74,7 +74,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 
 	if (remain) {
 		offset = blk_cnt * blk_sz;
-		buf_ptr += offset;
+		buf_ptr += blk_cnt * blk_sz;
 		for (i = 0; i < remain; i++) {
 			usb_write8(adapt, (FW_8192C_START_ADDRESS +
 						 offset + i), buf_ptr[i]);

commit 1c48deffc7fa48a341ccc4bcef41f8ce2eab645f
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:46:08 2015 +0700

    staging: rtl8188eu: initial value placed in the variable
    
    Line become shorter.
    After the loop offset variable points to the location following insertion.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 70825e05fae9..99dd1f03afec 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -65,11 +65,10 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 	blk_cnt = size / blk_sz;
 	remain = size % blk_sz;
 
-	offset = 0;
+	offset = FW_8192C_START_ADDRESS;
 
 	for (i = 0; i < blk_cnt; i++) {
-		usb_write32(adapt, (FW_8192C_START_ADDRESS + offset),
-				pu4BytePtr[i]);
+		usb_write32(adapt, offset, pu4BytePtr[i]);
 		offset += blk_sz;
 	}
 

commit d44f58f7c5c737c6f95f3adf4af00a4a19746d9f
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:45:00 2015 +0700

    staging: rtl8188eu: assigning a value to the variable is replaced by the increment
    
    It is made to the initial value could be placed in the offset variable.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index af93697a6ab9..70825e05fae9 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -65,10 +65,12 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 	blk_cnt = size / blk_sz;
 	remain = size % blk_sz;
 
+	offset = 0;
+
 	for (i = 0; i < blk_cnt; i++) {
-		offset = i * blk_sz;
 		usb_write32(adapt, (FW_8192C_START_ADDRESS + offset),
 				pu4BytePtr[i]);
+		offset += blk_sz;
 	}
 
 	if (remain) {

commit 52863d83f3112b009aec82403c63f8fcf1c6c4cb
Author: Ivan Safonov <insafonov@gmail.com>
Date:   Tue Nov 3 16:43:53 2015 +0700

    staging: rtl8188eu: *(ptr + i) replaced by ptr[i] in _rtl88e_fw_block_write
    
    It is better to read.
    
    Signed-off-by: Ivan Safonov <insafonov@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 23aa6d37acac..af93697a6ab9 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -68,7 +68,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 	for (i = 0; i < blk_cnt; i++) {
 		offset = i * blk_sz;
 		usb_write32(adapt, (FW_8192C_START_ADDRESS + offset),
-				*(pu4BytePtr + i));
+				pu4BytePtr[i]);
 	}
 
 	if (remain) {
@@ -76,7 +76,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 		buf_ptr += offset;
 		for (i = 0; i < remain; i++) {
 			usb_write8(adapt, (FW_8192C_START_ADDRESS +
-						 offset + i), *(buf_ptr + i));
+						 offset + i), buf_ptr[i]);
 		}
 	}
 }

commit f79dc1679aff988297e020759c413f014a770aa9
Author: Amitoj Kaur Chawla <amitoj1606@gmail.com>
Date:   Mon Oct 26 23:27:20 2015 +0530

    staging: rtl8188eu: Remove unnecessary variables
    
    Remove unnecessary variable that can be replaced with a single line
    of code.
    
    The semantic patch used to find this is:
    
    // <smpl>
    @@
    expression ret;
    @@
    - if (ret) return ret;
    - return 0;
    + return ret;
    
    @@
    local idexpression ret;
    expression e;
    @@
    - ret = e;
    - return ret;
    + return e;
    
    @@
    type T;
    identifier i;
    expression E;
    @@
    - T i = E;
     ... when != i
    
    @@
    type T;
    identifier i;
    @@
    - T i;
     ... when != i
    // </smpl>
    
    Signed-off-by: Amitoj Kaur Chawla <amitoj1606@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index a71c54295508..23aa6d37acac 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -190,7 +190,6 @@ int rtl88eu_download_fw(struct adapter *adapt)
 	struct rtl92c_firmware_header *pfwheader = NULL;
 	u8 *pfwdata;
 	u32 fwsize;
-	int err;
 
 	if (request_firmware(&fw, fw_name, device)) {
 		dev_err(device, "Firmware %s not available\n", fw_name);
@@ -229,7 +228,5 @@ int rtl88eu_download_fw(struct adapter *adapt)
 	_rtl88e_write_fw(adapt, pfwdata, fwsize);
 	_rtl88e_enable_fw_download(adapt, false);
 
-	err = _rtl88e_fw_free_to_go(adapt);
-
-	return err;
+	return _rtl88e_fw_free_to_go(adapt);
 }

commit dacd2eced57b0df5676d189ee572d6ee40bd006e
Author: Vatika Harlalka <vatikaharlalka@gmail.com>
Date:   Fri Feb 27 11:25:38 2015 +0530

    Staging: rtl8188eu: Remove braces from single statement block
    
    Remove braces from single statement if condition
    to follow kernel coding convention.
    
    Signed-off-by: Vatika Harlalka <vatikaharlalka@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 3b2875481fc5..a71c54295508 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -154,9 +154,8 @@ static int _rtl88e_fw_free_to_go(struct adapter *adapt)
 			break;
 	} while (counter++ < POLLING_READY_TIMEOUT_COUNT);
 
-	if (counter >= POLLING_READY_TIMEOUT_COUNT) {
+	if (counter >= POLLING_READY_TIMEOUT_COUNT)
 		goto exit;
-	}
 
 	value32 = usb_read32(adapt, REG_MCUFWDL);
 	value32 |= MCUFWDL_RDY;

commit 7be921a226dcbbbd8fb6f5d63bea4856b3a11624
Author: Jia He <hejianet@gmail.com>
Date:   Tue Nov 4 09:39:58 2014 +0800

    staging: rtl8188eu: Fix coding style space related ERROR problems
    
    This fixes space related ERROR reports by checkpatch.pl
    Generated by $ git ls-files "drivers/staging/rtl8188eu/*.[ch]" | \
      xargs ./scripts/checkpatch.pl -f --fix-inplace --strict --types=SPACING
    Already checked by text comparasion
    $git diff -w
    and binary comparasion of r8188eu.ko
    $objdiff diff <old_commit> <new_commit>
    
    Signed-off-by: Jia He <hejianet@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 17b7f3750547..3b2875481fc5 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -84,7 +84,7 @@ static void _rtl88e_fw_block_write(struct adapter *adapt,
 static void _rtl88e_fill_dummy(u8 *pfwbuf, u32 *pfwlen)
 {
 	u32 fwlen = *pfwlen;
-	u8 remain = (u8) (fwlen % 4);
+	u8 remain = (u8)(fwlen % 4);
 
 	remain = (remain == 0) ? 0 : (4 - remain);
 
@@ -101,7 +101,7 @@ static void _rtl88e_fw_page_write(struct adapter *adapt,
 				  u32 page, const u8 *buffer, u32 size)
 {
 	u8 value8;
-	u8 u8page = (u8) (page & 0x07);
+	u8 u8page = (u8)(page & 0x07);
 
 	value8 = (usb_read8(adapt, REG_MCUFWDL + 2) & 0xF8) | u8page;
 
@@ -193,13 +193,13 @@ int rtl88eu_download_fw(struct adapter *adapt)
 	u32 fwsize;
 	int err;
 
-	if (request_firmware(&fw, fw_name, device)){
+	if (request_firmware(&fw, fw_name, device)) {
 		dev_err(device, "Firmware %s not available\n", fw_name);
 		return -ENOENT;
 	}
 
 	if (fw->size > FW_8188E_SIZE) {
-		dev_err(device,"Firmware size exceed 0x%X. Check it.\n",
+		dev_err(device, "Firmware size exceed 0x%X. Check it.\n",
 			 FW_8188E_SIZE);
 		return -1;
 	}

commit 90d88de82cd83852cb5b42f9c0a82708b111a59b
Author: Stephen Rothwell <sfr@canb.auug.org.au>
Date:   Mon Aug 18 08:40:48 2014 +1000

    staging: rtl8188eu: using unique names is good
    
    fixes:
    
    drivers/staging/built-in.o:(.opd+0xaab8): multiple definition of `rtl88e_phy_rf_config'
    drivers/net/built-in.o:(.opd+0x78840): first defined here
    drivers/staging/built-in.o:(.opd+0xa9f8): multiple definition of `rtl88e_download_fw'
    drivers/net/built-in.o:(.opd+0x781b0): first defined here
    drivers/staging/built-in.o: In function `.rtl88e_phy_rf_config':
    (.text+0xe0a00): multiple definition of `.rtl88e_phy_rf_config'
    drivers/net/built-in.o:(.text+0xe85a48): first defined here
    drivers/staging/built-in.o: In function `.rtl88e_download_fw':
    (.text+0xdf28c): multiple definition of `.rtl88e_download_fw'
    drivers/net/built-in.o:(.text+0xe6f330): first defined here
    drivers/staging/built-in.o: In function `.rtl88e_phy_mac_config':
    (.text+0xdf984): multiple definition of `.rtl88e_phy_mac_config'
    drivers/net/built-in.o:(.text+0xe84a8c): first defined here
    drivers/staging/built-in.o: In function `.rtl88e_phy_bb_config':
    (.text+0xdfa2c): multiple definition of `.rtl88e_phy_bb_config'
    drivers/net/built-in.o:(.text+0xe84d14): first defined here
    drivers/staging/built-in.o:(.opd+0xaa58): multiple definition of `rtl88e_phy_bb_config'
    drivers/net/built-in.o:(.opd+0x78828): first defined here
    drivers/staging/built-in.o:(.opd+0xaa28): multiple definition of `rtl88e_phy_mac_config'
    
    Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
index 09324ae80e72..17b7f3750547 100644
--- a/drivers/staging/rtl8188eu/hal/fw.c
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -181,7 +181,7 @@ static int _rtl88e_fw_free_to_go(struct adapter *adapt)
 	return err;
 }
 
-int rtl88e_download_fw(struct adapter *adapt)
+int rtl88eu_download_fw(struct adapter *adapt)
 {
 	struct hal_data_8188e *rtlhal = GET_HAL_DATA(adapt);
 	struct dvobj_priv *dvobj = adapter_to_dvobj(adapt);

commit d6c28c23f89b00a01b34670f0f1ddcdc2e0bca67
Author: navin patidar <navin.patidar@gmail.com>
Date:   Sun Aug 10 20:14:14 2014 +0530

    staging: rtl8188eu: Cleanup firmware initialization code
    
    Using rtl8188ee's (drivers/net/wireless/rtlwifi/rtl8188ee/fw.c) neat and clean
    firmware initialization code to replace rtl8188eu's messy firmware
    initialization code.
    
    Signed-off-by: navin patidar <navin.patidar@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/rtl8188eu/hal/fw.c b/drivers/staging/rtl8188eu/hal/fw.c
new file mode 100644
index 000000000000..09324ae80e72
--- /dev/null
+++ b/drivers/staging/rtl8188eu/hal/fw.c
@@ -0,0 +1,236 @@
+/******************************************************************************
+ *
+ * Copyright(c) 2009-2013  Realtek Corporation.
+ *
+ * This program is free software; you can redistribute it and/or modify it
+ * under the terms of version 2 of the GNU General Public License as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
+ * more details.
+ *
+ * You should have received a copy of the GNU General Public License along with
+ * this program; if not, write to the Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA
+ *
+ * The full GNU General Public License is included in this distribution in the
+ * file called LICENSE.
+ *
+ * Contact Information:
+ * wlanfae <wlanfae@realtek.com>
+ * Realtek Corporation, No. 2, Innovation Road II, Hsinchu Science Park,
+ * Hsinchu 300, Taiwan.
+ *
+ * Larry Finger <Larry.Finger@lwfinger.net>
+ *
+ *****************************************************************************/
+
+#include "fw.h"
+#include "drv_types.h"
+#include "usb_ops_linux.h"
+#include "rtl8188e_spec.h"
+#include "rtl8188e_hal.h"
+
+#include <linux/firmware.h>
+#include <linux/kmemleak.h>
+
+static void _rtl88e_enable_fw_download(struct adapter *adapt, bool enable)
+{
+	u8 tmp;
+
+	if (enable) {
+		tmp = usb_read8(adapt, REG_MCUFWDL);
+		usb_write8(adapt, REG_MCUFWDL, tmp | 0x01);
+
+		tmp = usb_read8(adapt, REG_MCUFWDL + 2);
+		usb_write8(adapt, REG_MCUFWDL + 2, tmp & 0xf7);
+	} else {
+		tmp = usb_read8(adapt, REG_MCUFWDL);
+		usb_write8(adapt, REG_MCUFWDL, tmp & 0xfe);
+
+		usb_write8(adapt, REG_MCUFWDL + 1, 0x00);
+	}
+}
+
+static void _rtl88e_fw_block_write(struct adapter *adapt,
+				   const u8 *buffer, u32 size)
+{
+	u32 blk_sz = sizeof(u32);
+	u8 *buf_ptr = (u8 *)buffer;
+	u32 *pu4BytePtr = (u32 *)buffer;
+	u32 i, offset, blk_cnt, remain;
+
+	blk_cnt = size / blk_sz;
+	remain = size % blk_sz;
+
+	for (i = 0; i < blk_cnt; i++) {
+		offset = i * blk_sz;
+		usb_write32(adapt, (FW_8192C_START_ADDRESS + offset),
+				*(pu4BytePtr + i));
+	}
+
+	if (remain) {
+		offset = blk_cnt * blk_sz;
+		buf_ptr += offset;
+		for (i = 0; i < remain; i++) {
+			usb_write8(adapt, (FW_8192C_START_ADDRESS +
+						 offset + i), *(buf_ptr + i));
+		}
+	}
+}
+
+static void _rtl88e_fill_dummy(u8 *pfwbuf, u32 *pfwlen)
+{
+	u32 fwlen = *pfwlen;
+	u8 remain = (u8) (fwlen % 4);
+
+	remain = (remain == 0) ? 0 : (4 - remain);
+
+	while (remain > 0) {
+		pfwbuf[fwlen] = 0;
+		fwlen++;
+		remain--;
+	}
+
+	*pfwlen = fwlen;
+}
+
+static void _rtl88e_fw_page_write(struct adapter *adapt,
+				  u32 page, const u8 *buffer, u32 size)
+{
+	u8 value8;
+	u8 u8page = (u8) (page & 0x07);
+
+	value8 = (usb_read8(adapt, REG_MCUFWDL + 2) & 0xF8) | u8page;
+
+	usb_write8(adapt, (REG_MCUFWDL + 2), value8);
+	_rtl88e_fw_block_write(adapt, buffer, size);
+}
+
+static void _rtl88e_write_fw(struct adapter *adapt, u8 *buffer, u32 size)
+{
+	u8 *buf_ptr = buffer;
+	u32 page_no, remain;
+	u32 page, offset;
+
+	_rtl88e_fill_dummy(buf_ptr, &size);
+
+	page_no = size / FW_8192C_PAGE_SIZE;
+	remain = size % FW_8192C_PAGE_SIZE;
+
+	for (page = 0; page < page_no; page++) {
+		offset = page * FW_8192C_PAGE_SIZE;
+		_rtl88e_fw_page_write(adapt, page, (buf_ptr + offset),
+				      FW_8192C_PAGE_SIZE);
+	}
+
+	if (remain) {
+		offset = page_no * FW_8192C_PAGE_SIZE;
+		page = page_no;
+		_rtl88e_fw_page_write(adapt, page, (buf_ptr + offset), remain);
+	}
+}
+
+static void rtl88e_firmware_selfreset(struct adapter *adapt)
+{
+	u8 u1b_tmp;
+
+	u1b_tmp = usb_read8(adapt, REG_SYS_FUNC_EN+1);
+	usb_write8(adapt, REG_SYS_FUNC_EN+1, (u1b_tmp & (~BIT(2))));
+	usb_write8(adapt, REG_SYS_FUNC_EN+1, (u1b_tmp | BIT(2)));
+}
+
+static int _rtl88e_fw_free_to_go(struct adapter *adapt)
+{
+	int err = -EIO;
+	u32 counter = 0;
+	u32 value32;
+
+	do {
+		value32 = usb_read32(adapt, REG_MCUFWDL);
+		if (value32 & FWDL_ChkSum_rpt)
+			break;
+	} while (counter++ < POLLING_READY_TIMEOUT_COUNT);
+
+	if (counter >= POLLING_READY_TIMEOUT_COUNT) {
+		goto exit;
+	}
+
+	value32 = usb_read32(adapt, REG_MCUFWDL);
+	value32 |= MCUFWDL_RDY;
+	value32 &= ~WINTINI_RDY;
+	usb_write32(adapt, REG_MCUFWDL, value32);
+
+	rtl88e_firmware_selfreset(adapt);
+	counter = 0;
+
+	do {
+		value32 = usb_read32(adapt, REG_MCUFWDL);
+		if (value32 & WINTINI_RDY) {
+			err = 0;
+			goto exit;
+		}
+
+		udelay(FW_8192C_POLLING_DELAY);
+
+	} while (counter++ < POLLING_READY_TIMEOUT_COUNT);
+
+exit:
+	return err;
+}
+
+int rtl88e_download_fw(struct adapter *adapt)
+{
+	struct hal_data_8188e *rtlhal = GET_HAL_DATA(adapt);
+	struct dvobj_priv *dvobj = adapter_to_dvobj(adapt);
+	struct device *device = dvobj_to_dev(dvobj);
+	const struct firmware *fw;
+	const char fw_name[] = "rtlwifi/rtl8188eufw.bin";
+	struct rtl92c_firmware_header *pfwheader = NULL;
+	u8 *pfwdata;
+	u32 fwsize;
+	int err;
+
+	if (request_firmware(&fw, fw_name, device)){
+		dev_err(device, "Firmware %s not available\n", fw_name);
+		return -ENOENT;
+	}
+
+	if (fw->size > FW_8188E_SIZE) {
+		dev_err(device,"Firmware size exceed 0x%X. Check it.\n",
+			 FW_8188E_SIZE);
+		return -1;
+	}
+
+	pfwdata = kzalloc(FW_8188E_SIZE, GFP_KERNEL);
+	if (!pfwdata)
+		return -ENOMEM;
+
+	rtlhal->pfirmware = pfwdata;
+	memcpy(rtlhal->pfirmware, fw->data, fw->size);
+	rtlhal->fwsize = fw->size;
+	release_firmware(fw);
+
+	fwsize = rtlhal->fwsize;
+	pfwheader = (struct rtl92c_firmware_header *)pfwdata;
+
+	if (IS_FW_HEADER_EXIST(pfwheader)) {
+		pfwdata = pfwdata + 32;
+		fwsize = fwsize - 32;
+	}
+
+	if (usb_read8(adapt, REG_MCUFWDL) & RAM_DL_SEL) {
+		usb_write8(adapt, REG_MCUFWDL, 0);
+		rtl88e_firmware_selfreset(adapt);
+	}
+	_rtl88e_enable_fw_download(adapt, true);
+	usb_write8(adapt, REG_MCUFWDL, usb_read8(adapt, REG_MCUFWDL) | FWDL_ChkSum_rpt);
+	_rtl88e_write_fw(adapt, pfwdata, fwsize);
+	_rtl88e_enable_fw_download(adapt, false);
+
+	err = _rtl88e_fw_free_to_go(adapt);
+
+	return err;
+}
