commit a6d1bfa05545b0d34f5b5093248b10a745c050e3
Author: Lad Prabhakar <prabhakar.mahadev-lad.rj@bp.renesas.com>
Date:   Mon Apr 27 13:53:30 2020 +0100

    cpufreq: dt: Add support for r8a7742
    
    Add the compatible strings for supporting the generic cpufreq driver on
    the Renesas RZ/G1H (R8A7742) SoC.
    
    Signed-off-by: Lad Prabhakar <prabhakar.mahadev-lad.rj@bp.renesas.com>
    Reviewed-by: Marian-Cristian Rotariu <marian-cristian.rotariu.rb@bp.renesas.com>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 5c8baf603e05..e8e20fef400b 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -53,6 +53,7 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "renesas,r7s72100", },
 	{ .compatible = "renesas,r8a73a4", },
 	{ .compatible = "renesas,r8a7740", },
+	{ .compatible = "renesas,r8a7742", },
 	{ .compatible = "renesas,r8a7743", },
 	{ .compatible = "renesas,r8a7744", },
 	{ .compatible = "renesas,r8a7745", },

commit a08e1b6c2d0b9ab7889ac1f7b5c535affbe5032e
Author: Peng Fan <peng.fan@nxp.com>
Date:   Mon Apr 20 15:55:13 2020 +0800

    cpufreq: Add i.MX7ULP to cpufreq-dt-platdev blacklist
    
    Add i.MX7ULP to cpufreq-dt-platdev blacklist.
    
    Signed-off-by: Peng Fan <peng.fan@nxp.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index cb9db16bea61..5c8baf603e05 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -105,6 +105,7 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "calxeda,highbank", },
 	{ .compatible = "calxeda,ecx-2000", },
 
+	{ .compatible = "fsl,imx7ulp", },
 	{ .compatible = "fsl,imx7d", },
 	{ .compatible = "fsl,imx8mq", },
 	{ .compatible = "fsl,imx8mm", },

commit a8811ec764f95a04ba82f6f457e28c5e9e36e36b
Author: Ansuel Smith <ansuelsmth@gmail.com>
Date:   Fri Mar 13 18:52:13 2020 +0100

    cpufreq: qcom: Add support for krait based socs
    
    In Certain QCOM SoCs like ipq8064, apq8064, msm8960, msm8974
    that has KRAIT processors the voltage/current value of each OPP
    varies based on the silicon variant in use.
    
    The required OPP related data is determined based on
    the efuse value. This is similar to the existing code for
    kryo cores. So adding support for krait cores here.
    
    Signed-off-by: Sricharan R <sricharan@codeaurora.org>
    Signed-off-by: Ansuel Smith <ansuelsmth@gmail.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index f2ae9cd455c1..cb9db16bea61 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -141,6 +141,11 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "ti,dra7", },
 	{ .compatible = "ti,omap3", },
 
+	{ .compatible = "qcom,ipq8064", },
+	{ .compatible = "qcom,apq8064", },
+	{ .compatible = "qcom,msm8974", },
+	{ .compatible = "qcom,msm8960", },
+
 	{ }
 };
 

commit 24f371f77e101c0ed05cdbe22d95ad7683f9de88
Author: Anson Huang <Anson.Huang@nxp.com>
Date:   Thu Dec 26 14:52:46 2019 +0800

    cpufreq: Use imx-cpufreq-dt for i.MX8MP's speed grading
    
    Add i.MX8MP to blacklist, so that imx-cpufreq-dt driver can handle
    speed grading bits just like other i.MX8M SoCs.
    
    Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index aba591d57c67..f2ae9cd455c1 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -109,6 +109,7 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "fsl,imx8mq", },
 	{ .compatible = "fsl,imx8mm", },
 	{ .compatible = "fsl,imx8mn", },
+	{ .compatible = "fsl,imx8mp", },
 
 	{ .compatible = "marvell,armadaxp", },
 

commit 26a7a47510ed12cbbce689184c8d6b63062b4fb9
Author: Dmitry Osipenko <digetx@gmail.com>
Date:   Mon Nov 18 19:45:08 2019 +0300

    cpufreq: dt-platdev: Blacklist NVIDIA Tegra20 and Tegra30 SoCs
    
    Both NVIDIA Tegra20 and Tegra30 SoCs should be blacklisted because CPU
    OPPs use supported_hw and thus platdev isn't suitable for these SoCs.
    Currently cpufreq-dt driver produces a bit annoying warning splats
    during boot because valid OPPs are not found, this will be fixed once
    tegra20-cpufreq driver will be update to support cpufreq-dt. The warnings
    will also happen on older stable kernels using newer device-trees, thus
    this patch should be backported to stable kernels as well.
    
    Cc: <stable@vger.kernel.org>
    Reported-by: Jon Hunter <jonathanh@nvidia.com>
    Fixes: 4053aa65c517 ("ARM: tegra: cardhu-a04: Add CPU Operating Performance Points")
    Signed-off-by: Dmitry Osipenko <digetx@gmail.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index f1d170dcf4d3..aba591d57c67 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -121,6 +121,8 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "mediatek,mt8176", },
 	{ .compatible = "mediatek,mt8183", },
 
+	{ .compatible = "nvidia,tegra20", },
+	{ .compatible = "nvidia,tegra30", },
 	{ .compatible = "nvidia,tegra124", },
 	{ .compatible = "nvidia,tegra210", },
 

commit fb3da48a8640f634242a0c61b78c3a5c724c5004
Merge: 5ecc9d15f73b 163b00cde7cf
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Dec 5 11:21:24 2019 -0800

    Merge branch 'thermal/next' of git://git.kernel.org/pub/scm/linux/kernel/git/thermal/linux
    
    Pull thermal management updates from Zhang Rui:
    
     - Fix a deadlock regression in thermal core framework, which was
       introduced in 5.3 (Wei Wang)
    
     - Initialize thermal control framework earlier to enable thermal
       mitigation during boot (Amit Kucheria)
    
     - Convert the Intelligent Power Allocator (IPA) thermal governor to
       follow the generic PM_EM instead of its own Energy Model (Quentin
       Perret)
    
     - Introduce a new Amlogic soc thermal driver (Guillaume La Roque)
    
     - Add interrupt support for tsens thermal driver (Amit Kucheria)
    
     - Add support for MSM8956/8976 in tsens thermal driver
       (AngeloGioacchino Del Regno)
    
     - Add support for r8a774b1 in rcar thermal driver (Biju Das)
    
     - Add support for Thermal Monitor Unit v2 in qoriq thermal driver
       (Yuantian Tang)
    
     - Some other fixes/cleanups on thermal core framework and soc thermal
       drivers (Colin Ian King, Daniel Lezcano, Hsin-Yi Wang, Tian Tao)
    
    * 'thermal/next' of git://git.kernel.org/pub/scm/linux/kernel/git/thermal/linux: (32 commits)
      thermal: Fix deadlock in thermal thermal_zone_device_check
      thermal: cpu_cooling: Migrate to using the EM framework
      thermal: cpu_cooling: Make the power-related code depend on IPA
      PM / EM: Declare EM data types unconditionally
      arm64: defconfig: Enable CONFIG_ENERGY_MODEL
      drivers: thermal: tsens: fix potential integer overflow on multiply
      thermal: cpu_cooling: Reorder the header file
      thermal: cpu_cooling: Remove pointless dependency on CONFIG_OF
      thermal: no need to set .owner when using module_platform_driver
      thermal: qcom: tsens-v1: Fix kfree of a non-pointer value
      cpufreq: qcom-hw: Move driver initialization earlier
      clk: qcom: Initialize clock drivers earlier
      cpufreq: Initialize cpufreq-dt driver earlier
      cpufreq: Initialize the governors in core_initcall
      thermal: Initialize thermal subsystem earlier
      thermal: Remove netlink support
      dt: thermal: tsens: Document compatible for MSM8976/56
      thermal: qcom: tsens-v1: Add support for MSM8956 and MSM8976
      MAINTAINERS: add entry for Amlogic Thermal driver
      thermal: amlogic: Add thermal driver to support G12 SoCs
      ...

commit 57db08f41b2a8f6c22036290400a59a2b3ff3390
Author: Amit Kucheria <amit.kucheria@linaro.org>
Date:   Mon Oct 21 17:45:13 2019 +0530

    cpufreq: Initialize cpufreq-dt driver earlier
    
    This allows HW drivers that depend on cpufreq-dt to initialize earlier.
    
    Signed-off-by: Amit Kucheria <amit.kucheria@linaro.org>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org>
    Link: https://lore.kernel.org/r/353c745d4ca1feff600bd44154c01c013f185ca4.1571656015.git.amit.kucheria@linaro.org

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index bca8d1f47fd2..3282defe14d4 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -180,4 +180,4 @@ static int __init cpufreq_dt_platdev_init(void)
 			       -1, data,
 			       sizeof(struct cpufreq_dt_platform_data)));
 }
-device_initcall(cpufreq_dt_platdev_init);
+core_initcall(cpufreq_dt_platdev_init);

commit b7dbe349e1eb5a1c07b58da83d8ee60030682a3a
Author: H. Nikolaus Schaller <hns@goldelico.com>
Date:   Wed Sep 11 19:47:08 2019 +0200

    ARM: dts: omap34xx & omap36xx: replace opp-v1 tables by opp-v2 for
    
    With the driver installed, we can change the opp-v1 table format
    to opp-v2.
    
    In addition, move omap3 from whitelist to blacklist in cpufreq-dt-platdev
    in the same patch, because doing either first breaks operation and
    may make trouble in bisect.
    
    We also can remove opp-v1 table for omap3-n950-n9 since its 1GHz
    capability is now automatically detected.
    
    We also fix a wrong OPP4 voltage for omap3430 which must be
    0.6V + 54*12.5mV = 1275mV. Otherwise the twl4030 driver will reject
    this OPP.
    
    Note: the high speed OPPs that were not available in the opp-v1 tables
    are tagged "turbo-mode;" which means they are not automatically
    activated by the govenors or cpu-freq.
    
    To enable you have to write
    
    echo 1 >/sys/devices/system/cpu/cpufreq/boost
    
    Note: to hard disable an OPP in a board.dts file use e.g.
    
    &cpu0_opp_table: {
            /delete-node/ opp1g-1000000000; /* do not use */
    };
    
    or alternatively:
    
    &cpu0_opp_table: {
            opp1g-1000000000 {
                    status = "disabled";    /* do not use */
            };
    };
    
    Signed-off-by: H. Nikolaus Schaller <hns@goldelico.com>
    Acked-by: Tony Lindgren <tony@atomide.com>
    Tested-by: Adam Ford <aford173@gmail.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index bca8d1f47fd2..54bc76743b1f 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -86,7 +86,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "st-ericsson,u9540", },
 
 	{ .compatible = "ti,omap2", },
-	{ .compatible = "ti,omap3", },
 	{ .compatible = "ti,omap4", },
 	{ .compatible = "ti,omap5", },
 
@@ -137,6 +136,7 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "ti,am33xx", },
 	{ .compatible = "ti,am43", },
 	{ .compatible = "ti,dra7", },
+	{ .compatible = "ti,omap3", },
 
 	{ }
 };

commit f75d2accca7785657311653c125bb22f342dc5d9
Merge: 9176b425bf8f 248b5f297cf8
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Tue Sep 3 07:55:22 2019 +0530

    Merge branch 'cpufreq/qcom-updates' into cpufreq/arm/linux-next

commit 248b5f297cf809b6a61e38db22049011f619518b
Author: Jorge Ramirez-Ortiz <jorge.ramirez-ortiz@linaro.org>
Date:   Thu Jul 25 12:41:36 2019 +0200

    cpufreq: Add qcs404 to cpufreq-dt-platdev blacklist
    
    Add qcs404 to cpufreq-dt-platdev blacklist.
    
    Signed-off-by: Jorge Ramirez-Ortiz <jorge.ramirez-ortiz@linaro.org>
    Co-developed-by: Niklas Cassel <niklas.cassel@linaro.org>
    Signed-off-by: Niklas Cassel <niklas.cassel@linaro.org>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 03dc4244ab00..ec6ef996e637 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -123,6 +123,7 @@ static const struct of_device_id blacklist[] __initconst = {
 
 	{ .compatible = "qcom,apq8096", },
 	{ .compatible = "qcom,msm8996", },
+	{ .compatible = "qcom,qcs404", },
 
 	{ .compatible = "st,stih407", },
 	{ .compatible = "st,stih410", },

commit 9176b425bf8ff98fd12bffeea8e39373345cd745
Author: Andrew-sh.Cheng <andrew-sh.cheng@mediatek.com>
Date:   Tue Aug 13 21:31:48 2019 +0800

    cpufreq: mediatek: Add support for mt8183
    
    Add compatible string for mediatek mt8183
    
    Signed-off-by: Andrew-sh.Cheng <andrew-sh.cheng@mediatek.com>
    [ VK: Fixed rebase conflict ]
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 6fce11f63403..d51bfef286e3 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -120,6 +120,7 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "mediatek,mt817x", },
 	{ .compatible = "mediatek,mt8173", },
 	{ .compatible = "mediatek,mt8176", },
+	{ .compatible = "mediatek,mt8183", },
 
 	{ .compatible = "nvidia,tegra124", },
 	{ .compatible = "nvidia,tegra210", },

commit 8ec5035039c743888c5ecd04a680676ef1537fe8
Author: Anson Huang <Anson.Huang@nxp.com>
Date:   Sun Aug 18 02:32:21 2019 -0400

    cpufreq: Use imx-cpufreq-dt for i.MX8MN's speed grading
    
    Add i.MX8MN to blacklist, so that imx-cpufreq-dt driver can handle
    speed grading bits just like other i.MX8M SoCs.
    
    Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
    Reviewed-by: Leonard Crestez <leonard.crestez@nxp.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index f9444ddd35ab..6fce11f63403 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -109,6 +109,7 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "fsl,imx7d", },
 	{ .compatible = "fsl,imx8mq", },
 	{ .compatible = "fsl,imx8mm", },
+	{ .compatible = "fsl,imx8mn", },
 
 	{ .compatible = "marvell,armadaxp", },
 

commit f328584f7bff86858249bb358f1adcecde48388a
Author: Yangtao Li <tiny.windzz@gmail.com>
Date:   Wed Jun 12 12:28:15 2019 -0400

    cpufreq: Add sun50i nvmem based CPU scaling driver
    
    For some SoCs, the CPU frequency subset and voltage value of each OPP
    varies based on the silicon variant in use. The sun50i-cpufreq-nvmem
    driver reads the efuse value from the SoC to provide the OPP framework
    with required information.
    
    Signed-off-by: Yangtao Li <tiny.windzz@gmail.com>
    Acked-by: Maxime Ripard <maxime.ripard@bootlin.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 03dc4244ab00..f9444ddd35ab 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -101,6 +101,8 @@ static const struct of_device_id whitelist[] __initconst = {
  * platforms using "operating-points-v2" property.
  */
 static const struct of_device_id blacklist[] __initconst = {
+	{ .compatible = "allwinner,sun50i-h6", },
+
 	{ .compatible = "calxeda,highbank", },
 	{ .compatible = "calxeda,ecx-2000", },
 

commit 586a07dca8c51b966960d1f0d8be9c27d7e0a95c
Merge: 13b06b78c772 70a59fde6e69
Author: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Date:   Mon Jul 8 11:00:02 2019 +0200

    Merge branch 'pm-cpufreq'
    
    * pm-cpufreq:
      cpufreq: Avoid calling cpufreq_verify_current_freq() from handle_update()
      cpufreq: Consolidate cpufreq_update_current_freq() and __cpufreq_get()
      cpufreq: Don't skip frequency validation for has_target() drivers
      cpufreq: Use has_target() instead of !setpolicy
      cpufreq: Remove redundant !setpolicy check
      cpufreq: Move the IS_ENABLED(CPU_THERMAL) macro into a stub
      cpufreq: s5pv210: Don't flood kernel log after cpufreq change
      cpufreq: pcc-cpufreq: Fail initialization if driver cannot be registered
      cpufreq: add driver for Raspberry Pi
      cpufreq: Switch imx7d to imx-cpufreq-dt for speed grading
      cpufreq: imx-cpufreq-dt: Remove global platform match list
      cpufreq: brcmstb-avs-cpufreq: Fix types for voltage/frequency
      cpufreq: brcmstb-avs-cpufreq: Fix initial command check
      cpufreq: armada-37xx: Remove set but not used variable 'freq'
      cpufreq: imx-cpufreq-dt: Fix no OPPs available on unfused parts
      dt-bindings: imx-cpufreq-dt: Document opp-supported-hw usage
      cpufreq: Add imx-cpufreq-dt driver

commit d2912cb15bdda8ba4a5dd73396ad62641af2f520
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Tue Jun 4 10:11:33 2019 +0200

    treewide: Replace GPLv2 boilerplate/reference with SPDX - rule 500
    
    Based on 2 normalized pattern(s):
    
      this program is free software you can redistribute it and or modify
      it under the terms of the gnu general public license version 2 as
      published by the free software foundation
    
      this program is free software you can redistribute it and or modify
      it under the terms of the gnu general public license version 2 as
      published by the free software foundation #
    
    extracted by the scancode license scanner the SPDX license identifier
    
      GPL-2.0-only
    
    has been chosen to replace the boilerplate/reference in 4122 file(s).
    
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Reviewed-by: Enrico Weigelt <info@metux.net>
    Reviewed-by: Kate Stewart <kstewart@linuxfoundation.org>
    Reviewed-by: Allison Randal <allison@lohutok.net>
    Cc: linux-spdx@vger.kernel.org
    Link: https://lkml.kernel.org/r/20190604081206.933168790@linutronix.de
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 47729a22c159..88e00683eaeb 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -1,10 +1,7 @@
+// SPDX-License-Identifier: GPL-2.0-only
 /*
  * Copyright (C) 2016 Linaro.
  * Viresh Kumar <viresh.kumar@linaro.org>
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License version 2 as
- * published by the Free Software Foundation.
  */
 
 #include <linux/err.h>

commit e6abacabb5acb6315e0e9560b2cb50a4d55b6e09
Author: Leonard Crestez <leonard.crestez@nxp.com>
Date:   Wed Jun 5 13:37:06 2019 +0300

    cpufreq: Switch imx7d to imx-cpufreq-dt for speed grading
    
    This driver can handle speed grading bits on imx7d just like on imx8mq
    and imx8mm.
    
    Signed-off-by: Leonard Crestez <leonard.crestez@nxp.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 19c1aad57e26..eb282dff9f2c 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -40,7 +40,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "fsl,imx27", },
 	{ .compatible = "fsl,imx51", },
 	{ .compatible = "fsl,imx53", },
-	{ .compatible = "fsl,imx7d", },
 
 	{ .compatible = "marvell,berlin", },
 	{ .compatible = "marvell,pxa250", },
@@ -108,6 +107,7 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "calxeda,highbank", },
 	{ .compatible = "calxeda,ecx-2000", },
 
+	{ .compatible = "fsl,imx7d", },
 	{ .compatible = "fsl,imx8mq", },
 	{ .compatible = "fsl,imx8mm", },
 

commit 4d28ba1d62c48d5242ca30fa0051ab3498bc5c5b
Author: Leonard Crestez <leonard.crestez@nxp.com>
Date:   Mon May 13 11:01:38 2019 +0000

    cpufreq: Add imx-cpufreq-dt driver
    
    Right now in upstream imx8m cpufreq support just lists a common subset
    of OPPs because the higher ones should only be attempted after checking
    speed grading in fuses.
    
    Add a small driver which checks speed grading from nvmem cells before
    registering cpufreq-dt.
    
    This driver allows unlocking all frequencies for imx8mm and imx8mq and
    could be applied to other chips like imx7d
    
    Signed-off-by: Leonard Crestez <leonard.crestez@nxp.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 47729a22c159..19c1aad57e26 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -108,6 +108,9 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "calxeda,highbank", },
 	{ .compatible = "calxeda,ecx-2000", },
 
+	{ .compatible = "fsl,imx8mq", },
+	{ .compatible = "fsl,imx8mm", },
+
 	{ .compatible = "marvell,armadaxp", },
 
 	{ .compatible = "mediatek,mt2701", },

commit 43c36002b86d6027b48f7c68ac32245f73f29f6b
Author: Joseph Lo <josephl@nvidia.com>
Date:   Fri Jan 4 11:06:55 2019 +0800

    cpufreq: dt-platdev: add Tegra210 to blacklist
    
    Tegra210 uses "tegra124-cpufreq" platform driver to register device data
    for "cpufreq-dt" driver. So add it in the blacklist for
    "cpufreq-dt-platdev" driver to drop that.
    
    Cc: Viresh Kumar <viresh.kumar@linaro.org>
    Cc: linux-pm@vger.kernel.org
    Signed-off-by: Joseph Lo <josephl@nvidia.com>
    Acked-by: Jon Hunter <jonathanh@nvidia.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Thierry Reding <treding@nvidia.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index b1c5468dca16..47729a22c159 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -119,6 +119,7 @@ static const struct of_device_id blacklist[] __initconst = {
 	{ .compatible = "mediatek,mt8176", },
 
 	{ .compatible = "nvidia,tegra124", },
+	{ .compatible = "nvidia,tegra210", },
 
 	{ .compatible = "qcom,apq8096", },
 	{ .compatible = "qcom,msm8996", },

commit 9d21d33cab2dd5aadd23ad51baf1dc49d544fcc0
Author: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Date:   Fri Oct 5 12:00:58 2018 -0700

    cpufreq: dt-platdev: allow RK3399 to have separate tunables per cluster
    
    RK3899 has one cluster with 4 small cores, and another one with 2 big
    cores, with cores in different clusters having different OPPs and thus
    needing separate set of tunables. Let's enable this via
    "have_governor_per_policy" platform data.
    
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 805f8a0c3470..b1c5468dca16 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -79,7 +79,10 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "rockchip,rk3328", },
 	{ .compatible = "rockchip,rk3366", },
 	{ .compatible = "rockchip,rk3368", },
-	{ .compatible = "rockchip,rk3399", },
+	{ .compatible = "rockchip,rk3399",
+	  .data = &(struct cpufreq_dt_platform_data)
+		{ .have_governor_per_policy = true, },
+	},
 
 	{ .compatible = "st-ericsson,u8500", },
 	{ .compatible = "st-ericsson,u8540", },

commit d1e1303173d7fe3c107a85805a62c13e760f2da4
Author: Biju Das <biju.das@bp.renesas.com>
Date:   Tue Sep 11 11:12:51 2018 +0100

    cpufreq: dt: Add support for r8a7744
    
    Add the compatible strings for supporting the generic cpufreq driver on
    the Renesas RZ/G1N (R8A7744) SoC.
    
    Signed-off-by: Biju Das <biju.das@bp.renesas.com>
    Reviewed-by: Fabrizio Castro <fabrizio.castro@bp.renesas.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Reviewed-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index fe14c57de6ca..805f8a0c3470 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -58,6 +58,7 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "renesas,r8a73a4", },
 	{ .compatible = "renesas,r8a7740", },
 	{ .compatible = "renesas,r8a7743", },
+	{ .compatible = "renesas,r8a7744", },
 	{ .compatible = "renesas,r8a7745", },
 	{ .compatible = "renesas,r8a7778", },
 	{ .compatible = "renesas,r8a7779", },

commit 46e2856b8e188949757c9123fd7f9ce36edd1a52
Author: Ilia Lin <ilialin@codeaurora.org>
Date:   Wed May 30 05:39:28 2018 +0300

    cpufreq: Add Kryo CPU scaling driver
    
    In Certain QCOM SoCs like apq8096 and msm8996 that have KRYO processors,
    the CPU frequency subset and voltage value of each OPP varies
    based on the silicon variant in use. Qualcomm Process Voltage Scaling Tables
    defines the voltage and frequency value based on the msm-id in SMEM
    and speedbin blown in the efuse combination.
    The qcom-cpufreq-kryo driver reads the msm-id and efuse value from the SoC
    to provide the OPP framework with required information.
    This is used to determine the voltage and frequency value for each OPP of
    operating-points-v2 table when it is parsed by the OPP framework.
    
    Signed-off-by: Ilia Lin <ilialin@codeaurora.org>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Reviewed-by: Amit Kucheria <amit.kucheria@linaro.org>
    Tested-by: Amit Kucheria <amit.kucheria@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index c2165edadd41..fe14c57de6ca 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -116,6 +116,9 @@ static const struct of_device_id blacklist[] __initconst = {
 
 	{ .compatible = "nvidia,tegra124", },
 
+	{ .compatible = "qcom,apq8096", },
+	{ .compatible = "qcom,msm8996", },
+
 	{ .compatible = "st,stih407", },
 	{ .compatible = "st,stih410", },
 

commit 144ec880edd17139fb1c8214615193b2c3f02abf
Author: Simon Horman <horms+renesas@verge.net.au>
Date:   Wed May 2 11:58:06 2018 +0200

    Revert "cpufreq: rcar: Add support for R8A7795 SoC"
    
    This reverts commit 034def597bb73cbf29ffade7d8aec8408af8c743.
    
    This is no longer needed since the following commit and to the best
    of my knowledge is not relied on by any upstream DTS:
    
    edeec420de24 (cpufreq: dt-platdev: Automatically create cpufreq
    device with OPP v2)
    
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 206ae7460f4a..c2165edadd41 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -66,7 +66,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "renesas,r8a7792", },
 	{ .compatible = "renesas,r8a7793", },
 	{ .compatible = "renesas,r8a7794", },
-	{ .compatible = "renesas,r8a7795", },
 	{ .compatible = "renesas,sh73a0", },
 
 	{ .compatible = "rockchip,rk2928", },

commit c76ff00baa8dca7cd165dca13fd6aad2a666f88e
Author: Simon Horman <horms+renesas@verge.net.au>
Date:   Wed May 2 11:58:05 2018 +0200

    Revert "cpufreq: dt: Add r8a7796 support to to use generic cpufreq driver"
    
    This reverts commit bea2ebca6b917e46d0c585f416f1326fdf41e69b.
    
    This is no longer needed since the following commit and to the best
    of my knowledge is not relied on by any upstream DTS:
    
    edeec420de24 (cpufreq: dt-platdev: Automatically create cpufreq
    device with OPP v2)
    
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 3b585e4bfac5..206ae7460f4a 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -67,7 +67,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "renesas,r8a7793", },
 	{ .compatible = "renesas,r8a7794", },
 	{ .compatible = "renesas,r8a7795", },
-	{ .compatible = "renesas,r8a7796", },
 	{ .compatible = "renesas,sh73a0", },
 
 	{ .compatible = "rockchip,rk2928", },

commit 6066998cbd2b1012a8d5bc9a2957cfd0ad53150e
Author: Andrew-sh Cheng <andrew-sh.cheng@mediatek.com>
Date:   Fri Dec 8 14:07:56 2017 +0800

    cpufreq: mediatek: add mediatek related projects into blacklist
    
    mediatek projects will use mediate-cpufreq.c as cpufreq driver,
    instead of using cpufreq_dt.c
    Add mediatek related projects into cpufreq-dt blacklist
    
    Signed-off-by: Andrew-sh Cheng <andrew-sh.cheng@mediatek.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index ecc56e26f8f6..3b585e4bfac5 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -108,6 +108,14 @@ static const struct of_device_id blacklist[] __initconst = {
 
 	{ .compatible = "marvell,armadaxp", },
 
+	{ .compatible = "mediatek,mt2701", },
+	{ .compatible = "mediatek,mt2712", },
+	{ .compatible = "mediatek,mt7622", },
+	{ .compatible = "mediatek,mt7623", },
+	{ .compatible = "mediatek,mt817x", },
+	{ .compatible = "mediatek,mt8173", },
+	{ .compatible = "mediatek,mt8176", },
+
 	{ .compatible = "nvidia,tegra124", },
 
 	{ .compatible = "st,stih407", },

commit 11f2c0d77ca856ce146a3e05e7bdfc0c5e6e0f61
Author: Marek Szyprowski <m.szyprowski@samsung.com>
Date:   Wed Oct 4 08:38:28 2017 +0200

    cpufreq: dt: Remove support for Exynos4212 SoCs
    
    Support for Exynos4212 SoCs has been removed by commit bca9085e0ae9
    "ARM: dts: exynos: remove Exynos4212 support (dead code)", so there
    is no need to keep remaining dead code related to this SoC version.
    
    Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Krzysztof Kozlowski <krzk@kernel.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index de659fc564f4..ecc56e26f8f6 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -48,7 +48,6 @@ static const struct of_device_id whitelist[] __initconst = {
 
 	{ .compatible = "samsung,exynos3250", },
 	{ .compatible = "samsung,exynos4210", },
-	{ .compatible = "samsung,exynos4212", },
 	{ .compatible = "samsung,exynos5250", },
 #ifndef CONFIG_BL_SWITCHER
 	{ .compatible = "samsung,exynos5800", },

commit 3eba6e121155d56e2b50305a48fa11749c503a2e
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Wed Aug 30 00:37:03 2017 +0900

    cpufreq: dt-platdev: drop socionext,uniphier-ld6b from whitelist
    
    As you see arch/arm/boot/dts/uniphier-ld6b.dtsi, it includes
    uniphier-pxs2.dtsi, which uses "operating-points-v2" property
    and whose cpufreq device is automatically created.
    
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index a753c50e9e41..de659fc564f4 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -83,8 +83,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "rockchip,rk3368", },
 	{ .compatible = "rockchip,rk3399", },
 
-	{ .compatible = "socionext,uniphier-ld6b", },
-
 	{ .compatible = "st-ericsson,u8500", },
 	{ .compatible = "st-ericsson,u8540", },
 	{ .compatible = "st-ericsson,u9500", },

commit d477bf3af1e88fe27c893f84136647fe11963198
Author: Suniel Mahesh <sunil.m@techveda.org>
Date:   Thu Sep 21 19:09:03 2017 +0530

    cpufreq: dt: Fix sysfs duplicate filename creation for platform-device
    
    ti-cpufreq and cpufreq-dt-platdev drivers are registering platform-device
    with same name "cpufreq-dt" using platform_device_register_*() routines.
    This is leading to build warnings appended below.
    
    Providing hardware information to OPP framework along with the platform-
    device creation should be done by ti-cpufreq driver before cpufreq-dt
    driver comes into place.
    
    This patch add's TI am33xx, am43 and dra7 platforms (which use opp-v2
    property) to the blacklist of devices in cpufreq-dt-platform driver to
    avoid creating platform-device twice and remove build warnings.
    
    [    2.370167] ------------[ cut here ]------------
    [    2.375087] WARNING: CPU: 0 PID: 1 at fs/sysfs/dir.c:31 sysfs_warn_dup+0x58/0x78
    [    2.383112] sysfs: cannot create duplicate filename '/devices/platform/cpufreq-dt'
    [    2.391219] Modules linked in:
    [    2.394506] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.13.0-next-20170912 #1
    [    2.402006] Hardware name: Generic AM33XX (Flattened Device Tree)
    [    2.408437] [<c0110a28>] (unwind_backtrace) from [<c010ca84>] (show_stack+0x10/0x14)
    [    2.416568] [<c010ca84>] (show_stack) from [<c0827d64>] (dump_stack+0xac/0xe0)
    [    2.424165] [<c0827d64>] (dump_stack) from [<c0137470>] (__warn+0xd8/0x104)
    [    2.431488] [<c0137470>] (__warn) from [<c01374d0>] (warn_slowpath_fmt+0x34/0x44)
    [    2.439351] [<c01374d0>] (warn_slowpath_fmt) from [<c03459d0>] (sysfs_warn_dup+0x58/0x78)
    [    2.447938] [<c03459d0>] (sysfs_warn_dup) from [<c0345ab8>] (sysfs_create_dir_ns+0x80/0x98)
    [    2.456719] [<c0345ab8>] (sysfs_create_dir_ns) from [<c082c554>] (kobject_add_internal+0x9c/0x2d4)
    [    2.466124] [<c082c554>] (kobject_add_internal) from [<c082c7d8>] (kobject_add+0x4c/0x9c)
    [    2.474712] [<c082c7d8>] (kobject_add) from [<c05803e4>] (device_add+0xcc/0x57c)
    [    2.482489] [<c05803e4>] (device_add) from [<c0584b74>] (platform_device_add+0x100/0x220)
    [    2.491085] [<c0584b74>] (platform_device_add) from [<c05855a8>] (platform_device_register_full+0xf4/0x118)
    [    2.501305] [<c05855a8>] (platform_device_register_full) from [<c067023c>] (ti_cpufreq_init+0x150/0x22c)
    [    2.511253] [<c067023c>] (ti_cpufreq_init) from [<c0101df4>] (do_one_initcall+0x3c/0x170)
    [    2.519838] [<c0101df4>] (do_one_initcall) from [<c0c00eb4>] (kernel_init_freeable+0x1fc/0x2c4)
    [    2.528974] [<c0c00eb4>] (kernel_init_freeable) from [<c083bcac>] (kernel_init+0x8/0x110)
    [    2.537565] [<c083bcac>] (kernel_init) from [<c0107d18>] (ret_from_fork+0x14/0x3c)
    [    2.545981] ---[ end trace 2fc00e213c13ab20 ]---
    [    2.551051] ------------[ cut here ]------------
    [    2.555931] WARNING: CPU: 0 PID: 1 at lib/kobject.c:240 kobject_add_internal+0x254/0x2d4
    [    2.564578] kobject_add_internal failed for cpufreq-dt with -EEXIST, don't try to register
    things with the same name in the same directory.
    [    2.577977] Modules linked in:
    [    2.581261] CPU: 0 PID: 1 Comm: swapper/0 Tainted: G        W       4.13.0-next-20170912 #1
    [    2.590013] Hardware name: Generic AM33XX (Flattened Device Tree)
    [    2.596437] [<c0110a28>] (unwind_backtrace) from [<c010ca84>] (show_stack+0x10/0x14)
    [    2.604573] [<c010ca84>] (show_stack) from [<c0827d64>] (dump_stack+0xac/0xe0)
    [    2.612172] [<c0827d64>] (dump_stack) from [<c0137470>] (__warn+0xd8/0x104)
    [    2.619494] [<c0137470>] (__warn) from [<c01374d0>] (warn_slowpath_fmt+0x34/0x44)
    [    2.627362] [<c01374d0>] (warn_slowpath_fmt) from [<c082c70c>] (kobject_add_internal+0x254/0x2d4)
    [    2.636666] [<c082c70c>] (kobject_add_internal) from [<c082c7d8>] (kobject_add+0x4c/0x9c)
    [    2.645255] [<c082c7d8>] (kobject_add) from [<c05803e4>] (device_add+0xcc/0x57c)
    [    2.653027] [<c05803e4>] (device_add) from [<c0584b74>] (platform_device_add+0x100/0x220)
    [    2.661615] [<c0584b74>] (platform_device_add) from [<c05855a8>] (platform_device_register_full+0xf4/0x118)
    [    2.671833] [<c05855a8>] (platform_device_register_full) from [<c067023c>] (ti_cpufreq_init+0x150/0x22c)
    [    2.681779] [<c067023c>] (ti_cpufreq_init) from [<c0101df4>] (do_one_initcall+0x3c/0x170)
    [    2.690377] [<c0101df4>] (do_one_initcall) from [<c0c00eb4>] (kernel_init_freeable+0x1fc/0x2c4)
    [    2.699510] [<c0c00eb4>] (kernel_init_freeable) from [<c083bcac>] (kernel_init+0x8/0x110)
    [    2.708106] [<c083bcac>] (kernel_init) from [<c0107d18>] (ret_from_fork+0x14/0x3c)
    [    2.716217] ---[ end trace 2fc00e213c13ab21 ]---
    
    Fixes: edeec420de24 (cpufreq: dt-cpufreq: platdev Automatically create device with OPP v2)
    Signed-off-by: Suniel Mahesh <sunil.m@techveda.org>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 430edadca527..a753c50e9e41 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -118,6 +118,10 @@ static const struct of_device_id blacklist[] __initconst = {
 
 	{ .compatible = "sigma,tango4", },
 
+	{ .compatible = "ti,am33xx", },
+	{ .compatible = "ti,am43", },
+	{ .compatible = "ti,dra7", },
+
 	{ }
 };
 

commit ff76898c0a14a43f71bfe63dd1903087e96ce238
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Tue Sep 19 08:23:22 2017 -0700

    cpufreq: dt-platdev: Add some missing platforms to the blacklist
    
    Commit edeec420de24 (cpufreq: dt-platdev: Automatically create cpufreq
    device with OPP v2) missed adding few platforms to the blacklist which
    create the cpufreq-dt device from their own drivers, after some
    dependencies are sorted out.
    
    And for those platforms, both the platform specific driver and the
    cpufreq-dt-platdev driver try to create the cpufreq-dt device now.
    
    Fix that by including those platforms in the blacklist. This doesn't include
    the TI platforms, for which there is a separate patch.
    
    Fixes: edeec420de24 (cpufreq: dt-cpufreq: platdev Automatically create device with OPP v2)
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index a020da7940d6..430edadca527 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -106,6 +106,18 @@ static const struct of_device_id whitelist[] __initconst = {
  * platforms using "operating-points-v2" property.
  */
 static const struct of_device_id blacklist[] __initconst = {
+	{ .compatible = "calxeda,highbank", },
+	{ .compatible = "calxeda,ecx-2000", },
+
+	{ .compatible = "marvell,armadaxp", },
+
+	{ .compatible = "nvidia,tegra124", },
+
+	{ .compatible = "st,stih407", },
+	{ .compatible = "st,stih410", },
+
+	{ .compatible = "sigma,tango4", },
+
 	{ }
 };
 

commit d79d148b6451307fd46e30673ce9de28690c8ced
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Wed Aug 16 11:07:28 2017 +0530

    cpufreq: dt-platdev: Drop few entries from whitelist
    
    Drop few ARM (32 and 64 bit) platforms from the whitelist which always
    use "operating-points-v2" property from their DT. They should continue
    to work after this patch.
    
    Tested on Hikey platform (only the "hisilicon,hi6220" entry).
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Chen-Yu Tsai <wens@csie.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 7c67a6c74fdc..a020da7940d6 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -27,7 +27,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "allwinner,sun6i-a31s", },
 	{ .compatible = "allwinner,sun7i-a20", },
 	{ .compatible = "allwinner,sun8i-a23", },
-	{ .compatible = "allwinner,sun8i-a33", },
 	{ .compatible = "allwinner,sun8i-a83t", },
 	{ .compatible = "allwinner,sun8i-h3", },
 
@@ -37,7 +36,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "arm,integrator-cp", },
 
 	{ .compatible = "hisilicon,hi3660", },
-	{ .compatible = "hisilicon,hi6220", },
 
 	{ .compatible = "fsl,imx27", },
 	{ .compatible = "fsl,imx51", },
@@ -51,11 +49,8 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "samsung,exynos3250", },
 	{ .compatible = "samsung,exynos4210", },
 	{ .compatible = "samsung,exynos4212", },
-	{ .compatible = "samsung,exynos4412", },
 	{ .compatible = "samsung,exynos5250", },
 #ifndef CONFIG_BL_SWITCHER
-	{ .compatible = "samsung,exynos5420", },
-	{ .compatible = "samsung,exynos5433", },
 	{ .compatible = "samsung,exynos5800", },
 #endif
 
@@ -88,11 +83,7 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "rockchip,rk3368", },
 	{ .compatible = "rockchip,rk3399", },
 
-	{ .compatible = "socionext,uniphier-pro5", },
-	{ .compatible = "socionext,uniphier-pxs2", },
 	{ .compatible = "socionext,uniphier-ld6b", },
-	{ .compatible = "socionext,uniphier-ld11", },
-	{ .compatible = "socionext,uniphier-ld20", },
 
 	{ .compatible = "st-ericsson,u8500", },
 	{ .compatible = "st-ericsson,u8540", },
@@ -107,8 +98,6 @@ static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "xlnx,zynq-7000", },
 	{ .compatible = "xlnx,zynqmp", },
 
-	{ .compatible = "zte,zx296718", },
-
 	{ }
 };
 

commit edeec420de2407618de097977e76b572d9de1bcf
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Wed Aug 16 11:07:27 2017 +0530

    cpufreq: dt-platdev: Automatically create cpufreq device with OPP v2
    
    The initial idea of creating the cpufreq-dt-platdev.c file was to keep a
    list of platforms that use the "operating-points" (V1) bindings and
    create cpufreq device for them only, as we weren't sure which platforms
    would want the device to get created automatically as some had their own
    cpufreq drivers as well, or wanted to initialize cpufreq after doing
    some stuff from platform code.
    
    But that wasn't the case with platforms using "operating-points-v2"
    property. We wanted the device to get created automatically without the
    need of adding them to the whitelist. Though, we will still have some
    exceptions where we don't want to create the device automatically.
    
    Rename the earlier platform list as *whitelist* and create a new
    *blacklist* as well.
    
    The cpufreq-dt device will get created if:
    - The platform is there in the whitelist OR
    - The platform has "operating-points-v2" property in CPU0's DT node and
      isn't part of the blacklist .
    
    Reported-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Tested-by: Simon Horman <horms+renesas@verge.net.au>
    Reviewed-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 8b88768b565d..7c67a6c74fdc 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -9,11 +9,16 @@
 
 #include <linux/err.h>
 #include <linux/of.h>
+#include <linux/of_device.h>
 #include <linux/platform_device.h>
 
 #include "cpufreq-dt.h"
 
-static const struct of_device_id machines[] __initconst = {
+/*
+ * Machines for which the cpufreq device is *always* created, mostly used for
+ * platforms using "operating-points" (V1) property.
+ */
+static const struct of_device_id whitelist[] __initconst = {
 	{ .compatible = "allwinner,sun4i-a10", },
 	{ .compatible = "allwinner,sun5i-a10s", },
 	{ .compatible = "allwinner,sun5i-a13", },
@@ -107,21 +112,51 @@ static const struct of_device_id machines[] __initconst = {
 	{ }
 };
 
+/*
+ * Machines for which the cpufreq device is *not* created, mostly used for
+ * platforms using "operating-points-v2" property.
+ */
+static const struct of_device_id blacklist[] __initconst = {
+	{ }
+};
+
+static bool __init cpu0_node_has_opp_v2_prop(void)
+{
+	struct device_node *np = of_cpu_device_node_get(0);
+	bool ret = false;
+
+	if (of_get_property(np, "operating-points-v2", NULL))
+		ret = true;
+
+	of_node_put(np);
+	return ret;
+}
+
 static int __init cpufreq_dt_platdev_init(void)
 {
 	struct device_node *np = of_find_node_by_path("/");
 	const struct of_device_id *match;
+	const void *data = NULL;
 
 	if (!np)
 		return -ENODEV;
 
-	match = of_match_node(machines, np);
+	match = of_match_node(whitelist, np);
+	if (match) {
+		data = match->data;
+		goto create_pdev;
+	}
+
+	if (cpu0_node_has_opp_v2_prop() && !of_match_node(blacklist, np))
+		goto create_pdev;
+
 	of_node_put(np);
-	if (!match)
-		return -ENODEV;
+	return -ENODEV;
 
+create_pdev:
+	of_node_put(np);
 	return PTR_ERR_OR_ZERO(platform_device_register_data(NULL, "cpufreq-dt",
-			       -1, match->data,
+			       -1, data,
 			       sizeof(struct cpufreq_dt_platform_data)));
 }
 device_initcall(cpufreq_dt_platdev_init);

commit ff6c349f74218eb03a676f46a2cffe69fc5b3d4d
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Wed Aug 16 10:19:12 2017 +0200

    cpufreq: enable the DT cpufreq driver on the Ux500
    
    This enables the generic DT and OPP-based cpufreq driver on the
    ST-Ericsson Ux500 series.
    
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 233e18ad3948..8b88768b565d 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -89,6 +89,11 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "socionext,uniphier-ld11", },
 	{ .compatible = "socionext,uniphier-ld20", },
 
+	{ .compatible = "st-ericsson,u8500", },
+	{ .compatible = "st-ericsson,u8540", },
+	{ .compatible = "st-ericsson,u9500", },
+	{ .compatible = "st-ericsson,u9540", },
+
 	{ .compatible = "ti,omap2", },
 	{ .compatible = "ti,omap3", },
 	{ .compatible = "ti,omap4", },

commit bea2ebca6b917e46d0c585f416f1326fdf41e69b
Author: Khiem Nguyen <khiem.nguyen.xt@rvc.renesas.com>
Date:   Fri Aug 11 17:36:57 2017 +0200

    cpufreq: dt: Add r8a7796 support to to use generic cpufreq driver
    
    This patch adds the r8a7796 support the generic cpufreq driver
    by adding an appropriate compat string. This is in keeping
    with support for other Renesas ARM and arm64 based SoCs.
    
    Signed-off-by: Khiem Nguyen <khiem.nguyen.xt@rvc.renesas.com>
    [simon: new changelog]
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index bcee384b3251..233e18ad3948 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -68,6 +68,7 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "renesas,r8a7793", },
 	{ .compatible = "renesas,r8a7794", },
 	{ .compatible = "renesas,r8a7795", },
+	{ .compatible = "renesas,r8a7796", },
 	{ .compatible = "renesas,sh73a0", },
 
 	{ .compatible = "rockchip,rk2928", },

commit 034def597bb73cbf29ffade7d8aec8408af8c743
Author: Khiem Nguyen <khiem.nguyen.xt@rvc.renesas.com>
Date:   Fri Aug 4 15:18:00 2017 +0200

    cpufreq: rcar: Add support for R8A7795 SoC
    
    After the commit "a399dc9fc50 cpufreq: shmobile: Use generic platdev
    driver", will use cpufreq-dt-platdev driver to enable cpufreq-dt support.
    Hence, follow the implementation to support new R8A7795 SoC.
    
    Signed-off-by: Khiem Nguyen <khiem.nguyen.xt@rvc.renesas.com>
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 13c0c47b607e..bcee384b3251 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -67,6 +67,7 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "renesas,r8a7792", },
 	{ .compatible = "renesas,r8a7793", },
 	{ .compatible = "renesas,r8a7794", },
+	{ .compatible = "renesas,r8a7795", },
 	{ .compatible = "renesas,sh73a0", },
 
 	{ .compatible = "rockchip,rk2928", },

commit 319af40a0053fea2ecadcf10bef7e796c91ea8c0
Author: Finley Xiao <finley.xiao@rock-chips.com>
Date:   Fri Aug 4 09:52:31 2017 +0800

    cpufreq: dt: Add rk3328 compatible to use generic cpufreq driver
    
    This patch adds the rk3328 compatible string for supporting
    the generic cpufreq driver on RK3328.
    
    Signed-off-by: Finley Xiao <finley.xiao@rock-chips.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 096aea7fcb67..13c0c47b607e 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -76,6 +76,7 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "rockchip,rk3188", },
 	{ .compatible = "rockchip,rk3228", },
 	{ .compatible = "rockchip,rk3288", },
+	{ .compatible = "rockchip,rk3328", },
 	{ .compatible = "rockchip,rk3366", },
 	{ .compatible = "rockchip,rk3368", },
 	{ .compatible = "rockchip,rk3399", },

commit 9dbd224f9e4e3285a1aba4c3c5683cee20e3c30c
Author: Marc Gonzalez <marc_gonzalez@sigmadesigns.com>
Date:   Tue Jul 18 18:48:39 2017 +0200

    cpufreq: dt: Don't use generic platdev driver for tango
    
    On tango platforms, firmware configures the CPU clock, and Linux is
    then only allowed to use the cpu_clk_divider to change the frequency.
    Build the OPP table dynamically at init, in order to support whatever
    firmware throws at us.
    
    Signed-off-by: Marc Gonzalez <marc_gonzalez@sigmadesigns.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 2eb40d46d357..096aea7fcb67 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -80,8 +80,6 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "rockchip,rk3368", },
 	{ .compatible = "rockchip,rk3399", },
 
-	{ .compatible = "sigma,tango4" },
-
 	{ .compatible = "socionext,uniphier-pro5", },
 	{ .compatible = "socionext,uniphier-pxs2", },
 	{ .compatible = "socionext,uniphier-ld6b", },

commit a5685781dfe9e7c2391d004f6a725042e7121c3e
Author: Shubhrajyoti Datta <shubhrajyoti.datta@xilinx.com>
Date:   Thu Jul 13 11:19:10 2017 +0200

    cpufreq: dt: Add zynqmp to the cpufreq dt platdev
    
    Add zynqmp to the cpufreq dt platform device.
    
    Signed-off-by: Shubhrajyoti Datta <shubhrajyoti.datta@xilinx.com>
    Signed-off-by: Michal Simek <michal.simek@xilinx.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 1c262923fe58..2eb40d46d357 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -94,6 +94,7 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "ti,omap5", },
 
 	{ .compatible = "xlnx,zynq-7000", },
+	{ .compatible = "xlnx,zynqmp", },
 
 	{ .compatible = "zte,zx296718", },
 

commit a0df77348ab37687c9513bc2dd772cbc6eadbe63
Author: Tao Wang <kevin.wangtao@hisilicon.com>
Date:   Tue May 23 16:13:18 2017 +0800

    cpufreq: dt: Add support for hi3660
    
    Add the compatible string for supporting the generic device tree cpufreq-dt
    driver on Hisilicon's 3660 SoC.
    
    Signed-off-by: Tao Wang <kevin.wangtao@hisilicon.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 921b4a6c3d16..1c262923fe58 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -31,6 +31,7 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "arm,integrator-ap", },
 	{ .compatible = "arm,integrator-cp", },
 
+	{ .compatible = "hisilicon,hi3660", },
 	{ .compatible = "hisilicon,hi6220", },
 
 	{ .compatible = "fsl,imx27", },

commit 051bd84bb45bc994b7d762467f60b3bd0c7aa6bc
Author: Dave Gerlach <d-gerlach@ti.com>
Date:   Fri Feb 3 11:29:29 2017 -0600

    cpufreq: dt: Don't use generic platdev driver for ti-cpufreq platforms
    
    Some TI platforms, specifically those in the am33xx, am43xx, dra7xx, and
    am57xx families of SoCs can make use of the ti-cpufreq driver to
    selectively enable OPPs based on the exact configuration in use. The
    ti-cpufreq is given the responsibility of creating the cpufreq-dt
    platform device when the driver is in use so drop am33xx and dra7xx
    from the cpufreq-dt-platdev driver so it is not created twice.
    
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 7fcaf26e8f81..921b4a6c3d16 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -87,8 +87,6 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "socionext,uniphier-ld11", },
 	{ .compatible = "socionext,uniphier-ld20", },
 
-	{ .compatible = "ti,am33xx", },
-	{ .compatible = "ti,dra7", },
 	{ .compatible = "ti,omap2", },
 	{ .compatible = "ti,omap3", },
 	{ .compatible = "ti,omap4", },

commit e11b6293a8fcd3f29376808910f49bd82f72b69a
Author: Hoan Tran <hotran@apm.com>
Date:   Thu Dec 15 14:55:00 2016 -0800

    cpufreq: dt: Add support for APM X-Gene 2
    
    Add the compatible string for supporting the generic device tree cpufreq-dt
    driver on APM's X-Gene 2 SoC.
    
    Signed-off-by: Hoan Tran <hotran@apm.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index bc97b6a4b1cf..7fcaf26e8f81 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -26,6 +26,8 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "allwinner,sun8i-a83t", },
 	{ .compatible = "allwinner,sun8i-h3", },
 
+	{ .compatible = "apm,xgene-shadowcat", },
+
 	{ .compatible = "arm,integrator-ap", },
 	{ .compatible = "arm,integrator-cp", },
 

commit ab83805667603e60177afec241a63139602bbd47
Author: Baoyou Xie <baoyou.xie@linaro.org>
Date:   Wed Nov 30 15:35:29 2016 +0800

    cpufreq: dt: Add support for zx296718
    
    Add the compatible string for supporting the generic cpufreq driver on
    the ZTE's zx296718 SoC.
    
    Signed-off-by: Baoyou Xie <baoyou.xie@linaro.org>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 0c73c7dbd587..bc97b6a4b1cf 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -94,6 +94,8 @@ static const struct of_device_id machines[] __initconst = {
 
 	{ .compatible = "xlnx,zynq-7000", },
 
+	{ .compatible = "zte,zx296718", },
+
 	{ }
 };
 

commit f0da898b464953157911913cd93eaedcb2c92407
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Nov 16 11:05:51 2016 +0100

    cpufreq: dt: Add support for r8a7743 and r8a7745
    
    Add the compatible strings for supporting the generic cpufreq driver on
    the Renesas RZ/G1M (r8a7743) and RZ/G1E (r8a7745) SoCs.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index fcc5bcfe57ef..0c73c7dbd587 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -55,6 +55,8 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "renesas,r7s72100", },
 	{ .compatible = "renesas,r8a73a4", },
 	{ .compatible = "renesas,r8a7740", },
+	{ .compatible = "renesas,r8a7743", },
+	{ .compatible = "renesas,r8a7745", },
 	{ .compatible = "renesas,r8a7778", },
 	{ .compatible = "renesas,r8a7779", },
 	{ .compatible = "renesas,r8a7790", },

commit dcd2ea410d8780951420f32d0d49782cc324e1e9
Author: Robert Jarzmik <robert.jarzmik@free.fr>
Date:   Mon Oct 31 20:54:53 2016 +0100

    cpufreq: pxa: use generic platdev driver for device-tree
    
    For device-tree based pxa25x and pxa27x platforms, cpufreq-dt driver is
    doing the job as well as pxa2xx-cpufreq, so add these platforms to the
    compatibility list.
    
    This won't work for legacy non device-tree platforms where
    pxa2xx-cpufreq is still required.
    
    Signed-off-by: Robert Jarzmik <robert.jarzmik@free.fr>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index fba3f61f320c..fcc5bcfe57ef 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -37,6 +37,8 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "fsl,imx7d", },
 
 	{ .compatible = "marvell,berlin", },
+	{ .compatible = "marvell,pxa250", },
+	{ .compatible = "marvell,pxa270", },
 
 	{ .compatible = "samsung,exynos3250", },
 	{ .compatible = "samsung,exynos4210", },

commit 1758b3374bc5b56f60fc07ccc37863a64fc67ecc
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Thu Oct 27 01:41:33 2016 +0900

    cpufreq: dt: add Socionext UniPhier SoCs support
    
    Add compatible strings for Pro5, PXs2, LD6b, LD11, LD20 SoCs to use
    the generic cpufreq driver.
    
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 142a6f615e52..fba3f61f320c 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -75,6 +75,12 @@ static const struct of_device_id machines[] __initconst = {
 
 	{ .compatible = "sigma,tango4" },
 
+	{ .compatible = "socionext,uniphier-pro5", },
+	{ .compatible = "socionext,uniphier-pxs2", },
+	{ .compatible = "socionext,uniphier-ld6b", },
+	{ .compatible = "socionext,uniphier-ld11", },
+	{ .compatible = "socionext,uniphier-ld20", },
+
 	{ .compatible = "ti,am33xx", },
 	{ .compatible = "ti,dra7", },
 	{ .compatible = "ti,omap2", },

commit 650ec6cfe323311165f0c7b6882a63dfd7ae8b63
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Tue Oct 25 09:21:24 2016 +0200

    cpufreq: enable the DT cpufreq driver on the Integrators
    
    This enables the generic DT and OPP-based cpufreq driver on the
    ARM Integrator/AP and Integrator/CP.
    
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 71267626456b..142a6f615e52 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -26,6 +26,9 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "allwinner,sun8i-a83t", },
 	{ .compatible = "allwinner,sun8i-h3", },
 
+	{ .compatible = "arm,integrator-ap", },
+	{ .compatible = "arm,integrator-cp", },
+
 	{ .compatible = "hisilicon,hi6220", },
 
 	{ .compatible = "fsl,imx27", },

commit e01072d22d4e7f9ca966f848def22fe41eaef4de
Author: Dave Gerlach <d-gerlach@ti.com>
Date:   Wed Sep 14 15:41:37 2016 -0500

    cpufreq: ti: Use generic platdev driver
    
    Now that the cpufreq-dt-platdev is used to create the cpufreq-dt platform
    device for all OMAP platforms and the platform code that did it
    before has been removed, add ti,am33xx and ti,dra7xx to the machine list
    in cpufreq-dt-platdev which had relied on the removed platform code to do
    this previously.
    
    Fixes: 7694ca6e1d6f (cpufreq: omap: Use generic platdev driver)
    Signed-off-by: Dave Gerlach <d-gerlach@ti.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Cc: 4.7+ <stable@vger.kernel.org> # 4.7+
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index d2637e1a5710..71267626456b 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -72,6 +72,8 @@ static const struct of_device_id machines[] __initconst = {
 
 	{ .compatible = "sigma,tango4" },
 
+	{ .compatible = "ti,am33xx", },
+	{ .compatible = "ti,dra7", },
 	{ .compatible = "ti,omap2", },
 	{ .compatible = "ti,omap3", },
 	{ .compatible = "ti,omap4", },

commit 297a66221d2bed61e7d74d11bf071c7b489fc33d
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Sep 9 16:48:08 2016 +0530

    cpufreq: dt: Support governor tunables per policy
    
    The cpufreq-dt driver is also used for systems with multiple
    clock/voltage domains for CPUs, i.e. multiple cpufreq policies in a
    system.
    
    And in such cases the platform users may want to enable "governor
    tunables per policy". Support that via platform data, as not all users
    of the driver would want that behavior.
    
    Reported-by: Juri Lelli <Juri.Lelli@arm.com>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 276378a43321..d2637e1a5710 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -11,6 +11,8 @@
 #include <linux/of.h>
 #include <linux/platform_device.h>
 
+#include "cpufreq-dt.h"
+
 static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "allwinner,sun4i-a10", },
 	{ .compatible = "allwinner,sun5i-a10s", },
@@ -93,7 +95,8 @@ static int __init cpufreq_dt_platdev_init(void)
 	if (!match)
 		return -ENODEV;
 
-	return PTR_ERR_OR_ZERO(platform_device_register_simple("cpufreq-dt", -1,
-							       NULL, 0));
+	return PTR_ERR_OR_ZERO(platform_device_register_data(NULL, "cpufreq-dt",
+			       -1, match->data,
+			       sizeof(struct cpufreq_dt_platform_data)));
 }
 device_initcall(cpufreq_dt_platdev_init);

commit ffdf8b867b922d2d3150ccfa330d1c6d22716562
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Tue Sep 6 14:18:20 2016 +0200

    cpufreq: dt: Add support for r8a7792
    
    Add the compatible string for supporting the generic cpufreq driver on
    the Renesas R-Car V2H (r8a7792) SoC.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 285ed3e6494e..276378a43321 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -52,6 +52,7 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "renesas,r8a7779", },
 	{ .compatible = "renesas,r8a7790", },
 	{ .compatible = "renesas,r8a7791", },
+	{ .compatible = "renesas,r8a7792", },
 	{ .compatible = "renesas,r8a7793", },
 	{ .compatible = "renesas,r8a7794", },
 	{ .compatible = "renesas,sh73a0", },

commit d0fbf1d3280c2192fc1588af96cbad5297792371
Merge: 3732b30a7d88 3689ad7ed6a8
Author: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Date:   Mon Sep 12 14:49:29 2016 +0200

    Merge back earlier cpufreq material for v4.9.

commit bd37e022e334757a5dc1dae41baa29e16befe4ec
Author: Wei Yongjun <weiyongjun1@huawei.com>
Date:   Sun Aug 21 15:41:44 2016 +0000

    cpufreq: dt: Add terminate entry for of_device_id tables
    
    Make sure of_device_id tables are NULL terminated.
    
    Signed-off-by: Wei Yongjun <weiyongjun1@huawei.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Fixes: f56aad1d98f1 (cpufreq: dt: Add generic platform-device creation support)
    CC: 4.7+ <stable@vger.kernel.org> # 4.7+
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 0bb44d5b5df4..2ee40fd360ca 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -74,6 +74,8 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "ti,omap5", },
 
 	{ .compatible = "xlnx,zynq-7000", },
+
+	{ }
 };
 
 static int __init cpufreq_dt_platdev_init(void)

commit c4b4057267f258e6d823080205f47227fb2abfd7
Author: Chanwoo Choi <cw00.choi@samsung.com>
Date:   Tue Aug 16 15:27:19 2016 +0900

    cpufreq: dt: Add exynos5433 compatible to use generic cpufreq driver
    
    This patch adds the exynos5433 compatible string for supporting
    the generic cpufreq driver on Exynos5433.
    
    Signed-off-by: Chanwoo Choi <cw00.choi@samsung.com>
    Reviewed-by: Krzysztof Kozlowski <k.kozlowski@samsung.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 0bb44d5b5df4..470db30f745f 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -40,6 +40,7 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "samsung,exynos5250", },
 #ifndef CONFIG_BL_SWITCHER
 	{ .compatible = "samsung,exynos5420", },
+	{ .compatible = "samsung,exynos5433", },
 	{ .compatible = "samsung,exynos5800", },
 #endif
 

commit ca5eda5d3db6026080cff267459625c87c43e9ab
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Date:   Mon Jun 27 14:50:13 2016 +0900

    cpufreq: dt: call of_node_put() before error out
    
    If of_match_node() fails, this init function bails out without
    calling of_node_put().
    
    Also change of_node_put(of_root) to of_node_put(np); both of them
    hold the same pointer, but it seems better to call of_node_put()
    against the node returned by of_find_node_by_path().
    
    Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 3646b143bbf5..0bb44d5b5df4 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -79,15 +79,16 @@ static const struct of_device_id machines[] __initconst = {
 static int __init cpufreq_dt_platdev_init(void)
 {
 	struct device_node *np = of_find_node_by_path("/");
+	const struct of_device_id *match;
 
 	if (!np)
 		return -ENODEV;
 
-	if (!of_match_node(machines, np))
+	match = of_match_node(machines, np);
+	of_node_put(np);
+	if (!match)
 		return -ENODEV;
 
-	of_node_put(of_root);
-
 	return PTR_ERR_OR_ZERO(platform_device_register_simple("cpufreq-dt", -1,
 							       NULL, 0));
 }

commit d9c99acb630de767a295c37cd704d08f8237e3f8
Author: Marc Gonzalez <marc_gonzalez@sigmadesigns.com>
Date:   Mon May 2 15:39:25 2016 +0200

    cpufreq: tango: Use generic platdev driver
    
    Add tango4 compatible string to the list.
    
    Signed-off-by: Marc Gonzalez <marc_gonzalez@sigmadesigns.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index ac4a0ba87c12..3646b143bbf5 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -66,6 +66,8 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "rockchip,rk3368", },
 	{ .compatible = "rockchip,rk3399", },
 
+	{ .compatible = "sigma,tango4" },
+
 	{ .compatible = "ti,omap2", },
 	{ .compatible = "ti,omap3", },
 	{ .compatible = "ti,omap4", },

commit 3920be471ce7f66c05e6e0cd251a332b84520ef8
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:47 2016 +0530

    cpufreq: hisilicon: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 5ad29383e862..ac4a0ba87c12 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -24,6 +24,8 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "allwinner,sun8i-a83t", },
 	{ .compatible = "allwinner,sun8i-h3", },
 
+	{ .compatible = "hisilicon,hi6220", },
+
 	{ .compatible = "fsl,imx27", },
 	{ .compatible = "fsl,imx51", },
 	{ .compatible = "fsl,imx53", },

commit 5e4249c6d9e596fdb26357997236a01b96c8902d
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:46 2016 +0530

    cpufreq: zynq: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 24dde5e256d4..5ad29383e862 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -68,6 +68,8 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "ti,omap3", },
 	{ .compatible = "ti,omap4", },
 	{ .compatible = "ti,omap5", },
+
+	{ .compatible = "xlnx,zynq-7000", },
 };
 
 static int __init cpufreq_dt_platdev_init(void)

commit 117d4f59affa869f819ec53ed0cd54aedfdeffa0
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:45 2016 +0530

    cpufreq: sunxi: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 4b94fe3427f9..24dde5e256d4 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -12,6 +12,18 @@
 #include <linux/platform_device.h>
 
 static const struct of_device_id machines[] __initconst = {
+	{ .compatible = "allwinner,sun4i-a10", },
+	{ .compatible = "allwinner,sun5i-a10s", },
+	{ .compatible = "allwinner,sun5i-a13", },
+	{ .compatible = "allwinner,sun5i-r8", },
+	{ .compatible = "allwinner,sun6i-a31", },
+	{ .compatible = "allwinner,sun6i-a31s", },
+	{ .compatible = "allwinner,sun7i-a20", },
+	{ .compatible = "allwinner,sun8i-a23", },
+	{ .compatible = "allwinner,sun8i-a33", },
+	{ .compatible = "allwinner,sun8i-a83t", },
+	{ .compatible = "allwinner,sun8i-h3", },
+
 	{ .compatible = "fsl,imx27", },
 	{ .compatible = "fsl,imx51", },
 	{ .compatible = "fsl,imx53", },

commit a399dc9fc5005321cebee6589d6bca780ed99c18
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:44 2016 +0530

    cpufreq: shmobile: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 75fa921d8540..4b94fe3427f9 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -29,6 +29,18 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "samsung,exynos5800", },
 #endif
 
+	{ .compatible = "renesas,emev2", },
+	{ .compatible = "renesas,r7s72100", },
+	{ .compatible = "renesas,r8a73a4", },
+	{ .compatible = "renesas,r8a7740", },
+	{ .compatible = "renesas,r8a7778", },
+	{ .compatible = "renesas,r8a7779", },
+	{ .compatible = "renesas,r8a7790", },
+	{ .compatible = "renesas,r8a7791", },
+	{ .compatible = "renesas,r8a7793", },
+	{ .compatible = "renesas,r8a7794", },
+	{ .compatible = "renesas,sh73a0", },
+
 	{ .compatible = "rockchip,rk2928", },
 	{ .compatible = "rockchip,rk3036", },
 	{ .compatible = "rockchip,rk3066a", },

commit 014400c127be352a0a129aaa8a9ac870a310c76c
Author: Finley Xiao <finley.xiao@rock-chips.com>
Date:   Fri Apr 22 16:58:43 2016 +0530

    cpufreq: rockchip: Use generic platdev driver
    
    This patch add rockchip's compatible string to the compat list and
    remove similar code from platform code for supporting generic platdev
    driver.
    
    Signed-off-by: Finley Xiao <finley.xiao@rock-chips.com>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Reviewed-by: Heiko Stuebner <heiko@sntech.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 4e525f6ec59f..75fa921d8540 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -29,6 +29,17 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "samsung,exynos5800", },
 #endif
 
+	{ .compatible = "rockchip,rk2928", },
+	{ .compatible = "rockchip,rk3036", },
+	{ .compatible = "rockchip,rk3066a", },
+	{ .compatible = "rockchip,rk3066b", },
+	{ .compatible = "rockchip,rk3188", },
+	{ .compatible = "rockchip,rk3228", },
+	{ .compatible = "rockchip,rk3288", },
+	{ .compatible = "rockchip,rk3366", },
+	{ .compatible = "rockchip,rk3368", },
+	{ .compatible = "rockchip,rk3399", },
+
 	{ .compatible = "ti,omap2", },
 	{ .compatible = "ti,omap3", },
 	{ .compatible = "ti,omap4", },

commit 7694ca6e1d6f01122f05039b81f70f64b1ec4063
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:42 2016 +0530

    cpufreq: omap: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 3843314389c7..4e525f6ec59f 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -28,6 +28,11 @@ static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "samsung,exynos5420", },
 	{ .compatible = "samsung,exynos5800", },
 #endif
+
+	{ .compatible = "ti,omap2", },
+	{ .compatible = "ti,omap3", },
+	{ .compatible = "ti,omap4", },
+	{ .compatible = "ti,omap5", },
 };
 
 static int __init cpufreq_dt_platdev_init(void)

commit 7ead83f6df2b105e4973140fe323a93ccfd4f8f9
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:41 2016 +0530

    cpufreq: imx: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Note that the complete routine imx27_dt_init() is removed as
    
    of_platform_populate(NULL, of_default_bus_match_table, NULL, NULL);
    
    has same effect as a NULL .init_machine machine callback pointer.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Lucas Stach <l.stach@pengutronix.de>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 3e1c8211c213..3843314389c7 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -12,6 +12,11 @@
 #include <linux/platform_device.h>
 
 static const struct of_device_id machines[] __initconst = {
+	{ .compatible = "fsl,imx27", },
+	{ .compatible = "fsl,imx51", },
+	{ .compatible = "fsl,imx53", },
+	{ .compatible = "fsl,imx7d", },
+
 	{ .compatible = "marvell,berlin", },
 
 	{ .compatible = "samsung,exynos3250", },

commit a59511d1daa6406eede58a79f99250ffcd9a3566
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:40 2016 +0530

    cpufreq: berlin: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Acked-by: Antoine Tenart <antoine.tenart@free-electrons.com>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 00da8c8bee6c..3e1c8211c213 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -12,6 +12,8 @@
 #include <linux/platform_device.h>
 
 static const struct of_device_id machines[] __initconst = {
+	{ .compatible = "marvell,berlin", },
+
 	{ .compatible = "samsung,exynos3250", },
 	{ .compatible = "samsung,exynos4210", },
 	{ .compatible = "samsung,exynos4212", },

commit e92bb16674c5156ea9230ba7a3ab6d490750888f
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Fri Apr 22 16:58:39 2016 +0530

    cpufreq: dt: Mark platdev machines array as __initconst
    
    The machines array in cpufreq-dt-platdev is used only once at boot time
    and so should be marked with __initconst, so that kernel can free up
    memory used for it, if required.
    
    Suggested-by: Geert Uytterhoeven <geert@linux-m68k.org>
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index f2ae7ad99a3c..00da8c8bee6c 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -11,7 +11,7 @@
 #include <linux/of.h>
 #include <linux/platform_device.h>
 
-static const struct of_device_id machines[] = {
+static const struct of_device_id machines[] __initconst = {
 	{ .compatible = "samsung,exynos3250", },
 	{ .compatible = "samsung,exynos4210", },
 	{ .compatible = "samsung,exynos4212", },

commit 2249c00a0bf854adf49e8e3c2973feddfbaae71f
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Wed Mar 30 13:45:28 2016 +0530

    cpufreq: exynos: Use generic platdev driver
    
    The cpufreq-dt-platdev driver supports creation of cpufreq-dt platform
    device now, reuse that and remove similar code from platform code.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Reviewed-by: Krzysztof Kozlowski <k.kozlowski@samsung.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
index 2a3532427ecf..f2ae7ad99a3c 100644
--- a/drivers/cpufreq/cpufreq-dt-platdev.c
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -12,6 +12,15 @@
 #include <linux/platform_device.h>
 
 static const struct of_device_id machines[] = {
+	{ .compatible = "samsung,exynos3250", },
+	{ .compatible = "samsung,exynos4210", },
+	{ .compatible = "samsung,exynos4212", },
+	{ .compatible = "samsung,exynos4412", },
+	{ .compatible = "samsung,exynos5250", },
+#ifndef CONFIG_BL_SWITCHER
+	{ .compatible = "samsung,exynos5420", },
+	{ .compatible = "samsung,exynos5800", },
+#endif
 };
 
 static int __init cpufreq_dt_platdev_init(void)

commit f56aad1d98f1c0c6df513abcd275a4d914adc1ef
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Wed Mar 30 13:45:26 2016 +0530

    cpufreq: dt: Add generic platform-device creation support
    
    Multiple platforms are using the generic cpufreq-dt driver now, and all
    of them are required to create a platform device with name "cpufreq-dt",
    in order to get the cpufreq-dt probed.
    
    Many of them do it from platform code, others have special drivers just
    to do that.
    
    It would be more sensible to do this at a generic place, where all such
    platform can mark their entries.
    
    This patch adds a separate file to get this device created. Currently
    the compat list of platforms that we support is empty, and will be
    filled in as and when we move platforms to use it.
    
    It always compiles as part of the kernel and so doesn't need a
    module-exit operation.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Reviewed-by: Krzysztof Kozlowski <k.kozlowski@samsung.com>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq-dt-platdev.c b/drivers/cpufreq/cpufreq-dt-platdev.c
new file mode 100644
index 000000000000..2a3532427ecf
--- /dev/null
+++ b/drivers/cpufreq/cpufreq-dt-platdev.c
@@ -0,0 +1,32 @@
+/*
+ * Copyright (C) 2016 Linaro.
+ * Viresh Kumar <viresh.kumar@linaro.org>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+#include <linux/err.h>
+#include <linux/of.h>
+#include <linux/platform_device.h>
+
+static const struct of_device_id machines[] = {
+};
+
+static int __init cpufreq_dt_platdev_init(void)
+{
+	struct device_node *np = of_find_node_by_path("/");
+
+	if (!np)
+		return -ENODEV;
+
+	if (!of_match_node(machines, np))
+		return -ENODEV;
+
+	of_node_put(of_root);
+
+	return PTR_ERR_OR_ZERO(platform_device_register_simple("cpufreq-dt", -1,
+							       NULL, 0));
+}
+device_initcall(cpufreq_dt_platdev_init);
