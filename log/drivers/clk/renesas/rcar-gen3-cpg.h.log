commit ff060019f4e536b7456fb5d4ac7891b102cb4a44
Merge: 5816b74581b4 b06df56bad2c e71f4d385878 7b4c162e03d4 30b8e27e3b58 d65530ca866d
Author: Stephen Boyd <sboyd@kernel.org>
Date:   Tue May 7 11:45:29 2019 -0700

    Merge branches 'clk-stm32f4', 'clk-tegra', 'clk-at91', 'clk-sifive-fu540' and 'clk-spdx' into clk-next
    
     - Support for STM32F769
     - Rework AT91 sckc DT bindings
     - Fix slow RC oscillator issue on sama5d3
     - AT91 sam9x60 PMC support
     - SiFive FU540 PRCI and PLL support
    
    * clk-stm32f4:
      clk: stm32mp1: Add ddrperfm clock
      clk: stm32: Introduce clocks of STM32F769 board
    
    * clk-tegra:
      clk: tegra: divider: Mark Memory Controller clock as read-only
      clk: tegra: emc: Replace BUG() with WARN_ONCE()
      clk: tegra: emc: Fix EMC max-rate clamping
      clk: tegra: emc: Support multiple RAM codes
      clk: tegra: emc: Don't enable EMC clock manually
      clk: tegra124: Remove lock-enable bit from PLLM
      clk: tegra: Fix PLLM programming on Tegra124+ when PMC overrides divider
      clk: tegra: Don't enable already enabled PLLs
    
    * clk-at91:
      clk: at91: Mark struct clk_range as const
      clk: at91: add sam9x60 pmc driver
      dt-bindings: clk: at91: add bindings for SAM9X60 pmc
      clk: at91: add sam9x60 PLL driver
      clk: at91: master: Add sam9x60 support
      clk: at91: usb: Add sam9x60 support
      clk: at91: allow configuring generated PCR layout
      clk: at91: allow configuring peripheral PCR layout
      clk: at91: sckc: handle different RC startup time
      clk: at91: modernize sckc binding
      dt-bindings: clock: at91: new sckc bindings
    
    * clk-sifive-fu540:
      clk: sifive: add a driver for the SiFive FU540 PRCI IP block
      clk: analogbits: add Wide-Range PLL library
      dt-bindings: clk: add documentation for the SiFive PRCI driver
    
    * clk-spdx:
      clk: sunxi-ng: Use the correct style for SPDX License Identifier
      clk: sprd: Use the correct style for SPDX License Identifier
      clk: renesas: Use the correct style for SPDX License Identifier
      clk: qcom: Use the correct style for SPDX License Identifier
      clk: davinci: Use the correct style for SPDX License Identifier
      clk: actions: Use the correct style for SPDX License Identifier

commit 596c5ea465282b89f1b1524ca76a2fa3978c6f3b
Author: Nishad Kamdar <nishadkamdar@gmail.com>
Date:   Wed May 1 14:54:07 2019 +0530

    clk: renesas: Use the correct style for SPDX License Identifier
    
    This patch corrects the SPDX License Identifier style
    in header files related to Clock Drivers for Renesas Socs.
    For C header files Documentation/process/license-rules.rst
    mandates C-like comments (opposed to C source files where
    C++ style should be used)
    
    Changes made by using a script provided by Joe Perches here:
    https://lkml.org/lkml/2019/2/7/46
    
    Suggested-by: Joe Perches <joe@perches.com>
    Signed-off-by: Nishad Kamdar <nishadkamdar@gmail.com>
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index eac1b057455a..d87f63119a8c 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -1,5 +1,5 @@
-/* SPDX-License-Identifier: GPL-2.0
- *
+/* SPDX-License-Identifier: GPL-2.0 */
+/*
  * R-Car Gen3 Clock Pulse Generator
  *
  * Copyright (C) 2015-2018 Glider bvba

commit e0836e36384321ab1b4af05ab441c0c59a972596
Author: Simon Horman <horms+renesas@verge.net.au>
Date:   Mon Mar 25 17:35:52 2019 +0100

    clk: renesas: rcar-gen3: Remove CLK_TYPE_GEN3_Z2
    
    After recent reworking of Z and Z2 clk handling
    CLK_TYPE_GEN3_Z and CLK_TYPE_GEN3_Z2 have come to have precisely
    the same meaning. Remove this redundancy by eliminating the latter.
    
    This is not expected to have any run-time effect.
    
    As suggested by Geert Uytterhoeven.
    
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index 9b4bb763f599..15700d219a05 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -21,7 +21,6 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_R,
 	CLK_TYPE_GEN3_MDSEL,	/* Select parent/divider using mode pin */
 	CLK_TYPE_GEN3_Z,
-	CLK_TYPE_GEN3_Z2,
 	CLK_TYPE_GEN3_OSC,	/* OSC EXTAL predivider and fixed divider */
 	CLK_TYPE_GEN3_RCKSEL,	/* Select parent/divider using RCKCR.CKSEL */
 	CLK_TYPE_GEN3_RPCSRC,

commit 10d9ea5100c89afd677a202036e0e34e129a6c52
Author: Simon Horman <horms+renesas@verge.net.au>
Date:   Mon Mar 25 17:35:51 2019 +0100

    clk: renesas: rcar-gen3: Parameterise Z and Z2 clock offset
    
    Parameterise the offset of control bits within the FRQCRC register
    for Z and Z2 clocks.
    
    This is in preparation for supporting the Z2 clock on the R-Car E3
    (r8a77990) SoC which uses a different offset for control bits to
    other, already, supported SoCs.
    
    As suggested by Geert Uytterhoeven.
    
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index 802936625330..9b4bb763f599 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -52,8 +52,8 @@ enum rcar_gen3_clk_types {
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_RCKSEL,	\
 		 (_parent0) << 16 | (_parent1),	.div = (_div0) << 16 | (_div1))
 
-#define DEF_GEN3_Z(_name, _id, _type, _parent, _div)	\
-	DEF_BASE(_name, _id, _type, _parent, .div = _div)
+#define DEF_GEN3_Z(_name, _id, _type, _parent, _div, _offset)	\
+	DEF_BASE(_name, _id, _type, _parent, .div = _div, .offset = _offset)
 
 struct rcar_gen3_cpg_pll_config {
 	u8 extal_div;

commit 20cc05ba04a93f05d6c50789fe35d762a2db4e96
Author: Takeshi Kihara <takeshi.kihara.df@renesas.com>
Date:   Mon Mar 25 17:35:50 2019 +0100

    clk: renesas: rcar-gen3: Parameterise Z and Z2 clock fixed divisor
    
    Parameterise Z and Z2 clock fixed divisor to allow clocks with a fixed
    divisor other than 2, the value used by all such clocks supported to date.
    
    This is in preparation for supporting the Z2 clock on the R-Car E3
    (r8a77990) SoC which has a fixed divisor of 4.
    
    Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
    [simon: squashed several patches; rewrote changelog; added r8a774a1 change]
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index eac1b057455a..802936625330 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -3,6 +3,7 @@
  * R-Car Gen3 Clock Pulse Generator
  *
  * Copyright (C) 2015-2018 Glider bvba
+ * Copyright (C) 2018 Renesas Electronics Corp.
  *
  */
 
@@ -51,6 +52,9 @@ enum rcar_gen3_clk_types {
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_RCKSEL,	\
 		 (_parent0) << 16 | (_parent1),	.div = (_div0) << 16 | (_div1))
 
+#define DEF_GEN3_Z(_name, _id, _type, _parent, _div)	\
+	DEF_BASE(_name, _id, _type, _parent, .div = _div)
+
 struct rcar_gen3_cpg_pll_config {
 	u8 extal_div;
 	u8 pll1_mult;

commit db4a0073cc82a95d8d1a9b05fde82355fcce77d8
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Tue Jan 22 22:59:35 2019 +0300

    clk: renesas: rcar-gen3: Add RPC clocks
    
    The RPCSRC internal clock is controlled by the RPCCKCR.DIV[4:3] on all
    the R-Car gen3 SoCs except V3M (R8A77970) but the encoding of this field
    is different between SoCs; it makes sense to support the most common case
    of this encoding in the R-Car gen3 CPG driver...
    
    After adding the RPCSRC clock, we can add the RPC[D2] clocks derived from
    it and controlled by the RPCCKCR register on all the R-Car gen3 SoCs except
    V3M (R8A77970); the composite clock driver seems handy for this task, using
    the spinlock added in the previous patch...
    
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index f4fb6cf16688..eac1b057455a 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -23,6 +23,9 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_Z2,
 	CLK_TYPE_GEN3_OSC,	/* OSC EXTAL predivider and fixed divider */
 	CLK_TYPE_GEN3_RCKSEL,	/* Select parent/divider using RCKCR.CKSEL */
+	CLK_TYPE_GEN3_RPCSRC,
+	CLK_TYPE_GEN3_RPC,
+	CLK_TYPE_GEN3_RPCD2,
 
 	/* SoC specific definitions start here */
 	CLK_TYPE_GEN3_SOC_BASE,
@@ -57,6 +60,7 @@ struct rcar_gen3_cpg_pll_config {
 	u8 osc_prediv;
 };
 
+#define CPG_RPCCKCR	0x238
 #define CPG_RCKCR	0x240
 
 struct clk *rcar_gen3_cpg_clk_register(struct device *dev,

commit faff3d8e852b1450e0e8e8f60c4e9af98549548a
Merge: 9710ee14bec9 be783cc8d72b
Author: Stephen Boyd <sboyd@kernel.org>
Date:   Thu Oct 18 15:38:51 2018 -0700

    Merge branch 'clk-renesas' into clk-next
    
    * clk-renesas: (36 commits)
      clk: renesas: r7s9210: Add SPI clocks
      clk: renesas: r7s9210: Move table update to separate function
      clk: renesas: r7s9210: Convert some clocks to early
      clk: renesas: cpg-mssr: Add early clock support
      clk: renesas: r8a77970: Add TPU clock
      clk: renesas: r8a77990: Fix incorrect PLL0 divider in comment
      dt-bindings: clock: renesas: cpg-mssr: Document r8a774c0
      clk: renesas: cpg-mssr: Add r8a774c0 support
      clk: renesas: Add r8a774c0 CPG Core Clock Definitions
      clk: renesas: r8a7743: Add r8a7744 support
      clk: renesas: Add r8a7744 CPG Core Clock Definitions
      dt-bindings: clock: renesas: cpg-mssr: Document r8a7744 binding
      dt-bindings: clock: renesas: Convert to SPDX identifiers
      clk: renesas: cpg-mssr: Add R7S9210 support
      clk: renesas: r8a77970: Add TMU clocks
      clk: renesas: r8a77970: Add CMT clocks
      clk: renesas: r9a06g032: Fix UART34567 clock rate
      clk: renesas: r8a77970: Add SD0H/SD0 clocks for SDHI
      clk: renesas: r8a77980: Add CMT clocks
      clk: renesas: r8a77990: Add missing I2C7 clock
      ...

commit 9e288cefcc551c7b5b04f8abc7099d3451a70f5f
Author: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
Date:   Tue Sep 25 09:34:05 2018 +0200

    clk: renesas: Convert to SPDX identifiers
    
    This patch updates license to use SPDX-License-Identifier
    instead of verbose license text.
    
    Signed-off-by: Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
    [rebased against clk-spdx]
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Stephen Boyd <sboyd@kernel.org>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index ea4f8fc3c4c9..6ebc4b42c5a3 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -1,11 +1,8 @@
-/*
+/* SPDX-License-Identifier: GPL-2.0
+ *
  * R-Car Gen3 Clock Pulse Generator
  *
  * Copyright (C) 2015-2016 Glider bvba
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; version 2 of the License.
  */
 
 #ifndef __CLK_RENESAS_RCAR_GEN3_CPG_H__

commit 381081ffc2948e1e1a7cbbafe3b91631530a1936
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Sat Sep 1 23:12:28 2018 +0300

    clk: renesas: r8a77970: Add SD0H/SD0 clocks for SDHI
    
    On R-Car V3M (AKA R8A77970), the SD0CKCR is laid out differently than on
    the other R-Car gen3 SoCs. In fact, the layout is the same as on R-Car gen2
    SoCs, so we'll need to copy the divisor tables from the R-Car gen2 driver.
    We'll also need to support the SoC specific clock types, thus we're adding
    CLK_TYPE_GEN3_SOC_BASE at the end of 'enum rcar_gen3_clk_types', declare
    SD0H/SDH clocks in 'enum r8a77970_clk_types', and handle those clocks in
    the overridden cpg_clk_register() method; then, finally, add the SD-IF
    module clock (derived from the SD0 clock).
    
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index 04dc45d15874..ba4e4f1946a9 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -25,6 +25,9 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_Z2,
 	CLK_TYPE_GEN3_OSC,	/* OSC EXTAL predivider and fixed divider */
 	CLK_TYPE_GEN3_RCKSEL,	/* Select parent/divider using RCKCR.CKSEL */
+
+	/* SoC specific definitions start here */
+	CLK_TYPE_GEN3_SOC_BASE,
 };
 
 #define DEF_GEN3_SD(_name, _id, _parent, _offset)	\

commit cd51e427e050f6a3d3bc3e0e38ad30974a52cb44
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Jul 11 14:19:47 2018 +0200

    clk: renesas: rcar-gen3: Add support for mode pin clock selection
    
    Make the existing support for selecting between clean and SSCG clocks
    using MD12 more generic, to allow using other mode pins for arbitrary
    clock selection.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index 7c49aebf9dd1..04dc45d15874 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -20,7 +20,7 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_PLL4,
 	CLK_TYPE_GEN3_SD,
 	CLK_TYPE_GEN3_R,
-	CLK_TYPE_GEN3_PE,
+	CLK_TYPE_GEN3_MDSEL,	/* Select parent/divider using mode pin */
 	CLK_TYPE_GEN3_Z,
 	CLK_TYPE_GEN3_Z2,
 	CLK_TYPE_GEN3_OSC,	/* OSC EXTAL predivider and fixed divider */
@@ -30,11 +30,16 @@ enum rcar_gen3_clk_types {
 #define DEF_GEN3_SD(_name, _id, _parent, _offset)	\
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_SD, _parent, .offset = _offset)
 
+#define DEF_GEN3_MDSEL(_name, _id, _md, _parent0, _div0, _parent1, _div1) \
+	DEF_BASE(_name, _id, CLK_TYPE_GEN3_MDSEL,	\
+		 (_parent0) << 16 | (_parent1),		\
+		 .div = (_div0) << 16 | (_div1), .offset = _md)
+
 #define DEF_GEN3_PE(_name, _id, _parent_sscg, _div_sscg, _parent_clean, \
 		    _div_clean) \
-	DEF_BASE(_name, _id, CLK_TYPE_GEN3_PE,			\
-		 (_parent_sscg) << 16 | (_parent_clean),	\
-		 .div = (_div_sscg) << 16 | (_div_clean))
+	DEF_GEN3_MDSEL(_name, _id, 12, _parent_sscg, _div_sscg,	\
+		       _parent_clean, _div_clean)
+
 #define DEF_GEN3_OSC(_name, _id, _parent, _div)		\
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_OSC, _parent, .div = _div)
 

commit b9d0b84b3db8552f033d5051393b90852b977a76
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Jul 11 13:54:30 2018 +0200

    clk: renesas: rcar-gen3: Add support for RCKSEL clock selection
    
    Add a clock type and macro for defining clocks where the parent and
    divider are selected based on the value of the RCKCR.CKSEL bit.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index d7d84d9e4a1c..7c49aebf9dd1 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -1,7 +1,7 @@
 /*
  * R-Car Gen3 Clock Pulse Generator
  *
- * Copyright (C) 2015-2016 Glider bvba
+ * Copyright (C) 2015-2018 Glider bvba
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -24,6 +24,7 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_Z,
 	CLK_TYPE_GEN3_Z2,
 	CLK_TYPE_GEN3_OSC,	/* OSC EXTAL predivider and fixed divider */
+	CLK_TYPE_GEN3_RCKSEL,	/* Select parent/divider using RCKCR.CKSEL */
 };
 
 #define DEF_GEN3_SD(_name, _id, _parent, _offset)	\
@@ -37,6 +38,10 @@ enum rcar_gen3_clk_types {
 #define DEF_GEN3_OSC(_name, _id, _parent, _div)		\
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_OSC, _parent, .div = _div)
 
+#define DEF_GEN3_RCKSEL(_name, _id, _parent0, _div0, _parent1, _div1) \
+	DEF_BASE(_name, _id, CLK_TYPE_GEN3_RCKSEL,	\
+		 (_parent0) << 16 | (_parent1),	.div = (_div0) << 16 | (_div1))
+
 struct rcar_gen3_cpg_pll_config {
 	u8 extal_div;
 	u8 pll1_mult;

commit 38c79e2899a66096583f3377c64b35f30584f1b4
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Jul 11 13:14:44 2018 +0200

    clk: renesas: rcar-gen3: Add support for OSC EXTAL predivider
    
    Add a clock type and macro for defining clocks using the OSC EXTAL
    predivider combined with a fixed divider.
    
    On most R-Car Gen3 SoCs, the predivider value depends on mode pins, and
    thus must be specified in the configuration structure.
    
    Inspired by a patch in the BSP by Takeshi Kihara
    <takeshi.kihara.df@renesas.com>.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index ea4f8fc3c4c9..d7d84d9e4a1c 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -23,6 +23,7 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_PE,
 	CLK_TYPE_GEN3_Z,
 	CLK_TYPE_GEN3_Z2,
+	CLK_TYPE_GEN3_OSC,	/* OSC EXTAL predivider and fixed divider */
 };
 
 #define DEF_GEN3_SD(_name, _id, _parent, _offset)	\
@@ -33,6 +34,8 @@ enum rcar_gen3_clk_types {
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_PE,			\
 		 (_parent_sscg) << 16 | (_parent_clean),	\
 		 .div = (_div_sscg) << 16 | (_div_clean))
+#define DEF_GEN3_OSC(_name, _id, _parent, _div)		\
+	DEF_BASE(_name, _id, CLK_TYPE_GEN3_OSC, _parent, .div = _div)
 
 struct rcar_gen3_cpg_pll_config {
 	u8 extal_div;
@@ -40,6 +43,7 @@ struct rcar_gen3_cpg_pll_config {
 	u8 pll1_div;
 	u8 pll3_mult;
 	u8 pll3_div;
+	u8 osc_prediv;
 };
 
 #define CPG_RCKCR	0x240

commit 41ceeb5fef7719474a17a5a6052cae5b6c9e37c0
Author: Takeshi Kihara <takeshi.kihara.df@renesas.com>
Date:   Mon Jan 29 19:01:50 2018 +0100

    clk: renesas: rcar-gen3: Add Z2 clock divider support
    
    This patch adds Z2 clock divider support for R-Car Gen3 SoC.
    
    Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index c73d4d6fdc85..ea4f8fc3c4c9 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -22,6 +22,7 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_R,
 	CLK_TYPE_GEN3_PE,
 	CLK_TYPE_GEN3_Z,
+	CLK_TYPE_GEN3_Z2,
 };
 
 #define DEF_GEN3_SD(_name, _id, _parent, _offset)	\

commit 3391891fa9c82fd14bcddec2f422299b57ce8091
Author: Takeshi Kihara <takeshi.kihara.df@renesas.com>
Date:   Mon Jan 29 19:01:49 2018 +0100

    clk: renesas: rcar-gen3: Add Z clock divider support
    
    This patch adds Z clock divider support for R-Car Gen3 SoC.
    
    Signed-off-by: Takeshi Kihara <takeshi.kihara.df@renesas.com>
    Signed-off-by: Simon Horman <horms+renesas@verge.net.au>
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index 2e4284399f53..c73d4d6fdc85 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -21,6 +21,7 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_SD,
 	CLK_TYPE_GEN3_R,
 	CLK_TYPE_GEN3_PE,
+	CLK_TYPE_GEN3_Z,
 };
 
 #define DEF_GEN3_SD(_name, _id, _parent, _offset)	\

commit 1f4023cdd1bdbe6cb01d0b2cbd1f46207189e3cf
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Jun 21 22:24:15 2017 +0200

    clk: renesas: cpg-mssr: Add support to restore core clocks during resume
    
    On R-Car Gen3 systems, PSCI system suspend powers down the SoC, possibly
    losing clock configuration.  Hence add a notifier chain that can be used
    by core clocks to save/restore clock state during system suspend/resume.
    
    The implementation of the actual clock state save/restore operations is
    clock-specific, and to be registered with the notifier chain in the SoC
    or family-specific cpg_mssr_info.cpg_clk_register() callback.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Tested-by: Niklas Söderlund <niklas.soderlund+renesas@ragnatech.se>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index d756ef8b78eb..2e4284399f53 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -44,7 +44,8 @@ struct rcar_gen3_cpg_pll_config {
 
 struct clk *rcar_gen3_cpg_clk_register(struct device *dev,
 	const struct cpg_core_clk *core, const struct cpg_mssr_info *info,
-	struct clk **clks, void __iomem *base);
+	struct clk **clks, void __iomem *base,
+	struct raw_notifier_head *notifiers);
 int rcar_gen3_cpg_init(const struct rcar_gen3_cpg_pll_config *config,
 		       unsigned int clk_extalr, u32 mode);
 

commit 696997e004d4179f462d2ebd3efeb12a7cec5ef7
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Jul 19 17:39:54 2017 +0200

    clk: renesas: rcar-gen3: Add support for SCCG/Clean peripheral clocks
    
    On R-Car Gen3 SoCs with a Spread Spectrum Clock Generator (e.g. R-Car
    D3), a peripheral clock divider has been added, to select between clean
    and spread spectrum parents.
    
    Add a new clock type to the R-Car Gen3 driver core to handle this.
    To avoid increasing the size of struct cpg_core_clk, both parents and
    dividers are stored in the existing parent resp. div fields.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Acked-by: Stephen Boyd <sboyd@codeaurora.org>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index 4eaf02955580..d756ef8b78eb 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -20,11 +20,18 @@ enum rcar_gen3_clk_types {
 	CLK_TYPE_GEN3_PLL4,
 	CLK_TYPE_GEN3_SD,
 	CLK_TYPE_GEN3_R,
+	CLK_TYPE_GEN3_PE,
 };
 
 #define DEF_GEN3_SD(_name, _id, _parent, _offset)	\
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_SD, _parent, .offset = _offset)
 
+#define DEF_GEN3_PE(_name, _id, _parent_sscg, _div_sscg, _parent_clean, \
+		    _div_clean) \
+	DEF_BASE(_name, _id, CLK_TYPE_GEN3_PE,			\
+		 (_parent_sscg) << 16 | (_parent_clean),	\
+		 .div = (_div_sscg) << 16 | (_div_clean))
+
 struct rcar_gen3_cpg_pll_config {
 	u8 extal_div;
 	u8 pll1_mult;

commit 09a7dea9d58aadda90af5ad4dce1d540fe830868
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Jul 19 16:30:45 2017 +0200

    clk: renesas: rcar-gen3: Add divider support for PLL1 and PLL3
    
    On some R-Car Gen3 SoCs (e.g. R-Car D3), PLL1 and PLL3 use a divider
    value different from one.  Extend struct rcar_gen3_cpg_pll_config to handle
    this.  As all multipliers and dividers are small, table size increase
    can be kept limited by storing them in u8s instead of unsigned ints,
    which saves ca. 0.5 KiB for a generic kernel.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Acked-by: Stephen Boyd <sboyd@codeaurora.org>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index 073be54b5d03..4eaf02955580 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -26,9 +26,11 @@ enum rcar_gen3_clk_types {
 	DEF_BASE(_name, _id, CLK_TYPE_GEN3_SD, _parent, .offset = _offset)
 
 struct rcar_gen3_cpg_pll_config {
-	unsigned int extal_div;
-	unsigned int pll1_mult;
-	unsigned int pll3_mult;
+	u8 extal_div;
+	u8 pll1_mult;
+	u8 pll1_div;
+	u8 pll3_mult;
+	u8 pll3_div;
 };
 
 #define CPG_RCKCR	0x240

commit 5f3a432a44b135db002d22446827cfa061fc0bfb
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Fri Mar 10 11:36:33 2017 +0100

    clk: renesas: rcar-gen3-cpg: Pass mode pins to rcar_gen3_cpg_init()
    
    Pass the mode pin states from the SoC-specific CPG/MSSR driver to the
    R-Car Gen3 CPG driver core, as their state will be needed to make some
    core clock configuration decisions.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index f788f481dd42..073be54b5d03 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -37,6 +37,6 @@ struct clk *rcar_gen3_cpg_clk_register(struct device *dev,
 	const struct cpg_core_clk *core, const struct cpg_mssr_info *info,
 	struct clk **clks, void __iomem *base);
 int rcar_gen3_cpg_init(const struct rcar_gen3_cpg_pll_config *config,
-		       unsigned int clk_extalr);
+		       unsigned int clk_extalr, u32 mode);
 
 #endif

commit ddab5aed8ecd277bd34b6421736c882fdff2dfe1
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed Jun 1 14:56:58 2016 +0200

    clk: renesas: rcar-gen3-cpg: Remove obsolete rcar_gen3_read_mode_pins()
    
    All R-Car Gen3 clock drivers now obtain the values of the mode pins from
    the R-Car RST driver.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Acked-by: Dirk Behme <dirk.behme@de.bosch.com>
    Reviewed-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
index f699085147d1..f788f481dd42 100644
--- a/drivers/clk/renesas/rcar-gen3-cpg.h
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -33,7 +33,6 @@ struct rcar_gen3_cpg_pll_config {
 
 #define CPG_RCKCR	0x240
 
-u32 rcar_gen3_read_mode_pins(void);
 struct clk *rcar_gen3_cpg_clk_register(struct device *dev,
 	const struct cpg_core_clk *core, const struct cpg_mssr_info *info,
 	struct clk **clks, void __iomem *base);

commit 5b1defde7054e66da5c0f6cba8b35cef29edede0
Author: Geert Uytterhoeven <geert+renesas@glider.be>
Date:   Wed May 4 14:32:56 2016 +0200

    clk: renesas: cpg-mssr: Extract common R-Car Gen3 support code
    
    Extract the code to support parts common to all members of the R-Car
    Gen3 SoC family into a separate file, to ease sharing among SoC-specific
    drivers.
    
    Note that while the cpg_pll_configs[] arrays and the selection of the
    config based on the MODE bits are identical on R-Car H3 and R-Car M3-W,
    they are not common, and may be different on other R-Car Gen3 SoCs.
    
    Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
    Tested-by: Simon Horman <horms+renesas@verge.net.au>

diff --git a/drivers/clk/renesas/rcar-gen3-cpg.h b/drivers/clk/renesas/rcar-gen3-cpg.h
new file mode 100644
index 000000000000..f699085147d1
--- /dev/null
+++ b/drivers/clk/renesas/rcar-gen3-cpg.h
@@ -0,0 +1,43 @@
+/*
+ * R-Car Gen3 Clock Pulse Generator
+ *
+ * Copyright (C) 2015-2016 Glider bvba
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; version 2 of the License.
+ */
+
+#ifndef __CLK_RENESAS_RCAR_GEN3_CPG_H__
+#define __CLK_RENESAS_RCAR_GEN3_CPG_H__
+
+enum rcar_gen3_clk_types {
+	CLK_TYPE_GEN3_MAIN = CLK_TYPE_CUSTOM,
+	CLK_TYPE_GEN3_PLL0,
+	CLK_TYPE_GEN3_PLL1,
+	CLK_TYPE_GEN3_PLL2,
+	CLK_TYPE_GEN3_PLL3,
+	CLK_TYPE_GEN3_PLL4,
+	CLK_TYPE_GEN3_SD,
+	CLK_TYPE_GEN3_R,
+};
+
+#define DEF_GEN3_SD(_name, _id, _parent, _offset)	\
+	DEF_BASE(_name, _id, CLK_TYPE_GEN3_SD, _parent, .offset = _offset)
+
+struct rcar_gen3_cpg_pll_config {
+	unsigned int extal_div;
+	unsigned int pll1_mult;
+	unsigned int pll3_mult;
+};
+
+#define CPG_RCKCR	0x240
+
+u32 rcar_gen3_read_mode_pins(void);
+struct clk *rcar_gen3_cpg_clk_register(struct device *dev,
+	const struct cpg_core_clk *core, const struct cpg_mssr_info *info,
+	struct clk **clks, void __iomem *base);
+int rcar_gen3_cpg_init(const struct rcar_gen3_cpg_pll_config *config,
+		       unsigned int clk_extalr);
+
+#endif
