commit 4b206d34b92224496c42226c4b6d92719056c8b6
Author: Rander Wang <rander.wang@linux.intel.com>
Date:   Wed Dec 11 19:45:02 2019 -0600

    soundwire: intel: update stream callbacks for hwparams/free stream operations
    
    The SoundWire DAIs for Intel platform are created in
    drivers/soundwire/intel.c, while the communication with the Intel DSP
    is all controlled in soc/sof/intel
    
    When the DAI status changes, a callback is used to bridge the gap
    between the two subsystems.
    
    The naming of the existing 'config_stream' callback does not map well
    with any of ALSA/ASoC concepts. This patch renames it as
    'params_stream' to be more self-explanatory.
    
    A new 'free_stream' callback is added in case any resources allocated
    in the 'params_stream' stage need to be released. In the SOF
    implementation, this is used in the hw_free case to release the DMA
    channels over IPC.
    
    These two callbacks now rely on structures which expose the link_id
    and alh_stream_id (required by the firmware IPC), instead of a list of
    parameters. The 'void *' definitions are changed to use explicit
    types, as suggested on alsa-devel during earlier reviews.
    
    Signed-off-by: Rander Wang <rander.wang@linux.intel.com>
    Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
    Link: https://lore.kernel.org/r/20191212014507.28050-7-pierre-louis.bossart@linux.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>

diff --git a/drivers/soundwire/intel.h b/drivers/soundwire/intel.h
index e4cc1d3804ff..38b7c125fb10 100644
--- a/drivers/soundwire/intel.h
+++ b/drivers/soundwire/intel.h
@@ -14,7 +14,7 @@
  * @alh: ALH (Audio Link Hub) pointer
  * @irq: Interrupt line
  * @ops: Shim callback ops
- * @arg: Shim callback ops argument
+ * @dev: device implementing hw_params and free callbacks
  */
 struct sdw_intel_link_res {
 	struct platform_device *pdev;
@@ -24,7 +24,7 @@ struct sdw_intel_link_res {
 	void __iomem *alh;
 	int irq;
 	const struct sdw_intel_ops *ops;
-	void *arg;
+	struct device *dev;
 };
 
 #endif /* __SDW_INTEL_LOCAL_H */

commit f98f690fb03c2a8d21dfa31aa1042480cf6f7f9b
Author: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Date:   Wed Dec 11 19:45:01 2019 -0600

    soundwire: intel: update interfaces between ASoC and SoundWire
    
    The current interfaces between ASoC and SoundWire are limited by the
    platform_device infrastructure to an init() and exit() (mapped to the
    platform driver.probe and .remove)
    
    To help with the platform detection, machine driver selection and
    management of power dependencies between DSP and SoundWire IP, the
    ASoC side requires:
    
    a) an ACPI scan helper, to report if any devices are exposed in the
    DSDT tables, and if any links are disabled by the BIOS.
    
    b) a probe helper that allocates the resources without actually
    starting the bus.
    
    c) a startup helper which does start the bus when all power
    dependencies are settled.
    
    d) an exit helper to free all resources
    
    e) an interrupt_enable/disable helper, typically invoked after the
    startup helper but also used in suspend routines.
    
    This patch moves all required interfaces to sdw_intel.h, mainly to
    allow SoundWire and ASoC parts to be merged separately once the header
    files are shared between trees.
    
    To avoid compilation issues, the conflicts in intel_init.c are blindly
    removed. This would in theory prevent the code from working, but since
    there are no users of the Intel Soundwire driver this has no
    impact. Functionality will be restored when the removal of platform
    devices is complete.
    
    Support for SoundWire + SOF builds will only be provided once all the
    required pieces are upstream.
    
    Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
    Link: https://lore.kernel.org/r/20191212014507.28050-6-pierre-louis.bossart@linux.intel.com
    Signed-off-by: Vinod Koul <vkoul@kernel.org>

diff --git a/drivers/soundwire/intel.h b/drivers/soundwire/intel.h
index d923b6262330..e4cc1d3804ff 100644
--- a/drivers/soundwire/intel.h
+++ b/drivers/soundwire/intel.h
@@ -5,17 +5,20 @@
 #define __SDW_INTEL_LOCAL_H
 
 /**
- * struct sdw_intel_link_res - Soundwire link resources
+ * struct sdw_intel_link_res - Soundwire Intel link resource structure,
+ * typically populated by the controller driver.
+ * @pdev: platform_device
+ * @mmio_base: mmio base of SoundWire registers
  * @registers: Link IO registers base
  * @shim: Audio shim pointer
  * @alh: ALH (Audio Link Hub) pointer
  * @irq: Interrupt line
  * @ops: Shim callback ops
  * @arg: Shim callback ops argument
- *
- * This is set as pdata for each link instance.
  */
 struct sdw_intel_link_res {
+	struct platform_device *pdev;
+	void __iomem *mmio_base; /* not strictly needed, useful for debug */
 	void __iomem *registers;
 	void __iomem *shim;
 	void __iomem *alh;

commit 27f14331a7d434ff860b3d23c2379cf1fb814a3c
Author: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Date:   Wed May 22 14:47:30 2019 -0500

    soundwire: fix typo in comments
    
    Copy/paste of sdw_intel_res
    
    Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>

diff --git a/drivers/soundwire/intel.h b/drivers/soundwire/intel.h
index 71050e5f643d..d923b6262330 100644
--- a/drivers/soundwire/intel.h
+++ b/drivers/soundwire/intel.h
@@ -5,7 +5,7 @@
 #define __SDW_INTEL_LOCAL_H
 
 /**
- * struct sdw_intel_res - Soundwire link resources
+ * struct sdw_intel_link_res - Soundwire link resources
  * @registers: Link IO registers base
  * @shim: Audio shim pointer
  * @alh: ALH (Audio Link Hub) pointer

commit 23859465529550fcf390f3a5a28cf767adb83232
Author: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Date:   Wed May 1 10:57:25 2019 -0500

    soundwire: fix SPDX license for header files
    
    No C++ comments in .h files
    
    Reviewed-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/soundwire/intel.h b/drivers/soundwire/intel.h
index c1a5bac6212e..71050e5f643d 100644
--- a/drivers/soundwire/intel.h
+++ b/drivers/soundwire/intel.h
@@ -1,5 +1,5 @@
-// SPDX-License-Identifier: (GPL-2.0 OR BSD-3-Clause)
-// Copyright(c) 2015-17 Intel Corporation.
+/* SPDX-License-Identifier: (GPL-2.0 OR BSD-3-Clause) */
+/* Copyright(c) 2015-17 Intel Corporation. */
 
 #ifndef __SDW_INTEL_LOCAL_H
 #define __SDW_INTEL_LOCAL_H

commit c46302ec554c575e79d791c7c84fd4c795e97680
Author: Vinod Koul <vkoul@kernel.org>
Date:   Thu Apr 26 18:39:05 2018 +0530

    soundwire: intel: Add audio DAI ops
    
    Add DAI registration and DAI ops for the Intel driver along with
    callback for topology configuration.
    
    Signed-off-by: Sanyog Kale <sanyog.r.kale@intel.com>
    Signed-off-by: Shreyas NC <shreyas.nc@intel.com>
    Signed-off-by: Vinod Koul <vkoul@kernel.org>

diff --git a/drivers/soundwire/intel.h b/drivers/soundwire/intel.h
index ffa30d9535a2..c1a5bac6212e 100644
--- a/drivers/soundwire/intel.h
+++ b/drivers/soundwire/intel.h
@@ -10,6 +10,8 @@
  * @shim: Audio shim pointer
  * @alh: ALH (Audio Link Hub) pointer
  * @irq: Interrupt line
+ * @ops: Shim callback ops
+ * @arg: Shim callback ops argument
  *
  * This is set as pdata for each link instance.
  */
@@ -18,6 +20,8 @@ struct sdw_intel_link_res {
 	void __iomem *shim;
 	void __iomem *alh;
 	int irq;
+	const struct sdw_intel_ops *ops;
+	void *arg;
 };
 
 #endif /* __SDW_INTEL_LOCAL_H */

commit 71bb8a1b059ecd6a070660b7d5d89a7a3c443f4a
Author: Vinod Koul <vinod.koul@intel.com>
Date:   Thu Dec 14 11:19:43 2017 +0530

    soundwire: intel: Add Intel Master driver
    
    Some Intel platforms have SoundWire Master, so add Intel SoundWire
    Master driver which uses Cadence module. This patch adds probe and
    initialization routines for Intel Master driver.
    
    Signed-off-by: Hardik T Shah <hardik.t.shah@intel.com>
    Signed-off-by: Sanyog Kale <sanyog.r.kale@intel.com>
    Reviewed-by: Philippe Ombredanne <pombredanne@nexb.com>
    Acked-By: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
    Reviewed-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Vinod Koul <vinod.koul@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/soundwire/intel.h b/drivers/soundwire/intel.h
new file mode 100644
index 000000000000..ffa30d9535a2
--- /dev/null
+++ b/drivers/soundwire/intel.h
@@ -0,0 +1,23 @@
+// SPDX-License-Identifier: (GPL-2.0 OR BSD-3-Clause)
+// Copyright(c) 2015-17 Intel Corporation.
+
+#ifndef __SDW_INTEL_LOCAL_H
+#define __SDW_INTEL_LOCAL_H
+
+/**
+ * struct sdw_intel_res - Soundwire link resources
+ * @registers: Link IO registers base
+ * @shim: Audio shim pointer
+ * @alh: ALH (Audio Link Hub) pointer
+ * @irq: Interrupt line
+ *
+ * This is set as pdata for each link instance.
+ */
+struct sdw_intel_link_res {
+	void __iomem *registers;
+	void __iomem *shim;
+	void __iomem *alh;
+	int irq;
+};
+
+#endif /* __SDW_INTEL_LOCAL_H */
