commit fbbc95a49d5b00a66d82ea34b7f029963b6c91f3
Author: Bart Van Assche <bvanassche@acm.org>
Date:   Mon May 18 14:16:59 2020 -0700

    scsi: qla2xxx: Suppress two recently introduced compiler warnings
    
    Suppress the following two compiler warnings because these are not useful:
    
    In file included from ./include/trace/define_trace.h:102,
                     from ./include/trace/events/qla.h:39,
                     from drivers/scsi/qla2xxx/qla_dbg.c:77:
    ./include/trace/events/qla.h: In function 'trace_event_raw_event_qla_log_event':
    ./include/trace/trace_events.h:691:9: warning: function 'trace_event_raw_event_qla_log_event' might be a candidate for 'gnu_printf' format attribute [-Wsuggest-attribute=format]
      691 |  struct trace_event_raw_##call *entry;    \
          |         ^~~~~~~~~~~~~~~~
    ./include/trace/events/qla.h:12:1: note: in expansion of macro 'DECLARE_EVENT_CLASS'
       12 | DECLARE_EVENT_CLASS(qla_log_event,
          | ^~~~~~~~~~~~~~~~~~~
    In file included from ./include/trace/define_trace.h:103,
                     from ./include/trace/events/qla.h:39,
                     from drivers/scsi/qla2xxx/qla_dbg.c:77:
    ./include/trace/events/qla.h: In function 'perf_trace_qla_log_event':
    ./include/trace/perf.h:41:9: warning: function 'perf_trace_qla_log_event' might be a candidate for 'gnu_printf' format attribute [-Wsuggest-attribute=format]
       41 |  struct hlist_head *head;     \
          |         ^~~~~~~~~~
    ./include/trace/events/qla.h:12:1: note: in expansion of macro 'DECLARE_EVENT_CLASS'
    
    Link: https://lore.kernel.org/r/20200518211712.11395-3-bvanassche@acm.org
    Fixes: 598a90f2002c ("scsi: qla2xxx: add ring buffer for tracing debug logs")
    Cc: Rajan Shanmugavelu <rajan.shanmugavelu@oracle.com>
    Cc: Joe Jin <joe.jin@oracle.com>
    Cc: Nilesh Javali <njavali@marvell.com>
    Cc: Quinn Tran <qutran@marvell.com>
    Cc: Martin Wilck <mwilck@suse.com>
    Reviewed-by: Daniel Wagner <dwagner@suse.de>
    Reviewed-by: Himanshu Madhani <himanshu.madhani@oracle.com>
    Reviewed-by: Hannes Reinecke <hare@suse.de>
    Reviewed-by: Arun Easi <aeasi@marvell.com>
    Signed-off-by: Bart Van Assche <bvanassche@acm.org>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

diff --git a/include/trace/events/qla.h b/include/trace/events/qla.h
index b71f680968eb..5857cf682ee7 100644
--- a/include/trace/events/qla.h
+++ b/include/trace/events/qla.h
@@ -9,6 +9,11 @@
 
 #define QLA_MSG_MAX 256
 
+#pragma GCC diagnostic push
+#ifndef __clang__
+#pragma GCC diagnostic ignored "-Wsuggest-attribute=format"
+#endif
+
 DECLARE_EVENT_CLASS(qla_log_event,
 	TP_PROTO(const char *buf,
 		struct va_format *vaf),
@@ -27,6 +32,8 @@ DECLARE_EVENT_CLASS(qla_log_event,
 	TP_printk("%s %s", __get_str(buf), __get_str(msg))
 );
 
+#pragma GCC diagnostic pop
+
 DEFINE_EVENT(qla_log_event, ql_dbg_log,
 	TP_PROTO(const char *buf, struct va_format *vaf),
 	TP_ARGS(buf, vaf)

commit 598a90f2002c4c4daee24d76d24e8270c7075eef
Author: Rajan Shanmugavelu <rajan.shanmugavelu@oracle.com>
Date:   Wed Feb 12 17:29:28 2020 -0800

    scsi: qla2xxx: add ring buffer for tracing debug logs
    
    Having this log in a ring buffer helps to diagnose qla2xxx driver and
    firmware issues instead of having to reproduce the problem with
    extended_logging enabled. This saves cycles and helps when it is hard
    to reproduce problem.
    
    Link: https://lore.kernel.org/r/1581557368-32080-1-git-send-email-rajan.shanmugavelu@oracle.com
    Reviewed-by: Joe Jin <joe.jin@oracle.com>
    Acked-by: Himanshu Madhani <hmadhani@marvell.com>
    Signed-off-by: Rajan Shanmugavelu <rajan.shanmugavelu@oracle.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

diff --git a/include/trace/events/qla.h b/include/trace/events/qla.h
new file mode 100644
index 000000000000..b71f680968eb
--- /dev/null
+++ b/include/trace/events/qla.h
@@ -0,0 +1,39 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+#if !defined(_TRACE_QLA_H_) || defined(TRACE_HEADER_MULTI_READ)
+#define _TRACE_QLA_H_
+
+#include <linux/tracepoint.h>
+
+#undef TRACE_SYSTEM
+#define TRACE_SYSTEM qla
+
+#define QLA_MSG_MAX 256
+
+DECLARE_EVENT_CLASS(qla_log_event,
+	TP_PROTO(const char *buf,
+		struct va_format *vaf),
+
+	TP_ARGS(buf, vaf),
+
+	TP_STRUCT__entry(
+		__string(buf, buf)
+		__dynamic_array(char, msg, QLA_MSG_MAX)
+	),
+	TP_fast_assign(
+		__assign_str(buf, buf);
+		vsnprintf(__get_str(msg), QLA_MSG_MAX, vaf->fmt, *vaf->va);
+	),
+
+	TP_printk("%s %s", __get_str(buf), __get_str(msg))
+);
+
+DEFINE_EVENT(qla_log_event, ql_dbg_log,
+	TP_PROTO(const char *buf, struct va_format *vaf),
+	TP_ARGS(buf, vaf)
+);
+
+#endif /* _TRACE_QLA_H */
+
+#define TRACE_INCLUDE_FILE qla
+
+#include <trace/define_trace.h>
