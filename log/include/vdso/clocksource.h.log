commit ca214e2c1793058e3a1387f9e343cc5b1731db15
Author: Vincenzo Frascino <vincenzo.frascino@arm.com>
Date:   Mon Mar 23 13:39:20 2020 +0000

    vdso: Fix clocksource.h macro detection
    
    CONFIG_GENERIC_GETTIMEOFDAY is a sufficient condition to verify if an
    architecture implements asm/vdso/clocksource.h or not. The current
    implementation wrongly assumes that the same is true for the config
    option CONFIG_ARCH_CLOCKSOURCE_DATA.
    
    This results in a series of build errors on ia64/sparc/sparc64 like this:
    
      In file included from ./include/linux/clocksource.h:31,
                       from ./include/linux/clockchips.h:14,
                       from ./include/linux/tick.h:8,
                       from fs/proc/stat.c:15:
      ./include/vdso/clocksource.h:9:10: fatal error: asm/vdso/clocksource.h:
      No such file or directory
          9 | #include <asm/vdso/clocksource.h>
            |          ^~~~~~~~~~~~~~~~~~~~~~~~
    
    Fix the issue removing the unneeded config condition.
    
    Fixes: 14ee2ac618e4 ("linux/clocksource.h: Extract common header for vDSO")
    Reported-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Vincenzo Frascino <vincenzo.frascino@arm.com>
    Signed-off-by: Borislav Petkov <bp@suse.de>
    Link: https://lkml.kernel.org/r/20200323133920.46546-1-vincenzo.frascino@arm.com

diff --git a/include/vdso/clocksource.h b/include/vdso/clocksource.h
index ab58330e4e5d..c682e7c60273 100644
--- a/include/vdso/clocksource.h
+++ b/include/vdso/clocksource.h
@@ -4,10 +4,9 @@
 
 #include <vdso/limits.h>
 
-#if defined(CONFIG_ARCH_CLOCKSOURCE_DATA) || \
-	defined(CONFIG_GENERIC_GETTIMEOFDAY)
+#ifdef CONFIG_GENERIC_GETTIMEOFDAY
 #include <asm/vdso/clocksource.h>
-#endif /* CONFIG_ARCH_CLOCKSOURCE_DATA || CONFIG_GENERIC_GETTIMEOFDAY */
+#endif /* CONFIG_GENERIC_GETTIMEOFDAY */
 
 enum vdso_clock_mode {
 	VDSO_CLOCKMODE_NONE,

commit 14ee2ac618e49e767c9af4aa007f951eb9e35153
Author: Vincenzo Frascino <vincenzo.frascino@arm.com>
Date:   Fri Mar 20 14:53:33 2020 +0000

    linux/clocksource.h: Extract common header for vDSO
    
    The vDSO library should only include the necessary headers required for
    a userspace library (UAPI and a minimal set of kernel headers). To make
    this possible it is necessary to isolate from the kernel headers the
    common parts that are strictly necessary to build the library.
    
    Split clocksource.h into linux and common headers to make the latter
    suitable for inclusion in the vDSO library.
    
    Signed-off-by: Vincenzo Frascino <vincenzo.frascino@arm.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Link: https://lkml.kernel.org/r/20200320145351.32292-9-vincenzo.frascino@arm.com

diff --git a/include/vdso/clocksource.h b/include/vdso/clocksource.h
new file mode 100644
index 000000000000..ab58330e4e5d
--- /dev/null
+++ b/include/vdso/clocksource.h
@@ -0,0 +1,23 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+#ifndef __VDSO_CLOCKSOURCE_H
+#define __VDSO_CLOCKSOURCE_H
+
+#include <vdso/limits.h>
+
+#if defined(CONFIG_ARCH_CLOCKSOURCE_DATA) || \
+	defined(CONFIG_GENERIC_GETTIMEOFDAY)
+#include <asm/vdso/clocksource.h>
+#endif /* CONFIG_ARCH_CLOCKSOURCE_DATA || CONFIG_GENERIC_GETTIMEOFDAY */
+
+enum vdso_clock_mode {
+	VDSO_CLOCKMODE_NONE,
+#ifdef CONFIG_GENERIC_GETTIMEOFDAY
+	VDSO_ARCH_CLOCKMODES,
+#endif
+	VDSO_CLOCKMODE_MAX,
+
+	/* Indicator for time namespace VDSO */
+	VDSO_CLOCKMODE_TIMENS = INT_MAX
+};
+
+#endif /* __VDSO_CLOCKSOURCE_H */
