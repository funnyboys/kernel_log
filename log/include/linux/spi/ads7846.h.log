commit b24413180f5600bcb3bb70fbed5cf186b60864bd
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Wed Nov 1 15:07:57 2017 +0100

    License cleanup: add SPDX GPL-2.0 license identifier to files with no license
    
    Many source files in the tree are missing licensing information, which
    makes it harder for compliance tools to determine the correct license.
    
    By default all files without license information are under the default
    license of the kernel, which is GPL version 2.
    
    Update the files which contain no license information with the 'GPL-2.0'
    SPDX license identifier.  The SPDX identifier is a legally binding
    shorthand, which can be used instead of the full boiler plate text.
    
    This patch is based on work done by Thomas Gleixner and Kate Stewart and
    Philippe Ombredanne.
    
    How this work was done:
    
    Patches were generated and checked against linux-4.14-rc6 for a subset of
    the use cases:
     - file had no licensing information it it.
     - file was a */uapi/* one with no licensing information in it,
     - file was a */uapi/* one with existing licensing information,
    
    Further patches will be generated in subsequent months to fix up cases
    where non-standard license headers were used, and references to license
    had to be inferred by heuristics based on keywords.
    
    The analysis to determine which SPDX License Identifier to be applied to
    a file was done in a spreadsheet of side by side results from of the
    output of two independent scanners (ScanCode & Windriver) producing SPDX
    tag:value files created by Philippe Ombredanne.  Philippe prepared the
    base worksheet, and did an initial spot review of a few 1000 files.
    
    The 4.13 kernel was the starting point of the analysis with 60,537 files
    assessed.  Kate Stewart did a file by file comparison of the scanner
    results in the spreadsheet to determine which SPDX license identifier(s)
    to be applied to the file. She confirmed any determination that was not
    immediately clear with lawyers working with the Linux Foundation.
    
    Criteria used to select files for SPDX license identifier tagging was:
     - Files considered eligible had to be source code files.
     - Make and config files were included as candidates if they contained >5
       lines of source
     - File already had some variant of a license header in it (even if <5
       lines).
    
    All documentation files were explicitly excluded.
    
    The following heuristics were used to determine which SPDX license
    identifiers to apply.
    
     - when both scanners couldn't find any license traces, file was
       considered to have no license information in it, and the top level
       COPYING file license applied.
    
       For non */uapi/* files that summary was:
    
       SPDX license identifier                            # files
       ---------------------------------------------------|-------
       GPL-2.0                                              11139
    
       and resulted in the first patch in this series.
    
       If that file was a */uapi/* path one, it was "GPL-2.0 WITH
       Linux-syscall-note" otherwise it was "GPL-2.0".  Results of that was:
    
       SPDX license identifier                            # files
       ---------------------------------------------------|-------
       GPL-2.0 WITH Linux-syscall-note                        930
    
       and resulted in the second patch in this series.
    
     - if a file had some form of licensing information in it, and was one
       of the */uapi/* ones, it was denoted with the Linux-syscall-note if
       any GPL family license was found in the file or had no licensing in
       it (per prior point).  Results summary:
    
       SPDX license identifier                            # files
       ---------------------------------------------------|------
       GPL-2.0 WITH Linux-syscall-note                       270
       GPL-2.0+ WITH Linux-syscall-note                      169
       ((GPL-2.0 WITH Linux-syscall-note) OR BSD-2-Clause)    21
       ((GPL-2.0 WITH Linux-syscall-note) OR BSD-3-Clause)    17
       LGPL-2.1+ WITH Linux-syscall-note                      15
       GPL-1.0+ WITH Linux-syscall-note                       14
       ((GPL-2.0+ WITH Linux-syscall-note) OR BSD-3-Clause)    5
       LGPL-2.0+ WITH Linux-syscall-note                       4
       LGPL-2.1 WITH Linux-syscall-note                        3
       ((GPL-2.0 WITH Linux-syscall-note) OR MIT)              3
       ((GPL-2.0 WITH Linux-syscall-note) AND MIT)             1
    
       and that resulted in the third patch in this series.
    
     - when the two scanners agreed on the detected license(s), that became
       the concluded license(s).
    
     - when there was disagreement between the two scanners (one detected a
       license but the other didn't, or they both detected different
       licenses) a manual inspection of the file occurred.
    
     - In most cases a manual inspection of the information in the file
       resulted in a clear resolution of the license that should apply (and
       which scanner probably needed to revisit its heuristics).
    
     - When it was not immediately clear, the license identifier was
       confirmed with lawyers working with the Linux Foundation.
    
     - If there was any question as to the appropriate license identifier,
       the file was flagged for further research and to be revisited later
       in time.
    
    In total, over 70 hours of logged manual review was done on the
    spreadsheet to determine the SPDX license identifiers to apply to the
    source files by Kate, Philippe, Thomas and, in some cases, confirmation
    by lawyers working with the Linux Foundation.
    
    Kate also obtained a third independent scan of the 4.13 code base from
    FOSSology, and compared selected files where the other two scanners
    disagreed against that SPDX file, to see if there was new insights.  The
    Windriver scanner is based on an older version of FOSSology in part, so
    they are related.
    
    Thomas did random spot checks in about 500 files from the spreadsheets
    for the uapi headers and agreed with SPDX license identifier in the
    files he inspected. For the non-uapi files Thomas did random spot checks
    in about 15000 files.
    
    In initial set of patches against 4.14-rc6, 3 files were found to have
    copy/paste license identifier errors, and have been fixed to reflect the
    correct identifier.
    
    Additionally Philippe spent 10 hours this week doing a detailed manual
    inspection and review of the 12,461 patched files from the initial patch
    version early this week with:
     - a full scancode scan run, collecting the matched texts, detected
       license ids and scores
     - reviewing anything where there was a license detected (about 500+
       files) to ensure that the applied SPDX license was correct
     - reviewing anything where there was no detection but the patch license
       was not GPL-2.0 WITH Linux-syscall-note to ensure that the applied
       SPDX license was correct
    
    This produced a worksheet with 20 files needing minor correction.  This
    worksheet was then exported into 3 different .csv files for the
    different types of files to be modified.
    
    These .csv files were then reviewed by Greg.  Thomas wrote a script to
    parse the csv files and add the proper SPDX tag to the file, in the
    format that the file expected.  This script was further refined by Greg
    based on the output to detect more types of files automatically and to
    distinguish between header and source .c files (which need different
    comment types.)  Finally Greg ran the script using the .csv files to
    generate the patches.
    
    Reviewed-by: Kate Stewart <kstewart@linuxfoundation.org>
    Reviewed-by: Philippe Ombredanne <pombredanne@nexb.com>
    Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 2f694f3846a9..1a5eaef3b7f2 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -1,3 +1,4 @@
+/* SPDX-License-Identifier: GPL-2.0 */
 /* linux/spi/ads7846.h */
 
 /* Touchscreen characteristics vary between boards and models.  The

commit c4f4925439f13a243aecfb36c693613603c0bfbd
Author: Igor Grinberg <grinberg@compulab.co.il>
Date:   Tue Nov 20 23:00:10 2012 -0800

    Input: ads7846 - enable pendown GPIO debounce time setting
    
    Some platforms need the pendown GPIO debounce time setting programmed.
    Since the pendown GPIO is handled by the driver, the debounce time
    should also be handled along with the pendown GPIO request.
    
    Signed-off-by: Igor Grinberg <grinberg@compulab.co.il>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index c64de9dd7631..2f694f3846a9 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -46,8 +46,9 @@ struct ads7846_platform_data {
 	u16	debounce_rep;		/* additional consecutive good readings
 					 * required after the first two */
 	int	gpio_pendown;		/* the GPIO used to decide the pendown
-					 * state if get_pendown_state == NULL
-					 */
+					 * state if get_pendown_state == NULL */
+	int	gpio_pendown_debounce;	/* platform specific debounce time for
+					 * the gpio_pendown */
 	int	(*get_pendown_state)(void);
 	int	(*filter_init)	(const struct ads7846_platform_data *pdata,
 				 void **filter_data);

commit ebcaaad9d5e8fd284b8dcf25a24999420f0f56d8
Author: Alexander Stein <alexander.stein@systec-electronic.com>
Date:   Wed May 11 16:24:08 2011 -0700

    Input: ads7846 - add possibility to use external vref on ads7846
    
    Just set vref_mv in your platform config to use external vref. Otherwise
    the internal one is used.
    
    Signed-off-by: Alexander Stein <alexander.stein@systec-electronic.com>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 92bd0839d5b4..c64de9dd7631 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -14,7 +14,8 @@ enum ads7846_filter {
 struct ads7846_platform_data {
 	u16	model;			/* 7843, 7845, 7846, 7873. */
 	u16	vref_delay_usecs;	/* 0 for external vref; etc */
-	u16	vref_mv;		/* external vref value, milliVolts */
+	u16	vref_mv;		/* external vref value, milliVolts
+					 * ads7846: if 0, use internal vref */
 	bool	keep_vref_on;		/* set to keep vref on for differential
 					 * measurements as well */
 	bool	swap_xy;		/* swap x and y axes */

commit 0f622bf465e78c390e13c5f4a14d0b3f8fb7c7e5
Author: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Date:   Thu Jul 1 09:01:50 2010 -0700

    Input: ads7846 - do not allow altering platform data
    
    Tested-by: Anatolij Gustschin <agust@denx.de>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 95d36bfb34bc..92bd0839d5b4 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -48,7 +48,7 @@ struct ads7846_platform_data {
 					 * state if get_pendown_state == NULL
 					 */
 	int	(*get_pendown_state)(void);
-	int	(*filter_init)	(struct ads7846_platform_data *pdata,
+	int	(*filter_init)	(const struct ads7846_platform_data *pdata,
 				 void **filter_data);
 	int	(*filter)	(void *filter_data, int data_idx, int *val);
 	void	(*filter_cleanup)(void *filter_data);

commit 7804302b14032d357d889e4a23e463eb6a6c5136
Author: Anatolij Gustschin <agust@denx.de>
Date:   Mon Jun 28 01:25:19 2010 -0700

    Input: ads7846 - allow specifying irq trigger type in platform data
    
    On some platforms, for example with GPIO interrupts on mpc5121,
    it is not possible to configure falling edge interrupts.
    
    Specifying irq trigger type in platform data structure
    allows using ads7846 driver on such platforms.
    
    Signed-off-by: Anatolij Gustschin <agust@denx.de>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index b4ae570d3c98..95d36bfb34bc 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -54,5 +54,6 @@ struct ads7846_platform_data {
 	void	(*filter_cleanup)(void *filter_data);
 	void	(*wait_for_sync)(void);
 	bool	wakeup;
+	unsigned long irq_flags;
 };
 

commit fdba2bb1f2eed85085a0fe154e1acb82de3239f7
Author: Ranjith Lohithakshan <ranjithl@ti.com>
Date:   Wed Mar 10 23:41:22 2010 -0800

    Input: ads7846 - add wakeup support
    
    Add wakeup support to the ads7846 driver. Platforms can enable wakeup
    capability by setting the wakeup flag in ads7846_platform_data. With this
    patch the ads7846 driver can be used to wake the system from suspend.
    
    Signed-off-by: Ranjith Lohithakshan <ranjithl@ti.com>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 5710c15d394a..b4ae570d3c98 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -53,5 +53,6 @@ struct ads7846_platform_data {
 	int	(*filter)	(void *filter_data, int data_idx, int *val);
 	void	(*filter_cleanup)(void *filter_data);
 	void	(*wait_for_sync)(void);
+	bool	wakeup;
 };
 

commit 06a09124b5ec65f81df66c56695d9a9ae04a0114
Author: Michael Hennerich <michael.hennerich@analog.com>
Date:   Tue Mar 9 20:38:45 2010 -0800

    Input: ads7846 - add support for AD7843 parts
    
    The AD7873 is almost identical to the ADS7846; the only difference is
    related to the Power Management bits PD0 and PD1.  This results in a
    slightly different PENIRQ enable behavior.  For the AD7873, VREF should
    be turned off during differential measurements.
    
    So, add the AD7873/43 to the list of driver supported devices, and prevent
    VREF usage during differential/ratiometric conversion modes.
    
    Signed-off-by: Michael Hennerich <michael.hennerich@analog.com>
    Signed-off-by: Mike Frysinger <vapier@gentoo.org>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 51948eb6927a..5710c15d394a 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -12,7 +12,7 @@ enum ads7846_filter {
 };
 
 struct ads7846_platform_data {
-	u16	model;			/* 7843, 7845, 7846. */
+	u16	model;			/* 7843, 7845, 7846, 7873. */
 	u16	vref_delay_usecs;	/* 0 for external vref; etc */
 	u16	vref_mv;		/* external vref value, milliVolts */
 	bool	keep_vref_on;		/* set to keep vref on for differential

commit 86579a4cccf18a2ddbf7de8fc5a0f5d9b94ed76d
Author: Michael Roth <mroth@nessie.de>
Date:   Mon May 18 16:04:44 2009 -0700

    Input: ads7846 - support swapping x and y axes
    
    Signed-off-by: Michael Roth <mroth@nessie.de>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 2ea20320c093..51948eb6927a 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -17,6 +17,7 @@ struct ads7846_platform_data {
 	u16	vref_mv;		/* external vref value, milliVolts */
 	bool	keep_vref_on;		/* set to keep vref on for differential
 					 * measurements as well */
+	bool	swap_xy;		/* swap x and y axes */
 
 	/* Settling time of the analog signals; a function of Vcc and the
 	 * capacitance on the X/Y drivers.  If set to non-zero, two samples

commit fd746d540abf8c686f5f868ae62112692e684088
Author: Eric Miao <eric.miao@marvell.com>
Date:   Sat Apr 11 16:54:59 2009 -0700

    Input: ads7846 - introduce platform specific way to synchronize sampling
    
    Noises can be introduced when LCD signals are being driven, some platforms
    provide a signal to assist the synchronization of this sampling procedure.
    
    Signed-off-by: Eric Miao <eric.miao@marvell.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 05eab2f11e63..2ea20320c093 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -51,5 +51,6 @@ struct ads7846_platform_data {
 				 void **filter_data);
 	int	(*filter)	(void *filter_data, int data_idx, int *val);
 	void	(*filter_cleanup)(void *filter_data);
+	void	(*wait_for_sync)(void);
 };
 

commit 6ae19b04ab41a4db0f0c48ec0b78950f6b028823
Author: Eric Miao <eric.y.miao@gmail.com>
Date:   Wed Sep 10 12:06:15 2008 -0400

    Input: ads7846 - introduce .gpio_pendown to get pendown state
    
    The GPIO connected to ADS7846 nPENIRQ signal is usually used to get
    the pendown state as well. Introduce a .gpio_pendown, and use this
    to decide the pendown state if .get_pendown_state is NULL.
    
    Signed-off-by: Eric Miao <eric.miao@marvell.com>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index daf744017a31..05eab2f11e63 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -43,6 +43,9 @@ struct ads7846_platform_data {
 	u16	debounce_tol;		/* tolerance used for filtering */
 	u16	debounce_rep;		/* additional consecutive good readings
 					 * required after the first two */
+	int	gpio_pendown;		/* the GPIO used to decide the pendown
+					 * state if get_pendown_state == NULL
+					 */
 	int	(*get_pendown_state)(void);
 	int	(*filter_init)	(struct ads7846_platform_data *pdata,
 				 void **filter_data);

commit 7c6d0ee14cb7a4cfad4864dc196256da5749bc0c
Author: David Brownell <david-b@pacbell.net>
Date:   Wed Apr 2 00:43:01 2008 -0400

    Input: ads7846 - simplify support of external vREF (and ads7843)
    
    This updates the ads7846 driver to handle external vREF (required
    on boards using ads7843 chips) without module parameters, and also
    removes a needless variable with its associated bogus gcc warning.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 334d31411629..daf744017a31 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -14,7 +14,8 @@ enum ads7846_filter {
 struct ads7846_platform_data {
 	u16	model;			/* 7843, 7845, 7846. */
 	u16	vref_delay_usecs;	/* 0 for external vref; etc */
-	int	keep_vref_on:1;		/* set to keep vref on for differential
+	u16	vref_mv;		/* external vref value, milliVolts */
+	bool	keep_vref_on;		/* set to keep vref on for differential
 					 * measurements as well */
 
 	/* Settling time of the analog signals; a function of Vcc and the

commit 1d25891f3241103d14ea78236504474a138b8ada
Author: Semih Hazar <semih.hazar@indefia.com>
Date:   Wed Jul 18 00:36:04 2007 -0400

    Input: ads7846 - re-check pendown status before reporting events
    
    Pendown status from the PENIRQ pin is currently read only at the beginning
    of a sample set. If the pen is lifted just after sampling has began then
    sampled values become wrong.
    
    This patch adds an optional platform penirq_recheck_delay attribute.  If
    non-zero, samples are only reported to the input subsystem if PENIRQ is
    still active that long after the samples taken.
    
    Signed-off-by: Semih Hazar <semih.hazar@indefia.com>
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index a44fa7a02bd9..334d31411629 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -24,6 +24,12 @@ struct ads7846_platform_data {
 	 */
 	u16	settle_delay_usecs;
 
+	/* If set to non-zero, after samples are taken this delay is applied
+	 * and penirq is rechecked, to help avoid false events.  This value
+	 * is affected by the material used to build the touch layer.
+	 */
+	u16	penirq_recheck_delay_usecs;
+
 	u16	x_plate_ohms;
 	u16	y_plate_ohms;
 

commit e4f48861993294c27849076741eb0c090482560b
Author: Semih Hazar <semih.hazar@indefia.com>
Date:   Wed Jul 18 00:35:56 2007 -0400

    Input: ads7846 - introduce sample settling delay
    
    The ads7846 driver has support for filtering, but when the chip gets
    deselected between samples this causes noise. This patch adds support
    for an optional settling delay time, so that two consecutive samples
    will be taken with the specified delay time apart.  This ensures that
    the chip won't be deselected, so the noise won't appear.
    
    Filtering can still be done, but will have less work to do since each
    time a new sample is taken the same delay applies.
    
    Signed-off-by: Semih Hazar <semih.hazar@indefia.com>
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 3387e44dfd13..a44fa7a02bd9 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -16,6 +16,14 @@ struct ads7846_platform_data {
 	u16	vref_delay_usecs;	/* 0 for external vref; etc */
 	int	keep_vref_on:1;		/* set to keep vref on for differential
 					 * measurements as well */
+
+	/* Settling time of the analog signals; a function of Vcc and the
+	 * capacitance on the X/Y drivers.  If set to non-zero, two samples
+	 * are taken with settle_delay us apart, and the second one is used.
+	 * ~150 uSec with 0.01uF caps.
+	 */
+	u16	settle_delay_usecs;
+
 	u16	x_plate_ohms;
 	u16	y_plate_ohms;
 

commit de2defd96d7d92fe8b5f9cf2bfd385d8d4819923
Author: Imre Deak <imre.deak@solidboot.com>
Date:   Thu Jan 18 00:45:21 2007 -0500

    Input: ads7846 - optionally leave Vref on during differential measurements
    
    On some LCDs leaving the Vref on provides much better readings.
    
    Signed-off-by: Jarkko Oikarinen <jarkko.oikarinen@nokia.com>
    Signed-off-by: Imre Deak <imre.deak@solidboot.com>
    Signed-off-by: Juha Yrjola <juha.yrjola@solidboot.com>
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 1663f940ca11..3387e44dfd13 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -14,6 +14,8 @@ enum ads7846_filter {
 struct ads7846_platform_data {
 	u16	model;			/* 7843, 7845, 7846. */
 	u16	vref_delay_usecs;	/* 0 for external vref; etc */
+	int	keep_vref_on:1;		/* set to keep vref on for differential
+					 * measurements as well */
 	u16	x_plate_ohms;
 	u16	y_plate_ohms;
 

commit da970e69efb9fd0be0c23ace5bde42d4caf17b40
Author: Imre Deak <imre.deak@solidboot.com>
Date:   Thu Jan 18 00:44:41 2007 -0500

    Input: ads7846 - pluggable filtering logic
    
    Some LCDs like the LS041Y3 require a customized filtering
    logic for reliable readings, so make the filtering function
    replacable through platform specific hooks.
    
    Signed-off-by: Imre Deak <imre.deak@solidboot.com>
    Signed-off-by: Juha Yrjola <juha.yrjola@solidboot.com>
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index adb3dafd33e9..1663f940ca11 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -5,6 +5,12 @@
  *
  * It's OK if the min/max values are zero.
  */
+enum ads7846_filter {
+	ADS7846_FILTER_OK,
+	ADS7846_FILTER_REPEAT,
+	ADS7846_FILTER_IGNORE,
+};
+
 struct ads7846_platform_data {
 	u16	model;			/* 7843, 7845, 7846. */
 	u16	vref_delay_usecs;	/* 0 for external vref; etc */
@@ -21,5 +27,9 @@ struct ads7846_platform_data {
 	u16	debounce_rep;		/* additional consecutive good readings
 					 * required after the first two */
 	int	(*get_pendown_state)(void);
+	int	(*filter_init)	(struct ads7846_platform_data *pdata,
+				 void **filter_data);
+	int	(*filter)	(void *filter_data, int data_idx, int *val);
+	void	(*filter_cleanup)(void *filter_data);
 };
 

commit d5b415c95f0e6510451f1446cea832c1f77bd7ea
Author: Imre Deak <imre.deak@nokia.com>
Date:   Wed Apr 26 00:13:18 2006 -0400

    Input: ads7846 - improve filtering for thumb press accuracy
    
    Providing more accurate coordinates for thumb press requires additional
    steps in the filtering logic:
    
    - Ignore samples found invalid by the debouncing logic, or the ones that
      have out of bound pressure value.
    - Add a parameter to repeat debouncing, so that more then two consecutive
      good readings are required for a valid sample.
    
    Signed-off-by: Imre Deak <imre.deak@nokia.com>
    Acked-by: Juha Yrjola <juha.yrjola@nokia.com>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index d8823e237e0b..adb3dafd33e9 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -15,9 +15,11 @@ struct ads7846_platform_data {
 	u16	y_min, y_max;
 	u16	pressure_min, pressure_max;
 
-	u16	debounce_max;		/* max number of readings per sample */
+	u16	debounce_max;		/* max number of additional readings
+					 * per sample */
 	u16	debounce_tol;		/* tolerance used for filtering */
-
+	u16	debounce_rep;		/* additional consecutive good readings
+					 * required after the first two */
 	int	(*get_pendown_state)(void);
 };
 

commit c9e617a563ad646239270fa2222cdb06966cf1fa
Author: Imre Deak <imre.deak@nokia.com>
Date:   Tue Apr 11 23:44:05 2006 -0400

    Input: ads7846 - handle IRQs that were latched during disabled IRQs
    
    The pen down IRQ will toggle during each X,Y,Z measurement cycle.
    Even though the IRQ is disabled it will be latched and delivered
    when after enable_irq. Thus in the IRQ handler we must avoid
    starting a new measurement cycle when such an "unwanted" IRQ happens.
    Add a get_pendown_state platform function, which will probably
    determine this by reading the current GPIO level of the pen IRQ pin.
    
    Move the IRQ reenabling from the SPI RX function to the timer. After
    the last power down message the pen IRQ pin is still active for a
    while and get_pendown_state would report incorrectly a pen down state.
    
    When suspending we should check the ts->pending flag instead of
    ts->pendown, since the timer can be pending regardless of ts->pendown.
    Also if ts->pending is set we can be sure that the timer is running,
    so no need to rearm it. Similarly if ts->pending is not set we can
    be sure that the IRQ is enabled (and the timer is not).
    
    Signed-off-by: Imre Deak <imre.deak@nokia.com>
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 3f7664951256..d8823e237e0b 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -17,5 +17,7 @@ struct ads7846_platform_data {
 
 	u16	debounce_max;		/* max number of readings per sample */
 	u16	debounce_tol;		/* tolerance used for filtering */
+
+	int	(*get_pendown_state)(void);
 };
 

commit 0b7018aae7e1798f55f736b9a77c201708aa0e33
Author: Imre Deak <imre.deak@nokia.com>
Date:   Tue Apr 11 23:42:03 2006 -0400

    Input: ads7846 - debouncing and rudimentary sample filtering
    
    Some touchscreens seem to oscillate heavily for a while after touching
    the screen. Â Implement support for sampling the screen until we get two
    consecutive values that are close enough.
    
    Signed-off-by: Imre Deak <imre.deak@nokia.com>
    Signed-off-by: Juha Yrjola <juha.yrjola@nokia.com>
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Dmitry Torokhov <dtor@mail.ru>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 72261e0f2ac1..3f7664951256 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -14,5 +14,8 @@ struct ads7846_platform_data {
 	u16	x_min, x_max;
 	u16	y_min, y_max;
 	u16	pressure_min, pressure_max;
+
+	u16	debounce_max;		/* max number of readings per sample */
+	u16	debounce_tol;		/* tolerance used for filtering */
 };
 

commit 2e5a7bd978bf4118a0c8edf2e6ff81d0a72fee47
Author: David Brownell <david-b@pacbell.net>
Date:   Sun Jan 8 13:34:25 2006 -0800

    [PATCH] spi: ads7836 uses spi_driver
    
    This updates the ads7864 driver to use the new "spi_driver" struct, and
    includes some minor unrelated cleanup.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
index 84a27013d399..72261e0f2ac1 100644
--- a/include/linux/spi/ads7846.h
+++ b/include/linux/spi/ads7846.h
@@ -1,7 +1,7 @@
 /* linux/spi/ads7846.h */
 
 /* Touchscreen characteristics vary between boards and models.  The
- * platform_data for the device's "struct device" holts this information.
+ * platform_data for the device's "struct device" holds this information.
  *
  * It's OK if the min/max values are zero.
  */

commit ffa458c1bd9b6f653008d450f337602f3d52a646
Author: David Brownell <david-b@pacbell.net>
Date:   Sun Jan 8 13:34:21 2006 -0800

    [PATCH] spi: ads7846 driver
    
    This is a driver for the ADS7846 touchscreen sensor, derived from
    the corgi_ts and omap_ts drivers.  Key differences from those two:
    
      - Uses the new SPI framework (minimalist version)
      - <linux/spi/ads7846.h> abstracts board-specific touchscreen info
      - Sysfs attributes for the temperature and voltage sensors
      - Uses fewer ARM-specific IRQ primitives
    
    The temperature and voltage sensors show up in sysfs like this:
    
      $ pwd
      /sys/devices/platform/omap-uwire/spi2.0
      $ ls
      bus@          input:event0@ power/        temp1         vbatt
      driver@       modalias      temp0         vaux
      $ cat modalias
      ads7846
      $ cat temp0
      991
      $ cat temp1
      1177
      $
    
    So far only basic testing has been done.  There's a fair amount of hardware
    that uses this sensor, and which also runs Linux, which should eventually
    be able to use this driver.
    
    One portability note may be of special interest.  It turns out that not all
    SPI controllers are happy issuing requests that do things like "write 8 bit
    command, read 12 bit response".  Most of them seem happy to handle various
    word sizes, so the issue isn't "12 bit response" but rather "different rx
    and tx write sizes", despite that being a common MicroWire convention.  So
    this version of the driver no longer reads 12 bit native-endian words; it
    reads 16-bit big-endian responses, then byteswaps them and shifts the
    results to discard the noise.
    
    Signed-off-by: David Brownell <david-b@pacbell.net>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/include/linux/spi/ads7846.h b/include/linux/spi/ads7846.h
new file mode 100644
index 000000000000..84a27013d399
--- /dev/null
+++ b/include/linux/spi/ads7846.h
@@ -0,0 +1,18 @@
+/* linux/spi/ads7846.h */
+
+/* Touchscreen characteristics vary between boards and models.  The
+ * platform_data for the device's "struct device" holts this information.
+ *
+ * It's OK if the min/max values are zero.
+ */
+struct ads7846_platform_data {
+	u16	model;			/* 7843, 7845, 7846. */
+	u16	vref_delay_usecs;	/* 0 for external vref; etc */
+	u16	x_plate_ohms;
+	u16	y_plate_ohms;
+
+	u16	x_min, x_max;
+	u16	y_min, y_max;
+	u16	pressure_min, pressure_max;
+};
+
