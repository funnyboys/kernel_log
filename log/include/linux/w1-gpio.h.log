commit d2912cb15bdda8ba4a5dd73396ad62641af2f520
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Tue Jun 4 10:11:33 2019 +0200

    treewide: Replace GPLv2 boilerplate/reference with SPDX - rule 500
    
    Based on 2 normalized pattern(s):
    
      this program is free software you can redistribute it and or modify
      it under the terms of the gnu general public license version 2 as
      published by the free software foundation
    
      this program is free software you can redistribute it and or modify
      it under the terms of the gnu general public license version 2 as
      published by the free software foundation #
    
    extracted by the scancode license scanner the SPDX license identifier
    
      GPL-2.0-only
    
    has been chosen to replace the boilerplate/reference in 4122 file(s).
    
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Reviewed-by: Enrico Weigelt <info@metux.net>
    Reviewed-by: Kate Stewart <kstewart@linuxfoundation.org>
    Reviewed-by: Allison Randal <allison@lohutok.net>
    Cc: linux-spdx@vger.kernel.org
    Link: https://lkml.kernel.org/r/20190604081206.933168790@linutronix.de
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/include/linux/w1-gpio.h b/include/linux/w1-gpio.h
index 78901ecd2f95..3495fd0dc790 100644
--- a/include/linux/w1-gpio.h
+++ b/include/linux/w1-gpio.h
@@ -1,11 +1,8 @@
+/* SPDX-License-Identifier: GPL-2.0-only */
 /*
  * w1-gpio interface to platform code
  *
  * Copyright (C) 2007 Ville Syrjala <syrjala@sci.fi>
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License version 2
- * as published by the Free Software Foundation.
  */
 #ifndef _LINUX_W1_GPIO_H
 #define _LINUX_W1_GPIO_H

commit e0fc62a6552f3d9c21e73cc65844f9aad1892cf7
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Tue Sep 26 20:27:09 2017 +0200

    w1: w1-gpio: Convert to use GPIO descriptors
    
    The w1 master driver includes a complete open drain emulation
    reimplementation among other things.
    
    This converts the driver and all board files using it to use
    GPIO descriptors associated with the device to look up the
    GPIO wire, as well ass the optional pull-up GPIO line.
    
    When probed from the device tree, the driver will just pick
    descriptors and use them right off. For the two board files
    in the kernel, we add descriptor lookups so we do not need
    to keep any old platform data handling around for the GPIO
    lines.
    
    As the platform data is also a state container for this driver,
    we augment it to contain the GPIO descriptors.
    
    w1_gpio_write_bit_dir() and w1_gpio_write_bit_val() are gone
    since this pair was a reimplementation of open drain emulation
    which is now handled by gpiolib.
    
    The special "linux,open-drain" flag is a bit of mishap here:
    it has the same semantic as the same flags in I2C: it means
    that something in the platform is setting up the line as
    open drain behind our back. We handle this the same way as
    in I2C.
    
    To drive the pull-up, we need to bypass open drain emulation
    in gpiolib for the line, and this is done by driving it high
    using gpiod_set_raw_value() which has been augmented to have
    the semantic of overriding the open drain emulation.
    
    We also augment the documentation to reflect the way to pass
    GPIO descriptors from the machine.
    
    Acked-by: Evgeniy Polyakov <zbr@ioremap.net>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>

diff --git a/include/linux/w1-gpio.h b/include/linux/w1-gpio.h
index d58594a32324..78901ecd2f95 100644
--- a/include/linux/w1-gpio.h
+++ b/include/linux/w1-gpio.h
@@ -10,16 +10,15 @@
 #ifndef _LINUX_W1_GPIO_H
 #define _LINUX_W1_GPIO_H
 
+struct gpio_desc;
+
 /**
  * struct w1_gpio_platform_data - Platform-dependent data for w1-gpio
- * @pin: GPIO pin to use
- * @is_open_drain: GPIO pin is configured as open drain
  */
 struct w1_gpio_platform_data {
-	unsigned int pin;
-	unsigned int is_open_drain:1;
+	struct gpio_desc *gpiod;
+	struct gpio_desc *pullup_gpiod;
 	void (*enable_external_pullup)(int enable);
-	unsigned int ext_pullup_enable_pin;
 	unsigned int pullup_duration;
 };
 

commit 3089a4c8d3abc7e2ab105d1d39d415110d1566d6
Author: Evgeny Boger <boger@contactless.ru>
Date:   Thu Jan 23 15:56:18 2014 -0800

    drivers/w1/masters/w1-gpio.c: add strong pullup emulation
    
    Strong pullup is emulated by driving pin logic high after write command
    when using tri-state push-pull GPIO.
    
    Signed-off-by: Evgeny Boger <boger@contactless.ru>
    Cc: Greg KH <greg@kroah.com>
    Acked-by: David Fries <david@fries.net>
    Acked-by: Evgeniy Polyakov <zbr@ioremap.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/include/linux/w1-gpio.h b/include/linux/w1-gpio.h
index 065e3ae79ab0..d58594a32324 100644
--- a/include/linux/w1-gpio.h
+++ b/include/linux/w1-gpio.h
@@ -20,6 +20,7 @@ struct w1_gpio_platform_data {
 	unsigned int is_open_drain:1;
 	void (*enable_external_pullup)(int enable);
 	unsigned int ext_pullup_enable_pin;
+	unsigned int pullup_duration;
 };
 
 #endif /* _LINUX_W1_GPIO_H */

commit d2323cf77308d6aa13a3a5287310ef93c4919d1e
Author: Daniel Mack <zonque@gmail.com>
Date:   Wed Jul 25 22:54:29 2012 +0200

    onewire: w1-gpio: add ext_pullup_enable pin in platform data
    
    In the process of porting boards to devicetree implemenation, we should
    keep information about external circuitry where they belong - the
    individual drivers.
    
    This patch adds a way to specify a GPIO to drive the (optional) external
    pull-up logic, rather than using a function pointer for that.
    
    Signed-off-by: Daniel Mack <zonque@gmail.com>
    Acked-by: Evgeniy Polyakov <zbr@ioremap.net>
    Acked-by: Ville Syrjälä <syrjala@sci.fi>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/include/linux/w1-gpio.h b/include/linux/w1-gpio.h
index 3adeff82212f..065e3ae79ab0 100644
--- a/include/linux/w1-gpio.h
+++ b/include/linux/w1-gpio.h
@@ -19,6 +19,7 @@ struct w1_gpio_platform_data {
 	unsigned int pin;
 	unsigned int is_open_drain:1;
 	void (*enable_external_pullup)(int enable);
+	unsigned int ext_pullup_enable_pin;
 };
 
 #endif /* _LINUX_W1_GPIO_H */

commit c8a06c1ef0bc45915fc45a170c7c60426971304c
Author: Daniel Mack <daniel@caiaq.de>
Date:   Wed Jun 17 16:28:15 2009 -0700

    w1-gpio: add external pull-up enable callback
    
    On embedded devices, sleep mode conditions can be tricky to handle,
    Especially when processors tend to pull-down the w1 bus during sleep.  Bus
    slaves (such as the ds2760) may interpret this as a reason for power-down
    conditions and entirely switch off the device.
    
    This patch adds a callback function pointer to let users switch on and off
    the external pull-up resistor.  This lets the outside world know whether
    the processor is currently actively driving the bus or not.
    
    When this callback is not provided, the code behaviour won't change.
    
    Signed-off-by: Daniel Mack <daniel@caiaq.de>
    Acked-by: Ville Syrjala <syrjala@sci.fi>
    Acked-by: Evgeniy Polyakov <johnpol@2ka.mipt.ru>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/include/linux/w1-gpio.h b/include/linux/w1-gpio.h
index 9797fec7748a..3adeff82212f 100644
--- a/include/linux/w1-gpio.h
+++ b/include/linux/w1-gpio.h
@@ -18,6 +18,7 @@
 struct w1_gpio_platform_data {
 	unsigned int pin;
 	unsigned int is_open_drain:1;
+	void (*enable_external_pullup)(int enable);
 };
 
 #endif /* _LINUX_W1_GPIO_H */

commit ad8dc96e3b2c3e28854e0de4ab49351ed547b30c
Author: Ville Syrjala <syrjala@sci.fi>
Date:   Wed Feb 6 01:39:01 2008 -0800

    w1-gpio: add GPIO w1 bus master driver
    
    Add a GPIO 1-wire bus master driver.  The driver used the GPIO API to
    control the wire and the GPIO pin can be specified using platform data
    similar to i2c-gpio.  The driver was tested with AT91SAM9260 + DS2401.
    
    Signed-off-by: Ville Syrjala <syrjala@sci.fi>
    Cc: Evgeniy Polyakov <johnpol@2ka.mipt.ru>
    Cc: David Brownell <david-b@pacbell.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/include/linux/w1-gpio.h b/include/linux/w1-gpio.h
new file mode 100644
index 000000000000..9797fec7748a
--- /dev/null
+++ b/include/linux/w1-gpio.h
@@ -0,0 +1,23 @@
+/*
+ * w1-gpio interface to platform code
+ *
+ * Copyright (C) 2007 Ville Syrjala <syrjala@sci.fi>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2
+ * as published by the Free Software Foundation.
+ */
+#ifndef _LINUX_W1_GPIO_H
+#define _LINUX_W1_GPIO_H
+
+/**
+ * struct w1_gpio_platform_data - Platform-dependent data for w1-gpio
+ * @pin: GPIO pin to use
+ * @is_open_drain: GPIO pin is configured as open drain
+ */
+struct w1_gpio_platform_data {
+	unsigned int pin;
+	unsigned int is_open_drain:1;
+};
+
+#endif /* _LINUX_W1_GPIO_H */
