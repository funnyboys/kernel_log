commit 457b42f0aa1c397745ada6083bf81b9479ab19fe
Author: Liu Xiang <liu.xiang6@zte.com.cn>
Date:   Sun Jul 22 21:33:56 2018 +0800

    power: supply: bq27xxx: Add support for BQ27411
    
    According to the datasheet, bq27411 is similar to bq27421.
    
    Signed-off-by: Liu Xiang <liu.xiang6@zte.com.cn>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.com>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index d6355f49fbae..507c5e214c42 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -24,6 +24,7 @@ enum bq27xxx_chip {
 	BQ27546,
 	BQ27742,
 	BQ27545, /* bq27545 */
+	BQ27411,
 	BQ27421, /* bq27421, bq27441, bq27621 */
 	BQ27425,
 	BQ27426,

commit 5ef6a16033b47afbc578c7ef8754da5ae7b198d7
Author: Andrew F. Davis <afd@ti.com>
Date:   Sat Apr 21 18:12:49 2018 -0500

    power: supply: bq27xxx: Add support for BQ27426
    
    This device is software similar to the BQ27426 except it has
    different data memory offsets. Add support here.
    
    Signed-off-by: Andrew F. Davis <afd@ti.com>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 01fbf1b16258..d6355f49fbae 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -24,8 +24,9 @@ enum bq27xxx_chip {
 	BQ27546,
 	BQ27742,
 	BQ27545, /* bq27545 */
-	BQ27421, /* bq27421, bq27425, bq27441, bq27621 */
+	BQ27421, /* bq27421, bq27441, bq27621 */
 	BQ27425,
+	BQ27426,
 	BQ27441,
 	BQ27621,
 };

commit 70a39e1075019eef753649ac01ed594ac9016be6
Author: Pavel Machek <pavel@ucw.cz>
Date:   Fri Nov 10 11:39:37 2017 +0100

    Add support for bq27521 battery monitor
    
    This adds basic support for BQ27521 battery monitor, used in Nokia N9
    and N950. In particular, battery voltage is important to be able to
    tell when the battery is almost empty. Emptying battery on N950 is
    pretty painful, as flasher needs to be used to recover phone in such case.
    
    Signed-off-by: Pavel Machek <pavel@ucw.cz>
    Acked-by: Andrew F. Davis <afd@ti.com>
    Acked-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index e6187f524f2c..01fbf1b16258 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -16,6 +16,7 @@ enum bq27xxx_chip {
 	BQ27520G2, /* bq27520G2 */
 	BQ27520G3, /* bq27520G3 */
 	BQ27520G4, /* bq27520G4 */
+	BQ27521, /* bq27521 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27531,
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */

commit b24413180f5600bcb3bb70fbed5cf186b60864bd
Author: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Date:   Wed Nov 1 15:07:57 2017 +0100

    License cleanup: add SPDX GPL-2.0 license identifier to files with no license
    
    Many source files in the tree are missing licensing information, which
    makes it harder for compliance tools to determine the correct license.
    
    By default all files without license information are under the default
    license of the kernel, which is GPL version 2.
    
    Update the files which contain no license information with the 'GPL-2.0'
    SPDX license identifier.  The SPDX identifier is a legally binding
    shorthand, which can be used instead of the full boiler plate text.
    
    This patch is based on work done by Thomas Gleixner and Kate Stewart and
    Philippe Ombredanne.
    
    How this work was done:
    
    Patches were generated and checked against linux-4.14-rc6 for a subset of
    the use cases:
     - file had no licensing information it it.
     - file was a */uapi/* one with no licensing information in it,
     - file was a */uapi/* one with existing licensing information,
    
    Further patches will be generated in subsequent months to fix up cases
    where non-standard license headers were used, and references to license
    had to be inferred by heuristics based on keywords.
    
    The analysis to determine which SPDX License Identifier to be applied to
    a file was done in a spreadsheet of side by side results from of the
    output of two independent scanners (ScanCode & Windriver) producing SPDX
    tag:value files created by Philippe Ombredanne.  Philippe prepared the
    base worksheet, and did an initial spot review of a few 1000 files.
    
    The 4.13 kernel was the starting point of the analysis with 60,537 files
    assessed.  Kate Stewart did a file by file comparison of the scanner
    results in the spreadsheet to determine which SPDX license identifier(s)
    to be applied to the file. She confirmed any determination that was not
    immediately clear with lawyers working with the Linux Foundation.
    
    Criteria used to select files for SPDX license identifier tagging was:
     - Files considered eligible had to be source code files.
     - Make and config files were included as candidates if they contained >5
       lines of source
     - File already had some variant of a license header in it (even if <5
       lines).
    
    All documentation files were explicitly excluded.
    
    The following heuristics were used to determine which SPDX license
    identifiers to apply.
    
     - when both scanners couldn't find any license traces, file was
       considered to have no license information in it, and the top level
       COPYING file license applied.
    
       For non */uapi/* files that summary was:
    
       SPDX license identifier                            # files
       ---------------------------------------------------|-------
       GPL-2.0                                              11139
    
       and resulted in the first patch in this series.
    
       If that file was a */uapi/* path one, it was "GPL-2.0 WITH
       Linux-syscall-note" otherwise it was "GPL-2.0".  Results of that was:
    
       SPDX license identifier                            # files
       ---------------------------------------------------|-------
       GPL-2.0 WITH Linux-syscall-note                        930
    
       and resulted in the second patch in this series.
    
     - if a file had some form of licensing information in it, and was one
       of the */uapi/* ones, it was denoted with the Linux-syscall-note if
       any GPL family license was found in the file or had no licensing in
       it (per prior point).  Results summary:
    
       SPDX license identifier                            # files
       ---------------------------------------------------|------
       GPL-2.0 WITH Linux-syscall-note                       270
       GPL-2.0+ WITH Linux-syscall-note                      169
       ((GPL-2.0 WITH Linux-syscall-note) OR BSD-2-Clause)    21
       ((GPL-2.0 WITH Linux-syscall-note) OR BSD-3-Clause)    17
       LGPL-2.1+ WITH Linux-syscall-note                      15
       GPL-1.0+ WITH Linux-syscall-note                       14
       ((GPL-2.0+ WITH Linux-syscall-note) OR BSD-3-Clause)    5
       LGPL-2.0+ WITH Linux-syscall-note                       4
       LGPL-2.1 WITH Linux-syscall-note                        3
       ((GPL-2.0 WITH Linux-syscall-note) OR MIT)              3
       ((GPL-2.0 WITH Linux-syscall-note) AND MIT)             1
    
       and that resulted in the third patch in this series.
    
     - when the two scanners agreed on the detected license(s), that became
       the concluded license(s).
    
     - when there was disagreement between the two scanners (one detected a
       license but the other didn't, or they both detected different
       licenses) a manual inspection of the file occurred.
    
     - In most cases a manual inspection of the information in the file
       resulted in a clear resolution of the license that should apply (and
       which scanner probably needed to revisit its heuristics).
    
     - When it was not immediately clear, the license identifier was
       confirmed with lawyers working with the Linux Foundation.
    
     - If there was any question as to the appropriate license identifier,
       the file was flagged for further research and to be revisited later
       in time.
    
    In total, over 70 hours of logged manual review was done on the
    spreadsheet to determine the SPDX license identifiers to apply to the
    source files by Kate, Philippe, Thomas and, in some cases, confirmation
    by lawyers working with the Linux Foundation.
    
    Kate also obtained a third independent scan of the 4.13 code base from
    FOSSology, and compared selected files where the other two scanners
    disagreed against that SPDX file, to see if there was new insights.  The
    Windriver scanner is based on an older version of FOSSology in part, so
    they are related.
    
    Thomas did random spot checks in about 500 files from the spreadsheets
    for the uapi headers and agreed with SPDX license identifier in the
    files he inspected. For the non-uapi files Thomas did random spot checks
    in about 15000 files.
    
    In initial set of patches against 4.14-rc6, 3 files were found to have
    copy/paste license identifier errors, and have been fixed to reflect the
    correct identifier.
    
    Additionally Philippe spent 10 hours this week doing a detailed manual
    inspection and review of the 12,461 patched files from the initial patch
    version early this week with:
     - a full scancode scan run, collecting the matched texts, detected
       license ids and scores
     - reviewing anything where there was a license detected (about 500+
       files) to ensure that the applied SPDX license was correct
     - reviewing anything where there was no detection but the patch license
       was not GPL-2.0 WITH Linux-syscall-note to ensure that the applied
       SPDX license was correct
    
    This produced a worksheet with 20 files needing minor correction.  This
    worksheet was then exported into 3 different .csv files for the
    different types of files to be modified.
    
    These .csv files were then reviewed by Greg.  Thomas wrote a script to
    parse the csv files and add the proper SPDX tag to the file, in the
    format that the file expected.  This script was further refined by Greg
    based on the output to detect more types of files automatically and to
    distinguish between header and source .c files (which need different
    comment types.)  Finally Greg ran the script using the .csv files to
    generate the patches.
    
    Reviewed-by: Kate Stewart <kstewart@linuxfoundation.org>
    Reviewed-by: Philippe Ombredanne <pombredanne@nexb.com>
    Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 43194e02c1ee..e6187f524f2c 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -1,3 +1,4 @@
+/* SPDX-License-Identifier: GPL-2.0 */
 #ifndef __LINUX_BQ27X00_BATTERY_H__
 #define __LINUX_BQ27X00_BATTERY_H__
 

commit 05045379b2740686020618c8cfd4b517cff9f918
Author: Liam Breck <kernel@networkimprov.net>
Date:   Wed Aug 23 20:36:15 2017 -0700

    power: supply: bq27xxx: Enable data memory update for certain chips
    
    Support data memory update on BQ27425. Parameters from TI datasheets are also
    provided for BQ27500, 545, 421, 441, 621; however these are commented out,
    as they are not tested.
    
    Add BQ27XXX_O_CFGUP & _O_RAM for use in bq27xxx_chip_data[n].opts
    and by data memory update functions.
    
    Signed-off-by: Liam Breck <kernel@networkimprov.net>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index e48e7a4e9cd6..43194e02c1ee 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -54,7 +54,6 @@ struct bq27xxx_device_info {
 	struct device *dev;
 	int id;
 	enum bq27xxx_chip chip;
-	bool ram_chip;
 	u32 opts;
 	const char *name;
 	struct bq27xxx_dm_reg *dm_regs;

commit 3a731c6414c94012328f485b4b1bb88ed841f9eb
Author: Liam Breck <kernel@networkimprov.net>
Date:   Wed Aug 23 20:36:14 2017 -0700

    power: supply: bq27xxx: Add chip IDs for previously shadowed chips
    
    For the existing features, these chips act like others already ID'd,
    so they had false but functional IDs. We will be adding features
    which require correct IDs, so the following IDs are added:
    BQ2752X, 531, 542, 546, 742, 425, 441, 621
    
    Chip-specific features are now tracked by BQ27XXX_O_* flags in di->opts.
    
    No functional changes to the driver.
    
    Signed-off-by: Liam Breck <kernel@networkimprov.net>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 89890437f9ab..e48e7a4e9cd6 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -6,6 +6,7 @@ enum bq27xxx_chip {
 	BQ27010, /* bq27010, bq27210 */
 	BQ2750X, /* bq27500 deprecated alias */
 	BQ2751X, /* bq27510, bq27520 deprecated alias */
+	BQ2752X,
 	BQ27500, /* bq27500/1 */
 	BQ27510G1, /* bq27510G1 */
 	BQ27510G2, /* bq27510G2 */
@@ -15,9 +16,16 @@ enum bq27xxx_chip {
 	BQ27520G3, /* bq27520G3 */
 	BQ27520G4, /* bq27520G4 */
 	BQ27530, /* bq27530, bq27531 */
+	BQ27531,
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
+	BQ27542,
+	BQ27546,
+	BQ27742,
 	BQ27545, /* bq27545 */
 	BQ27421, /* bq27421, bq27425, bq27441, bq27621 */
+	BQ27425,
+	BQ27441,
+	BQ27621,
 };
 
 struct bq27xxx_device_info;
@@ -47,6 +55,7 @@ struct bq27xxx_device_info {
 	int id;
 	enum bq27xxx_chip chip;
 	bool ram_chip;
+	u32 opts;
 	const char *name;
 	struct bq27xxx_dm_reg *dm_regs;
 	u32 unseal_key;

commit 67bd22c09ac1b54b5f42445783d2dc8e011f7a71
Author: Andrew F. Davis <afd@ti.com>
Date:   Wed Jul 19 12:04:07 2017 -0500

    power: supply: bq27xxx: move platform driver code into bq27xxx_battery_hdq.c
    
    When the BQ27xxx driver was originally written the w1 subsystem only
    allowed device drivers for w1 attached devices to live in the w1
    subsystem. Kernel driver subsystems expect that the driver for a device
    live in the directory of the subsystem for which it implements
    functionality, not in the directory of the bus that it is attached. To
    work around this, the BQ27xxx driver was implemented as a platform device
    driver and the interface driver would instantiate this device from within
    the w1 directory, then pass a w1 read callback as platform data.
    
    As we can now have the w1 interface driver in the power/supply directory
    (like we do already with the i2c interface driver) we can remove this
    middle-layer platform driver.
    
    Signed-off-by: Andrew F. Davis <afd@ti.com>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 11e11685dd1d..89890437f9ab 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -20,23 +20,6 @@ enum bq27xxx_chip {
 	BQ27421, /* bq27421, bq27425, bq27441, bq27621 */
 };
 
-/**
- * struct bq27xxx_plaform_data - Platform data for bq27xxx devices
- * @name: Name of the battery.
- * @chip: Chip class number of this device.
- * @read: HDQ read callback.
- *	This function should provide access to the HDQ bus the battery is
- *	connected to.
- *	The first parameter is a pointer to the battery device, the second the
- *	register to be read. The return value should either be the content of
- *	the passed register or an error value.
- */
-struct bq27xxx_platform_data {
-	const char *name;
-	enum bq27xxx_chip chip;
-	int (*read)(struct device *dev, unsigned int);
-};
-
 struct bq27xxx_device_info;
 struct bq27xxx_access_methods {
 	int (*read)(struct bq27xxx_device_info *di, u8 reg, bool single);

commit ccce440956c79343ab3aa1269a4cf57f9cce030f
Author: Liam Breck <kernel@networkimprov.net>
Date:   Wed Jun 7 11:37:56 2017 -0700

    power: supply: bq27xxx: Add power_supply_battery_info support
    
    Previously there was no way to configure these chips in the event that the
    defaults didn't match the battery in question.
    
    For chips with RAM data memory (and also those with flash/NVM data memory
    if CONFIG_BATTERY_BQ27XXX_DT_UPDATES_NVM is defined and the user has not
    set module param dt_monitored_battery_updates_nvm=0) we now call
    power_supply_get_battery_info(), check its values, and write battery
    properties to chip data memory if there is a dm_regs table for the chip.
    
    Signed-off-by: Matt Ranostay <matt@ranostay.consulting>
    Signed-off-by: Liam Breck <kernel@networkimprov.net>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index b1defb86e9b6..11e11685dd1d 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -63,7 +63,9 @@ struct bq27xxx_device_info {
 	struct device *dev;
 	int id;
 	enum bq27xxx_chip chip;
+	bool ram_chip;
 	const char *name;
+	struct bq27xxx_dm_reg *dm_regs;
 	u32 unseal_key;
 	struct bq27xxx_access_methods bus;
 	struct bq27xxx_reg_cache cache;

commit 0670c9b3588f163cfcfcd8ea532f321ec004e6ad
Author: Liam Breck <kernel@networkimprov.net>
Date:   Wed Jun 7 11:37:55 2017 -0700

    power: supply: bq27xxx: Add chip data memory read/write support
    
    Add these to enable read/write of chip data memory RAM/NVM/flash:
      bq27xxx_battery_seal()
      bq27xxx_battery_unseal()
      bq27xxx_battery_set_cfgupdate()
      bq27xxx_battery_soft_reset()
      bq27xxx_battery_read_dm_block()
      bq27xxx_battery_write_dm_block()
      bq27xxx_battery_checksum_dm_block()
    
    Signed-off-by: Matt Ranostay <matt@ranostay.consulting>
    Signed-off-by: Liam Breck <kernel@networkimprov.net>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index c3369fa605f9..b1defb86e9b6 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -64,6 +64,7 @@ struct bq27xxx_device_info {
 	int id;
 	enum bq27xxx_chip chip;
 	const char *name;
+	u32 unseal_key;
 	struct bq27xxx_access_methods bus;
 	struct bq27xxx_reg_cache cache;
 	int charge_design_full;

commit 14073f6614f62dc7862c83575b042424599cc867
Author: Matt Ranostay <matt@ranostay.consulting>
Date:   Wed Jun 7 11:37:54 2017 -0700

    power: supply: bq27xxx: Add bulk transfer bus methods
    
    Declare bus.write/read_bulk/write_bulk().
    Add I2C write/read_bulk/write_bulk() to implement the above.
    Add bq27xxx_write/read_block/write_block() helpers to call the above.
    
    Signed-off-by: Matt Ranostay <matt@ranostay.consulting>
    Signed-off-by: Liam Breck <kernel@networkimprov.net>
    Acked-by: "Andrew F. Davis" <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.co.uk>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index b312bcef53da..c3369fa605f9 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -40,6 +40,9 @@ struct bq27xxx_platform_data {
 struct bq27xxx_device_info;
 struct bq27xxx_access_methods {
 	int (*read)(struct bq27xxx_device_info *di, u8 reg, bool single);
+	int (*write)(struct bq27xxx_device_info *di, u8 reg, int value, bool single);
+	int (*read_bulk)(struct bq27xxx_device_info *di, u8 reg, u8 *data, int len);
+	int (*write_bulk)(struct bq27xxx_device_info *di, u8 reg, u8 *data, int len);
 };
 
 struct bq27xxx_reg_cache {

commit 8835cae5f2abd7f7a3143afe357f416aff5517a4
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:47 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27520-g4 revision.
    
    This commit adds the BQ27520G4 chip definition to specifically match the
    bq27520-G4 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 5c12717d0f75..b312bcef53da 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -13,6 +13,7 @@ enum bq27xxx_chip {
 	BQ27520G1, /* bq27520G1 */
 	BQ27520G2, /* bq27520G2 */
 	BQ27520G3, /* bq27520G3 */
+	BQ27520G4, /* bq27520G4 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 825e915ba2e811b91a034ac6290cd172387c5447
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:46 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27520-g3 revision.
    
    This commit adds the BQ27520G3 chip definition to specifically match the
    bq27520-G3 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index a3fc34a4ef72..5c12717d0f75 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -12,6 +12,7 @@ enum bq27xxx_chip {
 	BQ27510G3, /* bq27510G3 */
 	BQ27520G1, /* bq27520G1 */
 	BQ27520G2, /* bq27520G2 */
+	BQ27520G3, /* bq27520G3 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit a5deb9a93040a4a221ef8a67c88ecd72cd1f3625
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:45 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27520-g2 revision.
    
    This commit adds the BQ27520G2 chip definition to specifically match the
    bq27520-G2 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index eddd96936875..a3fc34a4ef72 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -11,6 +11,7 @@ enum bq27xxx_chip {
 	BQ27510G2, /* bq27510G2 */
 	BQ27510G3, /* bq27510G3 */
 	BQ27520G1, /* bq27520G1 */
+	BQ27520G2, /* bq27520G2 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 68f2a813eb25bd0ef72453aeef9b1ce156157d14
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:44 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27520-g1 revision.
    
    This commit adds the BQ27520G1 chip definition to specifically match the
    bq27520-G1 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index c45ce71a6158..eddd96936875 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -10,6 +10,7 @@ enum bq27xxx_chip {
 	BQ27510G1, /* bq27510G1 */
 	BQ27510G2, /* bq27510G2 */
 	BQ27510G3, /* bq27510G3 */
+	BQ27520G1, /* bq27520G1 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 71375aa7d6a7392d4968f6a562b437cb4958f956
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:43 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27510-g3 revision.
    
    This commit adds the BQ27510G3 chip definition to specifically match the
    bq27510-G3 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Tested-by: Chris Lapa <chris@lapa.com.au>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 79772ca231b1..c45ce71a6158 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -9,6 +9,7 @@ enum bq27xxx_chip {
 	BQ27500, /* bq27500/1 */
 	BQ27510G1, /* bq27510G1 */
 	BQ27510G2, /* bq27510G2 */
+	BQ27510G3, /* bq27510G3 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 698a2bf5fc31d85d428a2ae495775b61381a495e
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:42 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27510-g2 revision.
    
    This commit adds the BQ27510G2 chip definition to specifically match the
    bq27510-G2 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 3af0815426c9..79772ca231b1 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -8,6 +8,7 @@ enum bq27xxx_chip {
 	BQ2751X, /* bq27510, bq27520 deprecated alias */
 	BQ27500, /* bq27500/1 */
 	BQ27510G1, /* bq27510G1 */
+	BQ27510G2, /* bq27510G2 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit bd28177f3ec8367fbb3c56cfcf1c1a46e3fe240a
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:41 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27510-g1 revision.
    
    This commit adds the BQ27510G1 chip definition to specifically match the
    bq27510-G1 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 76b623d7a9a4..3af0815426c9 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -7,6 +7,7 @@ enum bq27xxx_chip {
 	BQ2750X, /* bq27500 deprecated alias */
 	BQ2751X, /* bq27510, bq27520 deprecated alias */
 	BQ27500, /* bq27500/1 */
+	BQ27510G1, /* bq27510G1 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 32833635b0fe9bf71bbf867d1c3abfb5b006bf29
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:40 2017 +1100

    power: supply: bq27xxx: adds specific support for bq27500/1 revision.
    
    This commit adds the BQ27500 chip definition to specifically match the
    bq27500/1 functionality as described in the datasheet.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Acked-by: Pali Rohár <pali.rohar@gmail.com>
    Reviewed-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 651f265837a4..76b623d7a9a4 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -6,6 +6,7 @@ enum bq27xxx_chip {
 	BQ27010, /* bq27010, bq27210 */
 	BQ2750X, /* bq27500 deprecated alias */
 	BQ2751X, /* bq27510, bq27520 deprecated alias */
+	BQ27500, /* bq27500/1 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 6da6e4bdd383d8efdf50da6d0933a16ad3a590f6
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:39 2017 +1100

    power: supply: bq27xxx: rename BQ27510 allow for deprecation in future.
    
    The BQ2751X definition exists only to satisfy backwards compatibility.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 4c904d00564c..651f265837a4 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -5,7 +5,7 @@ enum bq27xxx_chip {
 	BQ27000 = 1, /* bq27000, bq27200 */
 	BQ27010, /* bq27010, bq27210 */
 	BQ2750X, /* bq27500 deprecated alias */
-	BQ27510, /* bq27510, bq27520 */
+	BQ2751X, /* bq27510, bq27520 deprecated alias */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 818e3012c2eac4885bf7278c5144a14186d742d2
Author: Chris Lapa <chris@lapa.com.au>
Date:   Wed Jan 11 12:44:38 2017 +1100

    power: supply: bq27xxx: rename BQ27500 allow for deprecation in future.
    
    The BQ2750X definition exists only to satisfy backwards compatibility.
    
    Signed-off-by: Chris Lapa <chris@lapa.com.au>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index bed9557b69e7..4c904d00564c 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -4,7 +4,7 @@
 enum bq27xxx_chip {
 	BQ27000 = 1, /* bq27000, bq27200 */
 	BQ27010, /* bq27010, bq27210 */
-	BQ27500, /* bq27500 */
+	BQ2750X, /* bq27500 deprecated alias */
 	BQ27510, /* bq27510, bq27520 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */

commit 3bee9ea1de687925d116670f036599cbed8b66b0
Author: Andrew F. Davis <afd@ti.com>
Date:   Fri Nov 4 13:33:13 2016 -0500

    power: supply: bq27xxx_battery: Fix register map for BQ27510 and BQ27520
    
    The BQ27510 and BQ27520 use a slightly different register map than the
    BQ27500, add a new type enum and add these gauges to it.
    
    Fixes: d74534c27775 ("power: bq27xxx_battery: Add support for additional bq27xxx family devices")
    Based-on-patch-by: Kenneth R. Crudup <kenny@panix.com>
    Signed-off-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index e30deb046156..bed9557b69e7 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -4,7 +4,8 @@
 enum bq27xxx_chip {
 	BQ27000 = 1, /* bq27000, bq27200 */
 	BQ27010, /* bq27010, bq27210 */
-	BQ27500, /* bq27500, bq27510, bq27520 */
+	BQ27500, /* bq27500 */
+	BQ27510, /* bq27510, bq27520 */
 	BQ27530, /* bq27530, bq27531 */
 	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
 	BQ27545, /* bq27545 */

commit 1d72706f0485b58e151b5a7584c4c65d66670587
Author: Matt Ranostay <mranostay@gmail.com>
Date:   Mon Sep 19 20:43:02 2016 -0700

    power: supply: bq27xxx_battery: allow kernel poll_interval parameter runtime update
    
    Fix issue with poll_interval being not updated till the previous
    interval expired.
    
    Cc: Tony Lindgren <tony@atomide.com>
    Cc: Liam Breck <liam@networkimprov.net>
    Signed-off-by: Matt Ranostay <matt@ranostay.consulting>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index b50c0492629d..e30deb046156 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -58,6 +58,7 @@ struct bq27xxx_device_info {
 	unsigned long last_update;
 	struct delayed_work work;
 	struct power_supply *bat;
+	struct list_head list;
 	struct mutex lock;
 	u8 *regs;
 };

commit 9aafabc7fece13c8e2a1f680908c73ee19f0f79b
Author: Ivaylo Dimitrov <ivo.g.dimitrov.75@gmail.com>
Date:   Tue Feb 2 14:47:37 2016 +0200

    power: bq27xxx_battery: Restore device name
    
    Patch <703df6c09795> ("power: bq27xxx_battery: Reorganize I2C
    into a module") has removed the device name numbering from
    bq27xxx_battery_i2c_probe. Fix that by restoring the code.
    
    Fixes: 703df6c097956d17a818e63961c82e8e9eef9fef
    Signed-off-by: Ivaylo Dimitrov <ivo.g.dimitrov.75@gmail.com>
    Reviewed-by: Pali Rohár <pali.rohar@gmail.com>
    Tested-by: Pali Rohár <pali.rohar@gmail.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 998d8f1c3c91..b50c0492629d 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -49,6 +49,7 @@ struct bq27xxx_reg_cache {
 
 struct bq27xxx_device_info {
 	struct device *dev;
+	int id;
 	enum bq27xxx_chip chip;
 	const char *name;
 	struct bq27xxx_access_methods bus;

commit 703df6c097956d17a818e63961c82e8e9eef9fef
Author: Andrew F. Davis <afd@ti.com>
Date:   Mon Nov 23 10:53:51 2015 -0600

    power: bq27xxx_battery: Reorganize I2C into a module
    
    Separate out I2C functionality into a module. This fixes several small
    issues and simplifies the driver initialization.
    
    Signed-off-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index 45f6a7b5b3cb..998d8f1c3c91 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -1,6 +1,16 @@
 #ifndef __LINUX_BQ27X00_BATTERY_H__
 #define __LINUX_BQ27X00_BATTERY_H__
 
+enum bq27xxx_chip {
+	BQ27000 = 1, /* bq27000, bq27200 */
+	BQ27010, /* bq27010, bq27210 */
+	BQ27500, /* bq27500, bq27510, bq27520 */
+	BQ27530, /* bq27530, bq27531 */
+	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
+	BQ27545, /* bq27545 */
+	BQ27421, /* bq27421, bq27425, bq27441, bq27621 */
+};
+
 /**
  * struct bq27xxx_plaform_data - Platform data for bq27xxx devices
  * @name: Name of the battery.
@@ -12,20 +22,47 @@
  *	register to be read. The return value should either be the content of
  *	the passed register or an error value.
  */
-enum bq27xxx_chip {
-	BQ27000 = 1, /* bq27000, bq27200 */
-	BQ27010, /* bq27010, bq27210 */
-	BQ27500, /* bq27500, bq27510, bq27520 */
-	BQ27530, /* bq27530, bq27531 */
-	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
-	BQ27545, /* bq27545 */
-	BQ27421, /* bq27421, bq27425, bq27441, bq27621 */
-};
-
 struct bq27xxx_platform_data {
 	const char *name;
 	enum bq27xxx_chip chip;
 	int (*read)(struct device *dev, unsigned int);
 };
 
+struct bq27xxx_device_info;
+struct bq27xxx_access_methods {
+	int (*read)(struct bq27xxx_device_info *di, u8 reg, bool single);
+};
+
+struct bq27xxx_reg_cache {
+	int temperature;
+	int time_to_empty;
+	int time_to_empty_avg;
+	int time_to_full;
+	int charge_full;
+	int cycle_count;
+	int capacity;
+	int energy;
+	int flags;
+	int power_avg;
+	int health;
+};
+
+struct bq27xxx_device_info {
+	struct device *dev;
+	enum bq27xxx_chip chip;
+	const char *name;
+	struct bq27xxx_access_methods bus;
+	struct bq27xxx_reg_cache cache;
+	int charge_design_full;
+	unsigned long last_update;
+	struct delayed_work work;
+	struct power_supply *bat;
+	struct mutex lock;
+	u8 *regs;
+};
+
+void bq27xxx_battery_update(struct bq27xxx_device_info *di);
+int bq27xxx_battery_setup(struct bq27xxx_device_info *di);
+void bq27xxx_battery_teardown(struct bq27xxx_device_info *di);
+
 #endif

commit d74534c27775857cb09abd0f92ed9539dc8d0a93
Author: Andrew F. Davis <afd@ti.com>
Date:   Tue Sep 22 14:35:09 2015 -0500

    power: bq27xxx_battery: Add support for additional bq27xxx family devices
    
    Add support for additional devices and register equivalent family devices
    including the bq27010, bq27210, bq27500, bq27510, bq27520, bq27530,
    bq27531, bq27541, bq27542, bq27546, bq27545, bq27441, bq27421, and the
    bq27641.
    
    To facilitate this process the register mapings have been moved to tables
    and other small cleanups have been made.
    
    Signed-off-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index a4efb10a1bab..45f6a7b5b3cb 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -12,7 +12,15 @@
  *	register to be read. The return value should either be the content of
  *	the passed register or an error value.
  */
-enum bq27xxx_chip { BQ27000 = 1, BQ27500, BQ27425, BQ27742, BQ27510 };
+enum bq27xxx_chip {
+	BQ27000 = 1, /* bq27000, bq27200 */
+	BQ27010, /* bq27010, bq27210 */
+	BQ27500, /* bq27500, bq27510, bq27520 */
+	BQ27530, /* bq27530, bq27531 */
+	BQ27541, /* bq27541, bq27542, bq27546, bq27742 */
+	BQ27545, /* bq27545 */
+	BQ27421, /* bq27421, bq27425, bq27441, bq27621 */
+};
 
 struct bq27xxx_platform_data {
 	const char *name;

commit 424cfde49acaf1426e90837961e8aead0238b11b
Author: Andrew F. Davis <afd@ti.com>
Date:   Tue Sep 22 14:35:07 2015 -0500

    power: bq27xxx_battery: Platform initialization must declare a device
    
    When initialized as a platform device the initializer must now specify
    a device. An empty device name is no longer valid.
    
    Signed-off-by: Andrew F. Davis <afd@ti.com>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
index e70a93a6799f..a4efb10a1bab 100644
--- a/include/linux/power/bq27xxx_battery.h
+++ b/include/linux/power/bq27xxx_battery.h
@@ -3,7 +3,8 @@
 
 /**
  * struct bq27xxx_plaform_data - Platform data for bq27xxx devices
- * @name: Name of the battery. If NULL the driver will fallback to "bq27000".
+ * @name: Name of the battery.
+ * @chip: Chip class number of this device.
  * @read: HDQ read callback.
  *	This function should provide access to the HDQ bus the battery is
  *	connected to.
@@ -11,8 +12,11 @@
  *	register to be read. The return value should either be the content of
  *	the passed register or an error value.
  */
+enum bq27xxx_chip { BQ27000 = 1, BQ27500, BQ27425, BQ27742, BQ27510 };
+
 struct bq27xxx_platform_data {
 	const char *name;
+	enum bq27xxx_chip chip;
 	int (*read)(struct device *dev, unsigned int);
 };
 

commit 081bab217db769526c1202c87099ff69737126ae
Author: Andrew F. Davis <afd@ti.com>
Date:   Tue Sep 22 14:35:06 2015 -0500

    power: bq27x00_battery: Renaming for consistency
    
    Rename functions that are used by multiple devices. New devices
    have been added and the function names and driver name are no longer
    general enough for the functionality they provide.
    
    Signed-off-by: Andrew F. Davis <afd@ti.com>
    Acked-by: Tony Lindgren <tony@atomide.com>
    Acked-by: GUAN Xuetao <gxt@mprc.pku.edu.cn>
    Signed-off-by: Sebastian Reichel <sre@kernel.org>

diff --git a/include/linux/power/bq27xxx_battery.h b/include/linux/power/bq27xxx_battery.h
new file mode 100644
index 000000000000..e70a93a6799f
--- /dev/null
+++ b/include/linux/power/bq27xxx_battery.h
@@ -0,0 +1,19 @@
+#ifndef __LINUX_BQ27X00_BATTERY_H__
+#define __LINUX_BQ27X00_BATTERY_H__
+
+/**
+ * struct bq27xxx_plaform_data - Platform data for bq27xxx devices
+ * @name: Name of the battery. If NULL the driver will fallback to "bq27000".
+ * @read: HDQ read callback.
+ *	This function should provide access to the HDQ bus the battery is
+ *	connected to.
+ *	The first parameter is a pointer to the battery device, the second the
+ *	register to be read. The return value should either be the content of
+ *	the passed register or an error value.
+ */
+struct bq27xxx_platform_data {
+	const char *name;
+	int (*read)(struct device *dev, unsigned int);
+};
+
+#endif
